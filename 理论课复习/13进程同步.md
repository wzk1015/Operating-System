# 进程同步



## 目录

```
同步与互斥问题
忙等待互斥
信号量
管程同步和互斥
进程通信主要方法
经典进程同步互斥问题
```



## 索引与重点

### 同步与互斥问题

进程同步P3：指多个相关进程在执行次序上的协调，用于保证这种关系的相应机制称为同步机制。

并发错误P4：数据竞争P5（临界区、**临界资源**、假脱机打印SpoolingP6）、原子性违反P7（不可再现性P9）、死锁

**原子性**：一组操作必须一起完成

**临界资源**：一次只允许一个进程使用的自愿

**临界区**P10：访问临界资源的程序片段。使两个进程不同时处于临界区可避免竞争

同步机制遵循准则P13:**空闲让进、忙则等待、有限等待、让权等待**

### 忙等待的互斥方法

屏蔽中断P15：对用户进程不适用

共享锁变量P17：读锁和加锁应为原子操作

严格轮换法P23：轮流允许不同进程进入；忙等耗费CPU，交替执行效率低

Peterson算法P27：设置interested和turn。只适用于抢占式

硬件指令机制P33：TSL指令

Bakery算法P37

TSL、Peterson问题：忙等浪费CPU时间，出现优先级反转（死锁）

sleep和wakeup解决忙等P42

优先级反转不会发生在用户级线程，因为抢占发生在进程级别。内核级线程有可能

**生产者消费者问题**P46：sleep wakeup死锁P50

### 信号量

P：S--，若为0则先睡眠。V：S++，若为1则唤醒。S代表可同时获取的资源数目，为1实现互斥，＞1实现同步。PV为原语（原子操作）。

**信号量机制解决生产者消费者问题**P58

信号量同步PPT14P9

信号量实现汇合P10

信号量实现多路复用P12

多进程同步原语：屏障P19

信号量集SP、SV P26

PV优缺点P29：简单且能解决任何同步互斥问题。不够安全，复杂问题不易实现

### 管程

高级同步原语。每个临界资源设置专门数据结构、操作来控制。依赖于编译器和特定语言，不适用于分布式系统，只适用于单核、多核共享内存系统

P42管程函数自动化保证互斥访问，检查缓冲区和wait操作保证原子性

### 进程间通信

低级通信P49：状态和整数值(控制信息)。

高级通信：任意数量数据。分类：**管道P54、共享内存P53、消息系统**

信号、信号量、套接字

无名管道P57、有名管道P58

消息传递P59

共享内存P62

### 读者写者问题：互斥

读者优先：信号量实现P10、灯开关实现P14、信号量集P15

公平读写：使用闸机TurnstileP21，连续两个wait signal，关闭阻止所有进程，开启允许 轮流通过

写者优先：作业

### 理发师问题：同步、互斥

问题描述P26

信号量实现P28

### 生产者-消费者扩展问题：同步、互斥

银行柜台P34、P38

仓库P41

构建水分子问题P45



## 小测题

管道是半双工通讯，只用于亲缘关系

共享内存安全性低于消息传递

套接字可以用于不同机器、同一机器不同进程间通讯
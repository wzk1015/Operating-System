<!DOCTYPE html>
<!-- saved from url=(0143)http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/2659806750474e29b1e3948a90da8bd2/3d23196bb0fd4c7485648e18948ecc52/ -->
<html lang="zh-cn"><!--<![endif]--><head dir="ltr"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">



  <title>管道的读写 | 管道 | B3I062140 课程页面 | CSCore</title>

      <script type="text/javascript">
        /* immediately break out of an iframe if coming from the marketing website */
        (function(window) {
          if (window.location !== window.top.location) {
            window.top.location = window.location;
          }
        })(this);
      </script>

  

  <script type="text/javascript" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/djangojs.6045d60a99fe.js.下载"></script>

  <link rel="icon" type="image/x-icon" href="http://cscore.net.cn/static/images/favicon.c074c912999f.ico">

  
  

    <link href="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/lms-style-vendor.810246d53832.css" rel="stylesheet" type="text/css">



  
  

    <link href="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/lms-main-v1.5a41f023ae81.css" rel="stylesheet" type="text/css">




      
    <script type="text/javascript" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/lms-main_vendor.3465e5f2c3ee.js.下载" charset="utf-8"></script>


      
    <script type="text/javascript" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/lms-application.596021cdc57d.js.下载" charset="utf-8"></script>



  <script>
    window.baseUrl = "/static/";
    (function (require) {
      require.config({
          baseUrl: window.baseUrl
      });
    }).call(this, require || RequireJS.require);
  </script>
  <script type="text/javascript" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/require-config.cd72e66c1a3e.js.下载"></script>
  
    <script type="text/javascript">
        (function (require) {
          require.config({
              paths: {
                'js/courseware/courseware_factory': 'js/courseware/courseware_factory.01c762a7c9e6',
'draggabilly': 'js/vendor/draggabilly.26caba6f7187',
'js/courseware/toggle_element_visibility': 'js/courseware/toggle_element_visibility.22ad04bb0497',
'js/courseware/course_home_events': 'js/courseware/course_home_events.efe56112dd91',
'js/courseware/link_clicked_events': 'js/courseware/link_clicked_events',
'moment': 'common/js/vendor/moment-with-locales.084396f4103c',
'moment-timezone': 'common/js/vendor/moment-timezone-with-data.b062d5eadf09',
'js/student_account/logistration_factory': 'js/student_account/logistration_factory.541254eb1ae0',
'js/groups/views/cohorts_dashboard_factory': 'js/groups/views/cohorts_dashboard_factory.eb8701884901',
'js/dateutil_factory': 'js/dateutil_factory.f141a7899e5d',
'js/courseware/accordion_events': 'js/courseware/accordion_events.6064c7809de5',
'js/bookmarks/views/bookmark_button': 'js/bookmarks/views/bookmark_button.bca63457af5c',
'js/views/message_banner': 'js/views/message_banner.099aec538f98',
'js/student_profile/views/learner_profile_factory': 'js/student_profile/views/learner_profile_factory.c70d54366733'
            }
          });
        }).call(this, require || RequireJS.require);
    </script>
  

    
    <script type="text/javascript" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/lms-modules.515609b002b0.js.下载" charset="utf-8"></script>



  

  

    <link href="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/lms-style-course-vendor.d65f103108eb.css" rel="stylesheet" type="text/css">




  

    <link href="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/lms-course.6e248cc33f73.css" rel="stylesheet" type="text/css">




<script type="text/javascript" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/jquery.autocomplete.3bd10d7510d2.js.下载"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="moment" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/moment-with-locales.084396f4103c.js.下载"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="draggabilly" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/draggabilly.26caba6f7187.js.下载"></script>
<script type="text/javascript" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/tooltip_manager.e3531e99ed92.js.下载"></script>

<link href="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/jquery.autocomplete.09a0b34739a2.css" rel="stylesheet" type="text/css">
  <script src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/discussion_vendor.js.下载" type="application/javascript"></script>
<link rel="stylesheet" href="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/inline-discussion.css" type="text/css">


  

  


  


<!-- dummy Segment -->
<script type="text/javascript">
  var analytics = {
    track: function() { return; },
    trackLink: function() { return; },
    pageview: function() { return; },
    page: function() { return; }
  };
</script>
<!-- end dummy Segment -->


  <meta name="path_prefix" content="">
  <meta name="google-site-verification" content="_mipQ4AtZQDNmbtOkwehQDOgCxUUV2fb_C0b6wbiRHY">



<script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="/static/js/courseware/accordion_events.6064c7809de5.js?raw" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/accordion_events.6064c7809de5.js.下载"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="/static/js/dateutil_factory.f141a7899e5d.js?raw" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/dateutil_factory.f141a7899e5d.js.下载"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="js/bookmarks/views/bookmark_button" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/bookmark_button.bca63457af5c.js.下载"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="js/courseware/accordion_events" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/accordion_events.6064c7809de5.js(1).下载"></script><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>

<body class="ltr view-in-course view-courseware courseware  lang_zh-cn"><div id="MathJax_Message" style="display: none;"></div>


<div id="page-prompt"></div>
  <div class="window-wrap" dir="ltr">
    <a class="nav-skip" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/2659806750474e29b1e3948a90da8bd2/3d23196bb0fd4c7485648e18948ecc52/#main">跳至主要内容</a>

        












  <header id="global-navigation" class="header-global slim">
    <nav class="wrapper-header" aria-label="全球">
    <h1 class="logo">
      <a href="http://cscore.net.cn/">
        
        
            <img class="" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/logo.b6c374d66d57.png" alt="CSCore 主页">
        
      </a>
    </h1>

      <h2 class="course-header"><span class="provider">Internal:</span>
        <span class="course-number">B3I062140</span>
        
        <span class="course-name">操作系统_2019-2020学年春季学期</span></h2>

        <ol class="left nav-global list-inline authenticated">
        
            <li class="item nav-global-01">
              <a href="http://cscore.net.cn/courses">探索课程</a>
            </li>
        
      </ol>

      






    <ol class="user">
        <li class="primary">
            <a href="http://cscore.net.cn/dashboard" class="user-link">
                <span class="sr">课程面板：</span>
                
                <img class="user-image-frame" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/default_50.3455a6581573.png" alt="">
                <div class="label-username">18231047</div>
            </a>
        </li>
        <li class="primary">
            <div role="group" aria-label="User menu" class="user-menu">
                <button class="dropdown" aria-expanded="false"><span class="sr">More options dropdown</span><span class="fa fa-sort-desc" aria-hidden="true"></span></button>
                <ul class="dropdown-menu" aria-label="More Options" role="menu">
                    
                    <li class="dropdown-item item has-block-link"><a href="http://cscore.net.cn/dashboard" role="menuitem" class="action dropdown-menuitem">课程面板</a></li>
                    <li class="dropdown-item item has-block-link"><a href="http://cscore.net.cn/u/18231047" role="menuitem" class="action dropdown-menuitem">用户资料</a></li>
                    <li class="dropdown-item item has-block-link"><a href="http://cscore.net.cn/account/settings" role="menuitem" class="action dropdown-menuitem">账户</a></li>
                
                    <li class="item"><a href="http://cscore.net.cn/logout" role="menuitem" class="dropdown-menuitem">退出</a></li>
                </ul>
            </div>
        </li>
    </ol>


      <a href="https://edx.readthedocs.io/projects/open-edx-learner-guide/en/open-release-ficus.master/index.html" target="_blank" class="doc-link">帮助</a>

    </nav>
</header>
<!--[if lte IE 9]>
<div class="ie-banner" aria-hidden="true"><strong>警告：</strong>并不完全支持你的浏览器。我们强烈推荐使用 <a href="https://www.google.com/chrome" target="_blank">Chrome</a> 或 <a href="http://www.mozilla.org/firefox" target="_blank">Firefox</a>。</div>
<![endif]-->










    <div class="content-wrapper" id="content">
      













<script type="text/template" id="image-modal-tpl">
    <div class="wrapper-modal wrapper-modal-image">
  <section class="image-link">
    <%= smallHTML%>
    <a href="#" class="modal-ui-icon action-fullscreen" role="button">
      <span class="label">
        <span class="icon fa fa-arrows-alt fa-large" aria-hidden="true"></span> <%- gettext("Fullscreen") %>
      </span>
    </a>
  </section>

  <section class="image-modal">
    <section class="image-content">
      <div class="image-wrapper">
        <img alt="<%= largeALT %>, <%- gettext('Large') %>" src="<%= largeSRC %>" />
      </div>

      <a href="#" class="modal-ui-icon action-close" role="button">
        <span class="label">
          <span class="icon fa fa-remove fa-large" aria-hidden="true"></span> <%- gettext("Close") %>
        </span>
      </a>

      <ul class="image-controls">
        <li class="image-control">
          <a href="#" class="modal-ui-icon action-zoom-in" role="button">
            <span class="label">
              <span class="icon fa fa fa-search-plus fa-large" aria-hidden="true"></span> <%- gettext("Zoom In") %>
            </span>
          </a>
        </li>

        <li class="image-control">
          <a href="#" class="modal-ui-icon action-zoom-out is-disabled" aria-disabled="true" role="button">
            <span class="label">
              <span class="icon fa fa fa-search-minus fa-large" aria-hidden="true"></span> <%- gettext("Zoom Out") %>
            </span>
          </a>
        </li>
      </ul>
    </section>
  </section>
</div>

</script>









<div class="message-banner" aria-live="polite"></div>

  






    <nav class="courseware wrapper-course-material" aria-label="课程资料">
        <div class="course-material">
            
            <ol class="tabs course-tabs">
                





  
  <li class="tab">
  <a href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/info" class="">
  主页
  </a>
  </li>
  
  <li class="tab">
  <a href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware" class="active">
  课程
      <span class="sr">, current location</span>
  </a>
  </li>
  
  <li class="tab">
  <a href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/discussion/forum/" class="">
  讨论
  </a>
  </li>

                
            </ol>
        </div>
    </nav>



<div class="container">
  <div class="course-wrapper" role="presentation">

    <div class="course-index">

      <div class="wrapper-course-modes">

          <div class="courseware-bookmarks-button" data-bookmarks-api-url="/api/bookmarks/v1/bookmarks/">
              <button type="button" class="bookmarks-list-button is-inactive" aria-pressed="false">
                  书签
              </button>
          </div>


      </div>

      <div class="accordion">
        <nav class="course-navigation" aria-label="课程">
            





    

<a href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/2659806750474e29b1e3948a90da8bd2/3d23196bb0fd4c7485648e18948ecc52/#hello-operating-system-child" role="button" class="button-chapter chapter" id="hello-operating-system-parent" aria-controls="hello-operating-system-child" aria-expanded="false">
    <span class="group-heading" aria-label="Hello! Operating System!">
        <span class="icon fa fa-caret-right" aria-hidden="true"></span>
        Hello! Operating System!
    </span>
</a>
<div class="chapter-content-container" id="hello-operating-system-child" tabindex="-1" role="group" aria-label="Hello! Operating System! submenu">
    <div class="chapter-menu" style="">
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/2739a4c8668148249db204f756be9eeb/ab4df9f68e4a4935b37fbbac7462e119/">
                <p class="accordion-display-name">课程评价体系 </p>

                
            </a>
        </div>
    </div>
</div>

    

<a href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/2659806750474e29b1e3948a90da8bd2/3d23196bb0fd4c7485648e18948ecc52/#-child" role="button" class="button-chapter chapter" id="-parent" aria-controls="-child" aria-expanded="false">
    <span class="group-heading" aria-label="初识操作系统">
        <span class="icon fa fa-caret-right" aria-hidden="true"></span>
        初识操作系统
    </span>
</a>
<div class="chapter-content-container" id="-child" tabindex="-1" role="group" aria-label="初识操作系统 submenu">
    <div class="chapter-menu" style="">
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/153317b39af949f8b9df1c555d922732/ceaa1352e4ec45289d392f4db74b4c4e/">
                <p class="accordion-display-name">实验目的 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/153317b39af949f8b9df1c555d922732/2bba2b8149b8414ca37d3875766c04e2/">
                <p class="accordion-display-name">初识实验 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/153317b39af949f8b9df1c555d922732/822c38daef084233a6f18484818b6e68/">
                <p class="accordion-display-name">基础操作介绍 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/153317b39af949f8b9df1c555d922732/04b9c3d0647f4cbd83f8acc46cc30dfa/">
                <p class="accordion-display-name">实用工具介绍 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/153317b39af949f8b9df1c555d922732/cee76ce058174e4e8e1889e6bd7a233b/">
                <p class="accordion-display-name">Git 专栏–轻松维护和提交代码 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/153317b39af949f8b9df1c555d922732/f7248896fe3149c8b899f51c997db6f3/">
                <p class="accordion-display-name">实战测试 </p>

                
            </a>
        </div>
    </div>
</div>

    

<a href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/2659806750474e29b1e3948a90da8bd2/3d23196bb0fd4c7485648e18948ecc52/#boot-printf-child" role="button" class="button-chapter chapter" id="boot-printf-parent" aria-controls="boot-printf-child" aria-expanded="false">
    <span class="group-heading" aria-label="内核、Boot 和 printf">
        <span class="icon fa fa-caret-right" aria-hidden="true"></span>
        内核、Boot 和 printf
    </span>
</a>
<div class="chapter-content-container" id="boot-printf-child" tabindex="-1" role="group" aria-label="内核、Boot 和 printf submenu">
    <div class="chapter-menu" style="">
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/b6f67c365a514f5599bc7a9b13993b2f/5d166188049b48e58d0b7a55f5bda17a/">
                <p class="accordion-display-name">实验目的 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/b6f67c365a514f5599bc7a9b13993b2f/264b6553dba2455c92c40ac2f12b200d/">
                <p class="accordion-display-name">操作系统的启动 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/b6f67c365a514f5599bc7a9b13993b2f/3e7a7cc13ea841c0910ab87de5a21338/">
                <p class="accordion-display-name">Let's hack the kernel! </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/b6f67c365a514f5599bc7a9b13993b2f/37df728a007a4526a77010ae2f230527/">
                <p class="accordion-display-name">MIPS汇编与C语言 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/b6f67c365a514f5599bc7a9b13993b2f/914303b55d7c42fdbc3b214e09b5f5c7/">
                <p class="accordion-display-name">实战printf </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/b6f67c365a514f5599bc7a9b13993b2f/fe16a4b40890439994a72bd78720b5aa/">
                <p class="accordion-display-name">实验正确结果 </p>

                
            </a>
        </div>
    </div>
</div>

    

<a href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/2659806750474e29b1e3948a90da8bd2/3d23196bb0fd4c7485648e18948ecc52/#-child" role="button" class="button-chapter chapter" id="-parent" aria-controls="-child" aria-expanded="false">
    <span class="group-heading" aria-label="内存管理">
        <span class="icon fa fa-caret-right" aria-hidden="true"></span>
        内存管理
    </span>
</a>
<div class="chapter-content-container" id="-child" tabindex="-1" role="group" aria-label="内存管理 submenu">
    <div class="chapter-menu" style="">
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/741c6fdffbb44946ac0b70e496bb364b/ca3ca09136994d078650e66f98f5d399/">
                <p class="accordion-display-name">实验目的 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/741c6fdffbb44946ac0b70e496bb364b/135550cea9444954a25f903bbbffb320/">
                <p class="accordion-display-name">MMU、TLB和内存访问 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/741c6fdffbb44946ac0b70e496bb364b/31c5c4d28e7a441da80befed6ffed9b4/">
                <p class="accordion-display-name">MIPS虚存映射布局 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/741c6fdffbb44946ac0b70e496bb364b/45fa5020ab0a439ca2e65870c42a6142/">
                <p class="accordion-display-name">内存管理与内存翻译 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/741c6fdffbb44946ac0b70e496bb364b/10a337b68c6546a8ade6e74c9a843fee/">
                <p class="accordion-display-name">物理内存管理 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/741c6fdffbb44946ac0b70e496bb364b/fc1f9b06ba604483bece7f0128cbfd86/">
                <p class="accordion-display-name">虚拟内存管理 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/741c6fdffbb44946ac0b70e496bb364b/229a416b7c5f40d5affafcc9ed16e17f/">
                <p class="accordion-display-name">正确结果展示 </p>

                
            </a>
        </div>
    </div>
</div>

    

<a href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/2659806750474e29b1e3948a90da8bd2/3d23196bb0fd4c7485648e18948ecc52/#-child" role="button" class="button-chapter chapter" id="-parent" aria-controls="-child" aria-expanded="false">
    <span class="group-heading" aria-label="进程和异常">
        <span class="icon fa fa-caret-right" aria-hidden="true"></span>
        进程和异常
    </span>
</a>
<div class="chapter-content-container" id="-child" tabindex="-1" role="group" aria-label="进程和异常 submenu">
    <div class="chapter-menu" style="">
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/e1f34cb81a494157b08ee60dad9fba3e/e36133048843419eb00aa6fd7d13197a/">
                <p class="accordion-display-name">实验目的 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/e1f34cb81a494157b08ee60dad9fba3e/77cc3ea00a114f84b764296275e392bc/">
                <p class="accordion-display-name">进程 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/e1f34cb81a494157b08ee60dad9fba3e/60ef40a681c24a79a2c42e93d6e0c814/">
                <p class="accordion-display-name">中断与异常 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/e1f34cb81a494157b08ee60dad9fba3e/3af9ca40964d4b799ef6f351ee4611e4/">
                <p class="accordion-display-name">实验正确结果 </p>

                
            </a>
        </div>
    </div>
</div>

    

<a href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/2659806750474e29b1e3948a90da8bd2/3d23196bb0fd4c7485648e18948ecc52/#fork-child" role="button" class="button-chapter chapter" id="fork-parent" aria-controls="fork-child" aria-expanded="false">
    <span class="group-heading" aria-label="系统调用与 fork">
        <span class="icon fa fa-caret-right" aria-hidden="true"></span>
        系统调用与 fork
    </span>
</a>
<div class="chapter-content-container" id="fork-child" tabindex="-1" role="group" aria-label="系统调用与 fork submenu">
    <div class="chapter-menu" style="">
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/e470f921cff34e418655f9480cabce6c/4b25a6c9ebf34bc0b63b82192ea7d673/">
                <p class="accordion-display-name">实验目的 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/e470f921cff34e418655f9480cabce6c/c4329e6bc82b4cbdb60b83647c8c5f86/">
                <p class="accordion-display-name">系统调用(System Call) </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/e470f921cff34e418655f9480cabce6c/1eeddb2e93a442a0825557c28d8da9bd/">
                <p class="accordion-display-name">进程间通信机制(IPC) </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/e470f921cff34e418655f9480cabce6c/421b9add106d4249ab5ed4d91fd7b02c/">
                <p class="accordion-display-name">FORK </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/e470f921cff34e418655f9480cabce6c/ed564131b84f4ff7a9914747d524f1b8/">
                <p class="accordion-display-name">实验正确结果 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/e470f921cff34e418655f9480cabce6c/89ad19a67e9c4781893e7829bdf01399/">
                <p class="accordion-display-name">挑战性任务——线程和信号量 </p>

                
            </a>
        </div>
    </div>
</div>

    

<a href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/2659806750474e29b1e3948a90da8bd2/3d23196bb0fd4c7485648e18948ecc52/#-child" role="button" class="button-chapter chapter" id="-parent" aria-controls="-child" aria-expanded="false">
    <span class="group-heading" aria-label="文件系统">
        <span class="icon fa fa-caret-right" aria-hidden="true"></span>
        文件系统
    </span>
</a>
<div class="chapter-content-container" id="-child" tabindex="-1" role="group" aria-label="文件系统 submenu">
    <div class="chapter-menu" style="">
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/76812bcda636456eb6ce763ccf273573/dbb61d9b8ea047a5b444664b9b663e45/">
                <p class="accordion-display-name">实验目的 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/76812bcda636456eb6ce763ccf273573/be2685b86709439fbce7e27df0481940/">
                <p class="accordion-display-name">文件系统概述 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/76812bcda636456eb6ce763ccf273573/027eae3c9ff848b9a890657575319fbe/">
                <p class="accordion-display-name">IDE磁盘驱动 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/76812bcda636456eb6ce763ccf273573/227466acaf5f4139ae992510e335ec3c/">
                <p class="accordion-display-name">文件系统结构 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/76812bcda636456eb6ce763ccf273573/8e4de38dc76c4e89a7c858773c31f041/">
                <p class="accordion-display-name">文件系统的用户接口 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/76812bcda636456eb6ce763ccf273573/5606ea7ec5fb4f3ba4c113ff1582dd97/">
                <p class="accordion-display-name">实验正确结果 </p>

                
            </a>
        </div>
    </div>
</div>

    

<a href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/2659806750474e29b1e3948a90da8bd2/3d23196bb0fd4c7485648e18948ecc52/#shell-child" role="button" class="button-chapter chapter active is-open" id="shell-parent" aria-controls="shell-child" aria-expanded="true">
    <span class="group-heading active" aria-label="管道与 Shell 当前章节">
        <span class="icon fa fa-caret-down" aria-hidden="true"></span>
        管道与 Shell
    </span>
</a>
<div class="chapter-content-container is-open" id="shell-child" tabindex="-1" role="group" aria-label="管道与 Shell submenu">
    <div class="chapter-menu is-open" style="display: block;">
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/2659806750474e29b1e3948a90da8bd2/6b33cfad3aa147da88fd1270348f7703/">
                <p class="accordion-display-name">实验目的 </p>

                
            </a>
        </div>
        <div class="menu-item active ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/2659806750474e29b1e3948a90da8bd2/3d23196bb0fd4c7485648e18948ecc52/">
                <p class="accordion-display-name">管道 <span class="sr">当前部分</span></p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/2659806750474e29b1e3948a90da8bd2/247fab6135504df1ae9ac70f18868c06/">
                <p class="accordion-display-name">shell </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/2659806750474e29b1e3948a90da8bd2/abcd00e3ffb64b7ca8f2a0af2922f54d/">
                <p class="accordion-display-name">实验正确结果 </p>

                
            </a>
        </div>
        <div class="menu-item  ">
            <a class="accordion-nav" href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/2659806750474e29b1e3948a90da8bd2/69c86c1acfe4408db2d932d7ebb461c0/">
                <p class="accordion-display-name">挑战性任务 </p>

                
            </a>
        </div>
    </div>
</div>



    
  
  <script type="text/javascript">
    (function (require) {
        require(['/static/js/courseware/accordion_events.6064c7809de5.js?raw'], function () {
          require(['js/courseware/accordion_events'], function (AccordionEvents) {
            
        AccordionEvents();
    
          });
        });
    }).call(this, require || RequireJS.require);
  </script>


    
  
  <script type="text/javascript">
    (function (require) {
        require(['/static/js/dateutil_factory.f141a7899e5d.js?raw'], function () {
          require(['js/dateutil_factory'], function (DateUtilFactory) {
            
        DateUtilFactory.transform(iterationKey=".localized-datetime");
    
          });
        });
    }).call(this, require || RequireJS.require);
  </script>


        </nav>
      </div>

    </div>
    <section class="course-content" id="course-content">
        <div class="path">管道与 Shell &gt; 管道 &gt; 管道的读写</div>
        <main id="main" aria-label="Content" tabindex="-1">

          <div class="xblock xblock-student_view xblock-student_view-sequential xmodule_display xmodule_SequenceModule xblock-initialized" data-runtime-class="LmsRuntime" data-init="XBlockToXModuleShim" data-block-type="sequential" data-request-token="03ca6f9e547511ea990d5254001c17d8" data-runtime-version="1" data-usage-id="block-v1:Internal+B3I062140+2019_T2+type@sequential+block@3d23196bb0fd4c7485648e18948ecc52" data-type="Sequence" data-course-id="course-v1:Internal+B3I062140+2019_T2">
  
  


<div id="sequence_3d23196bb0fd4c7485648e18948ecc52" class="sequence" data-id="block-v1:Internal+B3I062140+2019_T2+type@sequential+block@3d23196bb0fd4c7485648e18948ecc52" data-position="1" data-ajax-url="/courses/course-v1:Internal+B3I062140+2019_T2/xblock/block-v1:Internal+B3I062140+2019_T2+type@sequential+block@3d23196bb0fd4c7485648e18948ecc52/handler/xmodule_handler" data-next-url="/courses/course-v1:Internal+B3I062140+2019_T2/courseware/2659806750474e29b1e3948a90da8bd2/247fab6135504df1ae9ac70f18868c06/?child=first" data-prev-url="/courses/course-v1:Internal+B3I062140+2019_T2/courseware/2659806750474e29b1e3948a90da8bd2/6b33cfad3aa147da88fd1270348f7703/?child=last">
  <div class="sequence-nav">
    <button class="sequence-nav-button button-previous">
      <span class="icon fa fa-chevron-prev" aria-hidden="true"></span>
      <span>上一个</span>
    </button>
    <nav class="sequence-list-wrapper" aria-label="单元">
      <ol id="sequence-list">
        <li>
        <button class="seq_other nav-item visited" data-id="block-v1:Internal+B3I062140+2019_T2+type@vertical+block@b70241da13fd42df9dd3c1fab449fc45" data-element="1" data-page-title="初窥管道" data-path="管道与 Shell &gt; 管道 &gt; 初窥管道" id="tab_0">
            <span class="icon fa seq_other" aria-hidden="true"></span>
            <span class="fa fa-fw fa-bookmark bookmark-icon is-hidden" aria-hidden="true"></span>
            <div class="sequence-tooltip sr"><span class="sr">other&nbsp;</span>初窥管道<span class="sr bookmark-icon-sr">&nbsp;</span></div>
          </button>
        </li>
        <li>
        <button class="seq_other nav-item visited" data-id="block-v1:Internal+B3I062140+2019_T2+type@vertical+block@565c25ecc7834a358f420a5fe5def3e6" data-element="2" data-page-title="管道的测试" data-path="管道与 Shell &gt; 管道 &gt; 管道的测试" id="tab_1">
            <span class="icon fa seq_other" aria-hidden="true"></span>
            <span class="fa fa-fw fa-bookmark bookmark-icon is-hidden" aria-hidden="true"></span>
            <div class="sequence-tooltip sr"><span class="sr">other&nbsp;</span>管道的测试<span class="sr bookmark-icon-sr">&nbsp;</span></div>
          </button>
        </li>
        <li>
        <button class="seq_other nav-item active" data-id="block-v1:Internal+B3I062140+2019_T2+type@vertical+block@0de09bcda6b744f8afc789c783241844" data-element="3" data-page-title="管道的读写" data-path="管道与 Shell &gt; 管道 &gt; 管道的读写" id="tab_2">
            <span class="icon fa seq_other" aria-hidden="true"></span>
            <span class="fa fa-fw fa-bookmark bookmark-icon is-hidden" aria-hidden="true"></span>
            <div class="sequence-tooltip sr"><span class="sr">other&nbsp;</span>管道的读写<span class="sr bookmark-icon-sr">&nbsp;</span></div>
          </button>
        </li>
        <li>
        <button class="seq_other inactive nav-item" data-id="block-v1:Internal+B3I062140+2019_T2+type@vertical+block@5a48091cd0474bc3a261fecc92e8d1b5" data-element="4" data-page-title="管道的竞争" data-path="管道与 Shell &gt; 管道 &gt; 管道的竞争" id="tab_3">
            <span class="icon fa seq_other" aria-hidden="true"></span>
            <span class="fa fa-fw fa-bookmark bookmark-icon is-hidden" aria-hidden="true"></span>
            <div class="sequence-tooltip sr"><span class="sr">other&nbsp;</span>管道的竞争<span class="sr bookmark-icon-sr">&nbsp;</span></div>
          </button>
        </li>
        <li>
        <button class="seq_other inactive nav-item" data-id="block-v1:Internal+B3I062140+2019_T2+type@vertical+block@8403255768af45fdaafec6d9348f0573" data-element="5" data-page-title="管道的同步" data-path="管道与 Shell &gt; 管道 &gt; 管道的同步" id="tab_4">
            <span class="icon fa seq_other" aria-hidden="true"></span>
            <span class="fa fa-fw fa-bookmark bookmark-icon is-hidden" aria-hidden="true"></span>
            <div class="sequence-tooltip sr"><span class="sr">other&nbsp;</span>管道的同步<span class="sr bookmark-icon-sr">&nbsp;</span></div>
          </button>
        </li>
      </ol>
    </nav>
    <button class="sequence-nav-button button-next">
      <span>下一个</span>
      <span class="icon fa fa-chevron-next" aria-hidden="true"></span>
    </button>
  </div>

  <div class="sr-is-focusable" tabindex="-1"></div>

  <div id="seq_contents_0" aria-labelledby="tab_0" aria-hidden="true" class="seq_contents tex2jax_ignore asciimath2jax_ignore">
    &lt;div class="xblock xblock-student_view xblock-student_view-vertical" data-runtime-class="LmsRuntime" data-init="VerticalStudentView" data-course-id="course-v1:Internal+B3I062140+2019_T2" data-request-token="03ca6f9e547511ea990d5254001c17d8" data-runtime-version="1" data-usage-id="block-v1:Internal+B3I062140+2019_T2+type@vertical+block@b70241da13fd42df9dd3c1fab449fc45" data-block-type="vertical"&gt;
  

  &lt;h3 class="unit-title"&gt;初窥管道&lt;/h3&gt;

    


&lt;div class="bookmark-button-wrapper"&gt;
  &lt;button class="btn btn-link bookmark-button "
    aria-pressed="false"
    data-bookmark-id="18231047,block-v1:Internal+B3I062140+2019_T2+type@vertical+block@b70241da13fd42df9dd3c1fab449fc45"&gt;
     &lt;span class="sr bookmark-sr"&gt;Click to add&lt;/span&gt;
     &lt;span class="bookmark-text"&gt;Bookmark this page&lt;/span&gt;
    &lt;/button&gt;
&lt;/div&gt;


&lt;div class="vert-mod"&gt;
  &lt;div class="vert vert-0" data-id="block-v1:Internal+B3I062140+2019_T2+type@html+block@c9037be9eb054751b0c397987549f82a"&gt;
    &lt;div class="xblock xblock-student_view xblock-student_view-html xmodule_display xmodule_HtmlModule" data-runtime-class="LmsRuntime" data-init="XBlockToXModuleShim" data-block-type="html" data-request-token="03ca6f9e547511ea990d5254001c17d8" data-runtime-version="1" data-usage-id="block-v1:Internal+B3I062140+2019_T2+type@html+block@c9037be9eb054751b0c397987549f82a" data-type="HTMLModule" data-course-id="course-v1:Internal+B3I062140+2019_T2"&gt;
  &lt;script type="json/xblock-args" class="xblock-json-init-args"&gt;
    {"xmodule-type": "HTMLModule"}
  &lt;/script&gt;
  &lt;p&gt;在 lab4 中，我们已经学习过一种进程间通信 (IPC,Inter-Process Communication)的方式&amp;mdash;&amp;mdash;共享内存。而今天我们要学的管道，其实也是进程间通信的一种方式。&lt;/p&gt;
&lt;p&gt;通俗来讲，管道就像家里的自来水管：一端用于注入水，一端用于放出水，且水只能在一个方向上流动，而不能双向流动，所以说管道是典型的单向通信。管道又叫做匿名管道，只能用在具有公共祖先的进程之间使用，通常使用在父子进程之间通信。&lt;/p&gt;
&lt;p&gt;在 Unix 中，管道由 pipe 函数创建，函数原型如下：&lt;/p&gt;
&lt;p style="padding-left: 30px;"&gt;&lt;code&gt;#include&amp;lt;unistd.h&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p style="padding-left: 30px;"&gt;&lt;code&gt;int　pipe(int fd[2]);&amp;nbsp; &amp;nbsp;//成功返回0，否则返回-1；&lt;/code&gt;&lt;/p&gt;
&lt;p style="padding-left: 30px;"&gt;&lt;code&gt;参数fd 返回两个文件描述符，fd[0]对应读端，fd[1]对应写端。&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;为了更好地理解管道实现的原理，同样，我们先来做实验亲自体会一下&lt;/p&gt;
&lt;p&gt;（实验代码参考http://pubs.opengroup.org/onlinepubs/9699919799/functions/pipe.html）&lt;/p&gt;
&lt;p style="padding-left: 30px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;#include &amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 30px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;#include &amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 30px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;int fildes[2];&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 30px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;/* buf size is 100 */&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 30px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;char buf[100];&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 30px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;int status;&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 30px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;int main(){&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 60px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;status = pipe(fildes);&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 60px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;if (status == -1 ) {&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 60px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;/* an error occurred */&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 60px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;printf("error\n");&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 60px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;}&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 60px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;switch (fork()) {&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 60px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;case -1: /* Handle error */&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 60px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;break;&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 60px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;case 0: /* Child - reads from pipe */&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 60px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;close(fildes[1]); /* Write end is unused */&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 60px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;read(fildes[0], buf, 100); /* Get data from pipe */&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 60px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;printf("child-process read:%s",buf); /* Print the data */&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 60px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;close(fildes[0]); /* Finished with pipe */&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 60px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;exit(EXIT_SUCCESS);&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 60px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;default: /* Parent - writes to pipe */&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 60px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;close(fildes[0]); /* Read end is unused */&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 60px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;write(fildes[1], "Hello world\n", 12); /* Write data on pipe */&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 60px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;close(fildes[1]); /* Child will see EOF */&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 60px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;exit(EXIT_SUCCESS);&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 30px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;}&lt;/span&gt;&lt;/p&gt;
&lt;p style="padding-left: 30px;"&gt;&lt;span face="monospace, serif" style="font-family: monospace, serif;"&gt;}&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;示例代码实现了从父进程向子进程发送消息&amp;rdquo;Hello,world&amp;rdquo;，并且在子进程中打印到屏幕上。它演示了管道在父子进程之间通信的基本用法：在 pipe 函数之后，调用 fork 来产生一个子进程，之后在父子进程中执行不同的操作。在示例代码中，父进程操作写端，而子进程操作读端。同时，示例代码也为我们演示了使用 pipe 系统调用的习惯：fork 之后，进程在开始读或写管道之前都会关掉不会用到的管道端。&lt;/p&gt;
&lt;p&gt;从本质上说，管道是一种只在内存中的文件。在 UNIX 中使用 pipe 系统调用时，进程中会打开两个新的文件描述符：一个只读端和一个只写端，而这两个文件描述符都映射到了同一片内存区域。但这样建立的管道的两端都在同一进程中，而且构建出的管道两端是两个匿名的文件描述符，这就让其他进程无法连接该管道。在 fork 的配合下，才能在父子进程间建立起进程间通信管道，这也是匿名管道只能在具有亲缘关系的进程间通信的原因。&lt;/p&gt;
&lt;p&gt;&lt;span style="color: #0000ff;"&gt;Thinking 6.1 示例代码中，父进程操作管道的写端，子进程操作管道的读端。如果现在想让父进程作为&amp;ldquo;读者&amp;rdquo;，代码应当如何修改？&amp;nbsp;&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;

  &lt;/div&gt;
  &lt;div class="vert vert-1" data-id="block-v1:Internal+B3I062140+2019_T2+type@discussion+block@9cda030e18f04dc5a50b825f52567b34"&gt;
    &lt;div class="xblock xblock-student_view xblock-student_view-discussion" data-runtime-class="LmsRuntime" data-init="DiscussionInlineBlock" data-course-id="course-v1:Internal+B3I062140+2019_T2" data-request-token="03ca6f9e547511ea990d5254001c17d8" data-runtime-version="1" data-usage-id="block-v1:Internal+B3I062140+2019_T2+type@discussion+block@9cda030e18f04dc5a50b825f52567b34" data-block-type="discussion"&gt;
  





&lt;script type="text/javascript"&gt;
  window.PLATFORM_NAME = "CSCore";
    window.ENABLE_DISCUSSION_HOME_PANEL = true;
&lt;/script&gt;



&lt;script aria-hidden="true" type="text/template" id="thread-template"&gt;
    &lt;article class="discussion-article" data-id="&lt;%- id %&gt;" tabindex="-1"&gt;
    &lt;div class="thread-wrapper"&gt;
        &lt;div class="thread-main-wrapper"&gt;
            &lt;div class="thread-content-wrapper"&gt;&lt;/div&gt;
            &lt;div class="post-extended-content"&gt;
                &lt;ol class="responses js-marked-answer-list"&gt;&lt;/ol&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="post-extended-content thread-responses-wrapper"&gt;
            &lt;div class="response-btn-count-wrapper"&gt;
                &lt;% if (!readOnly) { %&gt;
                &lt;div class="add-response"&gt;
                    &lt;button class="btn btn-small add-response-btn"&gt;
                        &lt;%- gettext("Add a Response") %&gt;
                    &lt;/button&gt;
                &lt;/div&gt;
                &lt;% } %&gt;
                &lt;div class="response-count"&gt;&lt;/div&gt;
            &lt;/div&gt;
            &lt;ol class="responses js-response-list"&gt;&lt;/ol&gt;
            &lt;div class="response-pagination"&gt;&lt;/div&gt;
            &lt;div class="post-status-closed bottom-post-status" style="display: none"&gt;
              &lt;%- gettext("This thread is closed.") %&gt;
            &lt;/div&gt;
            &lt;% if (can_create_comment &amp;&amp; !readOnly) { %&gt;
            &lt;form class="discussion-reply-new" data-id="&lt;%- id %&gt;"&gt;
                &lt;h4&gt;&lt;%- gettext("Add a response:") %&gt;&lt;/h4&gt;
                &lt;ul class="discussion-errors"&gt;&lt;/ul&gt;
                &lt;div class="reply-body" data-id="&lt;%- id %&gt;"&gt;&lt;/div&gt;
                &lt;div class="reply-post-control"&gt;
                    &lt;button class="btn discussion-submit-post control-button"&gt;&lt;%- gettext("Submit") %&gt;&lt;/button&gt;
                &lt;/div&gt;
            &lt;/form&gt;
            &lt;% } %&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/article&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-show-template"&gt;
    &lt;div class="discussion-post"&gt;
    &lt;header class="post-header"&gt;
        &lt;% if (!readOnly) { %&gt;
            &lt;div class="post-header-actions"&gt;
                &lt;%=
                _.template(
                    $('#forum-actions').html())(
                    {
                        contentId: cid,
                        contentType: 'post',
                        primaryActions: ['vote', 'follow'],
                        secondaryActions: ['pin', 'edit', 'delete', 'report', 'close'],
                        readOnly: readOnly
                    }
                )
                %&gt;
            &lt;/div&gt;
        &lt;% } %&gt;
        &lt;div class="post-header-content"&gt;
            &lt;h4 class="post-title"&gt;&lt;%- title %&gt;&lt;/h4&gt;
            &lt;p class="posted-details"&gt;
            &lt;%
            var timeAgoHtml = interpolate(
                '&lt;span class="timeago" title="%(created_at)s"&gt;%(created_at)s&lt;/span&gt;',
                {created_at: created_at},
                true
            );
            %&gt;
            &lt;%=
            interpolate(
                // Translators: post_type describes the kind of post this is (e.g. "question" or "discussion");
                // time_ago is how much time has passed since the post was created (e.g. "4 hours ago")
                _.escape(gettext('%(post_type)s posted %(time_ago)s by %(author)s')),
                {post_type: thread_type, time_ago: timeAgoHtml, author: author_display},
                true
            )
            %&gt;
            &lt;/p&gt;
            &lt;div class="post-labels"&gt;
                &lt;span class="post-label post-label-pinned"&gt;
                    &lt;span class="icon fa fa-thumb-tack" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Pinned") %&gt;
                &lt;/span&gt;
                &lt;span class="post-label post-label-reported"&gt;
                    &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Reported") %&gt;
                &lt;/span&gt;
                &lt;span class="post-label post-label-closed"&gt;
                    &lt;span class="icon fa fa-lock" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Closed") %&gt;
                &lt;/span&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/header&gt;

    &lt;div class="post-body"&gt;&lt;%- body %&gt;&lt;/div&gt;
    &lt;div class="post-context"&gt;
        &lt;% if (mode === "tab" &amp;&amp; obj.courseware_url) { %&gt;
            &lt;%
            var courseware_title_linked = interpolate(
                '&lt;a href="%(courseware_url)s"&gt;%(courseware_title)s&lt;/a&gt;',
                {courseware_url: courseware_url, courseware_title: _.escape(courseware_title)},
                true
            );
            %&gt;
            &lt;%=
            interpolate(
                _.escape(gettext('Related to: %(courseware_title_linked)s')),
                {courseware_title_linked: courseware_title_linked},
                true
            )
            %&gt;
        &lt;% } %&gt;
        &lt;div class="group-visibility-label"&gt;
            &lt;% if (obj.group_name) { %&gt;
                &lt;%-
                interpolate(
                    gettext('This post is visible only to %(group_name)s.'),
                    {group_name: obj.group_name},
                    true
                )
                %&gt;
            &lt;% } else { %&gt;
                &lt;%- gettext('This post is visible to everyone.') %&gt;
            &lt;% } %&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-edit-template"&gt;
    &lt;h4&gt;&lt;%- gettext("Editing post") %&gt;&lt;/h4&gt;
&lt;ul class="post-errors"&gt;&lt;/ul&gt;
&lt;div class="forum-edit-post-form-wrapper"&gt;&lt;/div&gt;
&lt;div class="post-field"&gt;
    &lt;label class="field-label"&gt;
        &lt;span class="field-label-text"&gt;&lt;%- gettext("Title") %&gt;&lt;/span&gt;
        &lt;div class="field-help" id="field_help_title"&gt;
            &lt;%- gettext("Add a clear and descriptive title to encourage participation.") %&gt;
        &lt;/div&gt;
        &lt;input aria-describedby="field_help_title" type="text" class="edit-post-title field-input" name="title" value="&lt;%- title %&gt;"&gt;
    &lt;/label&gt;
&lt;/div&gt;
&lt;div class="form-row post-field"&gt;
    &lt;p class="sr-only field-help" id="edit-post-editor-description"&gt;&lt;%- gettext('Edit your post below.') %&gt;&lt;/p&gt;
    &lt;div class="edit-post-body" aria-describedby="edit-post-editor-description" name="body"&gt;&lt;%- body %&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;button type="submit" id="edit-post-submit" class="btn-brand submit post-update"&gt;&lt;%- gettext("Update post") %&gt;&lt;/button&gt;
&lt;button class="btn post-cancel"&gt;&lt;%- gettext("Cancel") %&gt;&lt;/button&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-response-template"&gt;
    &lt;div class="discussion-response"&gt;&lt;/div&gt;
&lt;button class="btn-link action-show-comments"&gt;
    &lt;%
    var fmts = ngettext("Show Comment (%(num_comments)s)", "Show Comments (%(num_comments)s)", comments.length);
    print(interpolate(fmts, {num_comments: comments.length}, true));
    %&gt;
    &lt;span class="icon fa fa-caret-down" aria-hidden="true"&gt;&lt;/span&gt;
&lt;/button&gt;
&lt;ol class="comments"&gt;
    &lt;li class="new-comment"&gt;
        &lt;% if (create_sub_comment &amp;&amp; !readOnly) { %&gt;
            &lt;form class="comment-form" data-id="&lt;%- wmdId %&gt;"&gt;
                &lt;ul class="discussion-errors"&gt;&lt;/ul&gt;
                &lt;label class="sr" for="add-new-comment-&lt;%- wmdId %&gt;"&gt;&lt;%- gettext("Add a comment") %&gt;&lt;/label&gt;
                &lt;div class="comment-body" id="add-new-comment-&lt;%- wmdId %&gt;" data-id="&lt;%- wmdId %&gt;"
                data-placeholder="&lt;%- gettext('Add a comment') %&gt;"&gt;&lt;/div&gt;
                &lt;div class="comment-post-control"&gt;
                    &lt;button class="btn-brand discussion-submit-comment control-button"&gt;&lt;%- gettext("Submit") %&gt;&lt;/button&gt;
                &lt;/div&gt;
            &lt;/form&gt;
        &lt;% } %&gt;
    &lt;/li&gt;
&lt;/ol&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-response-show-template"&gt;
    &lt;header class="response-header"&gt;
  &lt;div class="response-header-content"&gt;
    &lt;%= author_display %&gt;
    &lt;p class="posted-details"&gt;
        &lt;span class="timeago" title="&lt;%= created_at %&gt;"&gt;&lt;%= created_at %&gt;&lt;/span&gt;
        &lt;% if (obj.endorsement &amp;&amp; obj.endorsed) { %&gt;
            -
            &lt;%
            var fmt = null;
            if (thread.get("thread_type") == "question") {
              if (endorsement.username) {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("marked as answer %(time_ago)s by %(user)s");
              } else {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("marked as answer %(time_ago)s");
              }
            } else {
              if (endorsement.username) {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("endorsed %(time_ago)s by %(user)s");
              } else {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("endorsed %(time_ago)s");
              }
            }
            var time_ago = interpolate(
              '&lt;span class="timeago" title="%(time)s"&gt;%(time)s&lt;/span&gt;',
              {time: endorsement.time},
              true
            );
            %&gt;
            &lt;%= interpolate(fmt, {time_ago: time_ago, user: endorser_display}, true) %&gt;
        &lt;% } %&gt;
      &lt;/p&gt;
      &lt;div class="post-labels"&gt;
          &lt;span class="post-label post-label-reported"&gt;
              &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Reported") %&gt;
          &lt;/span&gt;
      &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="response-header-actions"&gt;
        &lt;%=
            _.template(
                $('#forum-actions').html())(
                {
                    contentId: cid,
                    contentType: 'response',
                    primaryActions: ['vote', thread.get('thread_type') == 'question' ? 'answer' : 'endorse'],
                    secondaryActions: ['edit', 'delete', 'report'],
                    readOnly: readOnly
                }
            )
        %&gt;
      &lt;/div&gt;
&lt;/header&gt;

&lt;div class="response-body"&gt;&lt;%- body %&gt;&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-response-edit-template"&gt;
    &lt;div class="edit-post-form"&gt;
    &lt;h1&gt;&lt;%- gettext("Editing response") %&gt;&lt;/h1&gt;
    &lt;ul class="edit-post-form-errors"&gt;&lt;/ul&gt;
    &lt;div class="form-row"&gt;
        &lt;div class="edit-post-body" name="body" data-id="&lt;%- id %&gt;"&gt;&lt;%- body %&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;button type="submit" id="edit-response-submit"class="btn-brand post-update"&gt;&lt;%- gettext("Update response") %&gt;&lt;/button&gt;
    &lt;button class="btn post-cancel"&gt;&lt;%- gettext("Cancel") %&gt;&lt;/button&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="response-comment-show-template"&gt;
    &lt;div class="discussion-comment" id="comment_&lt;%- id %&gt;"&gt;
  &lt;div class="response-body"&gt;&lt;%- body %&gt;&lt;/div&gt;
  &lt;%=
      _.template(
          $('#forum-actions').html())(
          {
              contentId: cid,
              contentType: 'comment',
              primaryActions: [],
              secondaryActions: ['edit', 'delete', 'report'],
              readOnly: readOnly
          }
      )
  %&gt;
  &lt;p class="posted-details"&gt;
    &lt;%
    var time_ago = interpolate(
      '&lt;span class="timeago" title="%(time)s"&gt;%(time)s&lt;/span&gt;',
      {time: created_at},
      true
    );
    %&gt;
    &lt;%= interpolate(
      // Translators: 'timeago' is a placeholder for a fuzzy, relative timestamp (see: https://github.com/rmm5t/jquery-timeago)
      gettext("posted %(time_ago)s by %(author)s"),
      {time_ago: time_ago, author: author_display},
      true
    ) %&gt;
  &lt;/p&gt;
  &lt;div class="post-labels"&gt;
    &lt;span class="post-label post-label-reported"&gt;
      &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Reported") %&gt;
    &lt;/span&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="response-comment-edit-template"&gt;
    &lt;div class="edit-post-form" id="comment_&lt;%- id %&gt;"&gt;
    &lt;h1&gt;&lt;%- gettext("Editing comment") %&gt;&lt;/h1&gt;
    &lt;ul class="edit-comment-form-errors"&gt;&lt;/ul&gt;
    &lt;div class="form-row"&gt;
        &lt;div class="edit-comment-body" name="body" data-id="&lt;%- id %&gt;"&gt;&lt;%- body %&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;button type="submit" id="edit-comment-submit" class="btn-brand post-update"&gt;&lt;%- gettext("Update comment") %&gt;&lt;/button&gt;
    &lt;button class="btn post-cancel"&gt;&lt;%- gettext("Cancel") %&gt;&lt;/button&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-list-item-template"&gt;
    &lt;li data-id="&lt;%- id %&gt;" class="forum-nav-thread&lt;% if (neverRead) { %&gt; never-read&lt;% } %&gt;"&gt;
  &lt;a href="&lt;%- threadUrl %&gt;" class="forum-nav-thread-link"&gt;
    &lt;div class="forum-nav-thread-wrapper-0"&gt;
      &lt;%
      var icon_class, sr_text;
      if (thread_type === "discussion") {
          icon_class = "fa-comments";
          // Translators: This is a label for a Discussion forum thread
          sr_text = gettext("discussion");
      } else if (endorsed) {
          icon_class = "fa-check-square-o";
          // Translators: This is a label for a Question forum thread with a marked answer
          sr_text = gettext("answered question");
      } else {
          icon_class = "fa-question";
          // Translators: This is a label for a Question forum thread without a marked answer
          sr_text = gettext("unanswered question");
      }
      %&gt;
      &lt;span class="sr"&gt;&lt;%= sr_text %&gt;&lt;/span&gt;
      &lt;span class="icon fa &lt;%= icon_class %&gt;" aria-hidden="true"&gt;&lt;/span&gt;
    &lt;/div&gt;&lt;div class="forum-nav-thread-wrapper-1"&gt;
      &lt;span class="forum-nav-thread-title"&gt;&lt;%- title %&gt;&lt;/span&gt;
      &lt;% if (showThreadPreview){ %&gt;
        &lt;div class="thread-preview-body"&gt;&lt;%- threadPreview %&gt;&lt;/div&gt;
      &lt;% } %&gt;
      &lt;% if(typeof(subscribed) === "undefined") { var subscribed = null; } %&gt;
      &lt;% if(pinned || subscribed || staff_authored || community_ta_authored) { %&gt;
        &lt;ul class="forum-nav-thread-labels"&gt;
        &lt;% if (pinned) { %&gt;
          &lt;li class="post-label post-label-pinned"&gt;
            &lt;span class="icon fa fa-thumb-tack" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that has been pinned %&gt;
            &lt;%- gettext("Pinned") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (subscribed) { %&gt;
          &lt;li class="post-label post-label-following"&gt;
            &lt;span class="icon fa fa-star" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that the user is subscribed to %&gt;
            &lt;%- gettext("Following") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (staff_authored) { %&gt;
          &lt;li class="post-label post-label-by-staff"&gt;
            &lt;span class="icon fa fa-user" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that was authored by a member of the course staff %&gt;
            &lt;%- gettext("Staff") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (community_ta_authored) { %&gt;
          &lt;li class="post-label post-label-by-community-ta"&gt;
            &lt;span class="icon fa fa-user" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that was authored by a community TA %&gt;
            &lt;%- gettext("Community TA") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;/ul&gt;
      &lt;% } %&gt;
    &lt;/div&gt;&lt;div class="forum-nav-thread-wrapper-2"&gt;
      &lt;%
      // Translators: 'votes_count' is a numerical placeholder for a specific discussion thread; 'span_start' and 'span_end' placeholders refer to HTML markup.  Please translate the word 'votes'.
      var fmt = ngettext(
           "%(votes_count)s%(span_start)s vote %(span_end)s",
           "%(votes_count)s%(span_start)s votes %(span_end)s",
           votes['up_count']
      );
      %&gt;
      &lt;span class="forum-nav-thread-votes-count"&gt;
      +&lt;%= interpolate(fmt, {
               votes_count: votes['up_count'],
               span_start: '&lt;span class="sr"&gt;',
               span_end: '&lt;/span&gt;'
            }, true)
      %&gt;
      &lt;/span&gt;

      &lt;% if (!neverRead &amp;&amp; unread_comments_count &gt; 0) { %&gt;
        &lt;span class="forum-nav-thread-unread-comments-count"&gt;
          &lt;%-
            StringUtils.interpolate(
              gettext('{unread_comments_count} new'),
              {unread_comments_count: unread_comments_count}
            )
          %&gt;
        &lt;/span&gt;
      &lt;% } %&gt;

      &lt;span class="forum-nav-thread-comments-count"&gt;
      &lt;%
      var fmt;
      // Counts in data do not include the post itself, but the UI should
      var data = {
          'span_sr_open': '&lt;span class="sr"&gt;',
          'span_close': '&lt;/span&gt;',
          'unread_comments_count': unread_comments_count + (read ? 0 : 1),
          'comments_count': comments_count + 1
      };
      if (unread_comments_count &gt; 0) {
          // Translators: 'comments_count' and 'unread_comments_count' are numerical placeholders for a specific discussion thread; 'span_*' placeholders refer to HTML markup.  Please translate the word 'comments'.
          fmt = gettext('%(comments_count)s %(span_sr_open)scomments (%(unread_comments_count)s unread comments)%(span_close)s');
      } else {
          // Translators: 'comments_count' is a numerical placeholder for a specific discussion thread; 'span_*' placeholders refer to HTML markup.  Please translate the word 'comments'.
          fmt = gettext('%(comments_count)s %(span_sr_open)scomments %(span_close)s');
      }
      print(interpolate(fmt, data, true));
      %&gt;
      &lt;/span&gt;
    &lt;/div&gt;
  &lt;/a&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="search-alert-template"&gt;
    &lt;div class="search-alert &lt;%- css_class %&gt;" id="search-alert-&lt;%- cid %&gt;"&gt;
    &lt;div class="search-alert-content"&gt;
        &lt;p class="message"&gt;&lt;%= HtmlUtils.ensureHtml(messageHtml) %&gt;&lt;/p&gt;
    &lt;/div&gt;

    &lt;div class="search-alert-controls"&gt;
        &lt;button class="btn-link dismiss control control-dismiss" title="&lt;%- gettext('Close') %&gt;"&gt;
            &lt;span class="icon fa fa-remove" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/button&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-template"&gt;
    &lt;form class="forum-new-post-form"&gt;
    &lt;h3 class="thread-title"&gt;&lt;%- gettext("Add a Post") %&gt;&lt;/h3&gt;
    &lt;% if (mode === 'inline') { %&gt;
        &lt;button class="btn-default add-post-cancel"&gt;
            &lt;span class="sr"&gt;&lt;%- gettext('Cancel') %&gt;&lt;/span&gt;
            &lt;span class="fa fa-close" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/button&gt;
    &lt;% } %&gt;
    &lt;ul class="post-errors" style="display: none"&gt;&lt;/ul&gt;
    &lt;div class="forum-new-post-form-wrapper"&gt;&lt;/div&gt;
    &lt;% if (cohort_options) { %&gt;
    &lt;div class="post-field group-selector-wrapper &lt;% if (!is_commentable_cohorted) { print('disabled'); } %&gt;"&gt;
        &lt;label class="field-label"&gt;
            &lt;span class="field-label-text"&gt;
                &lt;% //Translators: This labels the selector for which group of students can view a post %&gt;
                &lt;%- gettext("Visible to") %&gt;
            &lt;/span&gt;
            &lt;div class="field-help" id="field_help_visible_to"&gt;
                &lt;%- gettext("Discussion admins, moderators, and TAs can make their posts visible to all students or specify a single cohort.") %&gt;
            &lt;/div&gt;
            &lt;div class="field-input"&gt;
                &lt;select aria-describedby="field_help_visible_to" class="post-topic field-input js-group-select" name="group_id" &lt;% if (!is_commentable_cohorted) { print("disabled"); } %&gt;&gt;
                    &lt;option value=""&gt;&lt;%- gettext("All Groups") %&gt;&lt;/option&gt;
                    &lt;% _.each(cohort_options, function(opt) { %&gt;
                    &lt;option value="&lt;%- opt.value %&gt;" &lt;% if (opt.selected) { print("selected"); } %&gt;&gt;&lt;%- opt.text %&gt;&lt;/option&gt;
                    &lt;% }); %&gt;
                &lt;/select&gt;
            &lt;/div&gt;
        &lt;/label&gt;
    &lt;/div&gt;
    &lt;% } %&gt;
    &lt;div class="post-field"&gt;
        &lt;label class="field-label"&gt;
            &lt;span class="field-label-text"&gt;&lt;%- gettext("Title") %&gt;&lt;/span&gt;
            &lt;div class="field-help" id="field_help_title"&gt;
                &lt;%- gettext("Add a clear and descriptive title to encourage participation.") %&gt;
            &lt;/div&gt;
            &lt;div&gt;
                &lt;input aria-describedby="field_help_title" type="text" class="js-post-title field-input" name="title"&gt;
            &lt;/div&gt;
        &lt;/label&gt;
    &lt;/div&gt;

    &lt;div&gt;
        &lt;span class="field-label-text field-label-text-full" id="new-post-editor-description"&gt;&lt;%- gettext('Your question or idea') %&gt;&lt;/span&gt;
        &lt;div class="js-post-body editor" aria-describedby="new-post-editor-description" name="body"&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="post-options"&gt;
        &lt;label class="post-option is-enabled"&gt;
            &lt;input type="checkbox" name="follow" class="post-option-input js-follow" checked&gt;
            &lt;span class="icon fa fa-star" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("follow this post") %&gt;
        &lt;/label&gt;
        &lt;% if (allow_anonymous) { %&gt;
        &lt;label class="post-option"&gt;
            &lt;input type="checkbox" name="anonymous" class="post-option-input js-anon"&gt;
            &lt;%- gettext("post anonymously") %&gt;
        &lt;/label&gt;
        &lt;% } %&gt;
        &lt;% if (allow_anonymous_to_peers) { %&gt;
        &lt;label class="post-option"&gt;
            &lt;input type="checkbox" name="anonymous_to_peers" class="post-option-input js-anon-peers"&gt;
            &lt;%- gettext("post anonymously to classmates") %&gt;
        &lt;/div&gt;
        &lt;% } %&gt;
    &lt;/div&gt;
    &lt;div&gt;
        &lt;button type="submit" class="btn-brand submit"&gt;&lt;%- gettext('Submit') %&gt;&lt;/button&gt;
        &lt;button type="button" class="btn cancel"&gt;&lt;%- gettext('Cancel') %&gt;&lt;/button&gt;
    &lt;/div&gt;
&lt;/form&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-menu-entry-template"&gt;
    &lt;option class="topic-title" data-discussion-id="&lt;%- id %&gt;" data-cohorted="&lt;%- is_cohorted %&gt;"&gt;&lt;%- text %&gt;&lt;/option&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-menu-category-template"&gt;
    &lt;optgroup label="&lt;%- text %&gt;"&gt;
    &lt;%= edx.HtmlUtils.ensureHtml(entries) %&gt;
&lt;/optgroup&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-alert-template"&gt;
    &lt;div class="alert alert-error pattern-library-shim" role="alert" aria-labelledby="alert-title-error-&lt;%- alertId %&gt;" tabindex="-1"&gt;
    &lt;span class="icon alert-icon fa fa-warning" aria-hidden="true"&gt;&lt;/span&gt;

    &lt;div class="alert-message"&gt;
        &lt;h3 class="sr-only alert-title" id="alert-title-error-&lt;%- alertId %&gt;"&gt;
            &lt;%- gettext("Error posting your message.") %&gt;
        &lt;/h3&gt;

        &lt;p class="alert-copy"&gt;
            &lt;%- gettext(message) %&gt;
        &lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="topic-template"&gt;
    &lt;div class="post-field"&gt;
    &lt;label class="field-label"&gt;
        &lt;span class="field-label-text"&gt;
            &lt;%- gettext("Topic area") %&gt;
        &lt;/span&gt;
        &lt;div class="field-help" id="field_help_topic_area"&gt;
            &lt;%- gettext("Add your post to a relevant topic to help others find it.") %&gt;
        &lt;/div&gt;
        &lt;div class="field-input"&gt;
            &lt;select class="post-topic field-input" aria-describedby="field_help_topic_area" required&gt;
                &lt;%= edx.HtmlUtils.ensureHtml(topics_html) %&gt;
            &lt;/select&gt;
        &lt;/div&gt;
    &lt;/label&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="post-user-display-template"&gt;
    &lt;% if (username) { %&gt;
&lt;a href="&lt;%- user_url %&gt;" class="username"&gt;&lt;%- username %&gt;&lt;/a&gt;
    &lt;% if (is_community_ta) { %&gt;
    &lt;span class="user-label-community-ta"&gt;&lt;%- gettext("Community TA") %&gt;&lt;/span&gt;
    &lt;% } else if (is_staff) { %&gt;
    &lt;span class="user-label-staff"&gt;&lt;%- gettext("Staff") %&gt;&lt;/span&gt;
    &lt;% } %&gt;
&lt;% } else { %&gt;
    &lt;%- gettext('anonymous') %&gt;
&lt;% } %&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="inline-discussion-template"&gt;
    &lt;section class="discussion inline-discussion" data-discussion-id="&lt;%- discussionId %&gt;"&gt;
    &lt;div class="add_post_btn_container &lt;%if (read_only) {%&gt;is-hidden&lt;%} %&gt;"&gt;
        &lt;button class="btn-link new-post-btn"&gt;&lt;%- gettext("Add a Post") %&gt;&lt;/button&gt;
    &lt;/div&gt;

    &lt;article class="new-post-article is-hidden"&gt;&lt;/article&gt;

    &lt;div class="inline-discussion-thread-container"&gt;
        &lt;section class="inline-threads"&gt;
        &lt;/section&gt;

        &lt;div class="inline-thread"&gt;
            &lt;div class="forum-nav-bar"&gt;
                &lt;button class="btn-link all-posts-btn"&gt;
                    &lt;span class="icon fa fa-chevron-prev" aria-hidden="true"&gt;&lt;/span&gt;
                    &lt;span aria-hidden="true"&gt;&lt;%- gettext('All Posts') %&gt;&lt;/span&gt;
                    &lt;span class="sr-only"&gt;&lt;%- gettext('Return to all posts') %&gt;&lt;/span&gt;
                &lt;/button&gt;
            &lt;/div&gt;
            &lt;div class="forum-content"&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/section&gt;


&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="pagination-template"&gt;
    &lt;nav class="discussion-paginator"&gt;
    &lt;ol&gt;
        &lt;% if (previous) { %&gt;
            &lt;li class="previous-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= previous.url %&gt;" data-page-number="&lt;%= previous.number %&gt;"&gt;&amp;lt; &lt;%- gettext("Previous") %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (first) { %&gt;
            &lt;li class="first-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= first.url %&gt;" data-page-number="1"&gt;1&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (leftdots) { %&gt;
            &lt;li class="previous-ellipses"&gt;&lt;%- gettext("…") %&gt;&lt;/li&gt;
        &lt;% } %&gt;

        &lt;% _.each(lowPages, function(page) { %&gt;
            &lt;li class="lower-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= page.url %&gt;" data-page-number="&lt;%= page.number %&gt;"&gt;&lt;%= page.number %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% }); %&gt;
        &lt;li class="current-page"&gt;&lt;span&gt;&lt;%= page %&gt;&lt;/span&gt;&lt;/li&gt;
        &lt;% _.each(highPages, function(page) { %&gt;
            &lt;li class="higher-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= page.url %&gt;" data-page-number="&lt;%= page.number %&gt;"&gt;&lt;%= page.number %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% }); %&gt;

        &lt;% if (rightdots) { %&gt;
            &lt;li class="next-ellipses"&gt;&lt;%- gettext("…") %&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (last) { %&gt;
            &lt;li class="last-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= last.url %&gt;" data-page-number="&lt;%= last.number %&gt;"&gt;&lt;%= last.number %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (next) { %&gt;
            &lt;li class="next-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= next.url %&gt;" data-page-number="&lt;%= next.number %&gt;"&gt;&lt;%- gettext("Next") %&gt; &amp;gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
    &lt;/ol&gt;
&lt;/nav&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="profile-thread-template"&gt;
    &lt;article class="discussion-article" data-id="&lt;%- id %&gt;"&gt;
    &lt;div class="discussion-post"&gt;
        &lt;header&gt;
            &lt;h3&gt;&lt;%- title %&gt;&lt;/h3&gt;
            &lt;p class="posted-details"&gt;
                &lt;% if (user) { %&gt;
                    &lt;a href="&lt;%- user.url %&gt;" class="username"&gt;&lt;%- user.username %&gt;&lt;/a&gt;
                &lt;% } else { %&gt;
                    &lt;%- gettext("anonymous") %&gt;
                &lt;% } %&gt;

                &lt;span class="timeago" title="&lt;%- created_at %&gt;"&gt;&lt;%- created_at %&gt;&lt;/span&gt;
                &lt;span class="post-status-closed top-post-status" style="display: none"&gt;
                    &amp;bull; &lt;%- gettext("This thread is closed.") %&gt;
                &lt;/span&gt;
            &lt;/p&gt;
        &lt;/header&gt;
        &lt;div class="post-body"&gt;&lt;%= abbreviatedBody %&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="post-tools"&gt;
        &lt;a href="&lt;%- permalink %&gt;"&gt;&lt;%- gettext("View discussion") %&gt;&lt;/a&gt;
    &lt;/div&gt;

&lt;/article&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="customwmd-prompt-template"&gt;
    &lt;h4 id="editor-dialog-title"&gt;&lt;%- title %&gt;&lt;/h4&gt;
&lt;div role="status" id="wmd-editor-dialog-form-errors" class="sr" tabindex="-1"&gt;&lt;/div&gt;
&lt;div&gt;
    &lt;form class="form"&gt;
        &lt;fieldset class="field-group"&gt;
            &lt;legend class="form-group-hd sr"&gt;&lt;%- title %&gt;&lt;/legend&gt;
            &lt;div class="field &lt;%- uploadFieldClass %&gt;"&gt;
                &lt;label id="new-url-input-label" for="new-url-input" class="field-label"&gt;
                    &lt;%- urlLabel %&gt;&lt;/label&gt;
                &lt;input type="text" id="new-url-input" class="field-input input-text" aria-describedby="new-url-input-help"&gt;
                &lt;% if (imageUploadHandler) { %&gt;
                    &lt;button id="file-upload-proxy" class="btn btn-primary btn-base form-btn"&gt;
                        &lt;%- chooseFileText %&gt;
                    &lt;/button&gt;
                    &lt;input type="file" name="file-upload" id="file-upload" style="display:none;"/&gt;
                &lt;% } %&gt;
                &lt;div id="new-url-input-field-message" class="field-message has-error" style="display:none"&gt;
                    &lt;span class="field-message-content"&gt;&lt;%- urlError %&gt;&lt;/span&gt;
                &lt;/div&gt;
                &lt;div id="new-url-input-help" class="field-hint"&gt;
                    &lt;%- urlHelp %&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="field"&gt;
                &lt;label for="new-url-desc-input" class="field-label"&gt;&lt;%- urlDescLabel %&gt;&lt;/label&gt;
                &lt;input type="text" id="new-url-desc-input" class="field-input input-text" required aria-describedby="new-url-desc-input-help"&gt;
                &lt;div id="new-url-desc-input-field-message" class="field-message has-error" style="display:none"&gt;
                    &lt;span class="field-message-content"&gt;&lt;%- descError %&gt;&lt;/span&gt;
                &lt;/div&gt;
                &lt;div id="new-url-desc-input-help" class="field-hint"&gt;
                    &lt;%- urlDescHelp %&gt;
                    &lt;% if (urlDescHelpLink) { %&gt;
                        &lt;a href="&lt;%- urlDescHelpLink['href'] %&gt;"&gt;
                            &lt;%- urlDescHelpLink['text'] %&gt;
                        &lt;/a&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="field"&gt;&lt;% if (imageUploadHandler) { %&gt;
                &lt;label for="img-is-decorative" class="field-label label-inline"&gt;
                    &lt;input type="checkbox" id="img-is-decorative" class="field-input input-checkbox"&gt;
                    &lt;span class="field-input-label"&gt;&lt;%- imageIsDecorativeLabel %&gt;&lt;/span&gt;
                &lt;/label&gt; &lt;% }
            %&gt;&lt;/div&gt;
        &lt;/fieldset&gt;
        &lt;div class="form-actions"&gt;
            &lt;input type="button" id="new-link-image-ok" class="btn-brand form-btn" value="&lt;%- okText %&gt;" /&gt;
            &lt;input type="button" id="new-link-image-cancel" class="btn form-btn" value="&lt;%- cancelText %&gt;" &gt;
        &lt;/div&gt;
    &lt;/form&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="nav-loading-template"&gt;
    &lt;div class="forum-nav-loading" tabindex="0"&gt;
    &lt;span class="icon fa fa-spinner fa-spin"/&gt;
    &lt;span class="sr" role="alert"&gt;&lt;%- srText %&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-type-template"&gt;
    &lt;div class="post-field"&gt;
    &lt;div class="field-label"&gt;
        &lt;span class="field-label-text"&gt;
            &lt;% // Translators: This is the label for a control to select a forum post type %&gt;
            &lt;%- gettext("Post type") %&gt;
        &lt;/span&gt;
        &lt;div class="field-help" id="field_help_post_type"&gt;
            &lt;%- gettext("Questions raise issues that need answers. Discussions share ideas and start conversations.") %&gt;
        &lt;/div&gt;
        &lt;div class="field-label"&gt;
            &lt;fieldset class="field-input"&gt;
                &lt;legend class="sr"&gt;&lt;%- gettext("Post type") %&gt;&lt;/legend&gt;
                &lt;input aria-describedby="field_help_post_type" type="radio" name="&lt;%= form_id %&gt;-post-type" class="post-type-input" id="&lt;%= form_id %&gt;-post-type-question" value="question"&gt;
                &lt;label for="&lt;%= form_id %&gt;-post-type-question" class="post-type-label"&gt;
                    &lt;span class="icon fa fa-question" aria-hidden="true"&gt;&lt;/span&gt;
                    &lt;% // Translators: This is a forum post type %&gt;
                    &lt;%- gettext("Question") %&gt;
                &lt;/label&gt;
                &lt;input aria-describedby="field_help_post_type" type="radio" name="&lt;%= form_id %&gt;-post-type" class="post-type-input" id="&lt;%= form_id %&gt;-post-type-discussion" value="discussion" checked&gt;
                &lt;label for="&lt;%= form_id %&gt;-post-type-discussion" class="post-type-label"&gt;
                    &lt;span class="icon fa fa-comments" aria-hidden="true"&gt;&lt;/span&gt;
                    &lt;% // Translators: This is a forum post type %&gt;
                    &lt;%- gettext("Discussion") %&gt;
                &lt;/label&gt;
            &lt;/fieldset&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;


&lt;script aria-hidden="true" type="text/template" id="forum-action-endorse"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-button action-endorse" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Endorse") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Endorse") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unendorse") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-check" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-answer"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-button action-answer" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Mark as Answer") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Mark as Answer") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unmark as Answer") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-check" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-follow"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-button action-follow" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Follow") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Follow") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unfollow") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-star" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-vote"&gt;
    &lt;li class="actions-item"&gt;
    &lt;span aria-hidden="true" class="display-vote is-hidden" &gt;
      &lt;span class="vote-count"&gt;&lt;/span&gt;
    &lt;/span&gt;
    &lt;button class="btn-link action-button action-vote" role="checkbox" aria-checked="false"&gt;
        &lt;% // Vote counts are populated by JS %&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Vote for this post,") %&gt;&amp;nbsp;&lt;/span&gt;
        &lt;span class="sr js-sr-vote-count"&gt;&lt;/span&gt;

        &lt;span class="action-label" aria-hidden="true"&gt;
          &lt;span class="vote-count"&gt;&lt;/span&gt;
        &lt;/span&gt;

        &lt;span class="action-icon" aria-hidden="true"&gt;
            &lt;span class="icon fa fa-plus" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-report"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-report" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Report abuse") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Report") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unreport") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;
          &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-pin"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-pin" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Pin") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Pin") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unpin") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;
          &lt;span class="icon fa fa-thumb-tack" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-close"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-close" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Close") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Close") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Open") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;
          &lt;span class="icon fa fa-lock" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-edit"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-edit"&gt;
        &lt;span class="action-label"&gt;&lt;%- gettext("Edit") %&gt;&lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-pencil" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-delete"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-delete"&gt;
        &lt;span class="action-label"&gt;&lt;%- gettext("Delete") %&gt;&lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-remove" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-actions"&gt;
    &lt;% if (!readOnly) { %&gt;
    &lt;ul class="&lt;%= contentType %&gt;-actions-list"&gt;
        &lt;% _.each(primaryActions, function(action) { print(_.template($('#forum-action-' + action).html())({})) }) %&gt;
        &lt;li class="actions-item is-visible"&gt;
            &lt;div class="more-wrapper"&gt;
                &lt;button class="btn-link action-button action-more" aria-label="&lt;%- gettext('More') %&gt;" aria-haspopup="true" aria-controls="action-menu-&lt;%= contentType %&gt;"&gt;
                    &lt;span class="action-label"&gt;&lt;%- gettext('More') %&gt;&lt;/span&gt;
                    &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-ellipsis-h" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;/button&gt;
                &lt;div class="actions-dropdown" id="action-menu-&lt;%= contentType %&gt;" aria-expanded="false"&gt;
                  &lt;ul class="actions-dropdown-list"&gt;
                    &lt;% _.each(secondaryActions, function(action) { print(_.template($('#forum-action-' + action).html())({})) }) %&gt;
                  &lt;/ul&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/li&gt;
    &lt;/ul&gt;
&lt;% } %&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="alert-popup"&gt;
    &lt;div class='modal' role='alertdialog' id='discussion-alert' aria-describedby='discussion-alert-message'&gt;
    &lt;div class='inner-wrapper discussion-alert-wrapper'&gt;
        &lt;button class='btn close-modal dismiss' title='&lt;%- gettext("Close") %&gt;''&gt;
            &lt;span class='icon fa fa-times' aria-hidden='true'&gt;&lt;/span&gt;
        &lt;/button&gt;
        &lt;header&gt;
            &lt;h2/&gt;&lt;/h2&gt;
            &lt;hr/&gt;
        &lt;/header&gt;
        &lt;p id='discussion-alert-message'&gt;&lt;/p&gt;
        &lt;hr/&gt;
        &lt;button class='btn dismiss'&gt;&lt;%- gettext("OK") %&gt;&lt;/button&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="nav-load-more-link"&gt;
    &lt;li class='forum-nav-load-more'&gt;
    &lt;button class='btn-link forum-nav-load-more-link'&gt;
        &lt;%- gettext("Load more") %&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;



&lt;script type="text/template" id="thread-list-template"&gt;
    &lt;div class="forum-nav-thread-list-wrapper" id="sort-filter-wrapper" tabindex="-1"&gt;
        &lt;div class="forum-nav-refine-bar"&gt;
            &lt;label class="forum-nav-filter-main"&gt;
                &lt;span class="sr"&gt;Filter:&lt;/span&gt;
                &lt;select class="forum-nav-filter-main-control"&gt;
                    &lt;option value="all"&gt;显示全部&lt;/option&gt;
                    &lt;option value="unread"&gt;Unread&lt;/option&gt;
                    &lt;option value="unanswered"&gt;Unanswered&lt;/option&gt;
                &lt;/select&gt;
            &lt;/label&gt;&lt;% if (isCohorted &amp;&amp; isPrivilegedUser) { %&gt;&lt;label class="forum-nav-filter-cohort"&gt;
                &lt;span class="sr"&gt;Cohort:&lt;/span&gt;
                &lt;select class="forum-nav-filter-cohort-control"&gt;
                    &lt;option value=""&gt;in all cohorts&lt;/option&gt;
                &lt;/select&gt;
            &lt;/label&gt;&lt;% } %&gt;&lt;label class="forum-nav-sort"&gt;
                &lt;span class="sr"&gt;Sort:&lt;/span&gt;
                &lt;select class="forum-nav-sort-control"&gt;
                    &lt;option value="activity"&gt;近期活动&lt;/option&gt;
                    &lt;option value="comments"&gt;活跃度&lt;/option&gt;
                    &lt;option value="votes"&gt;最多票数&lt;/option&gt;
                &lt;/select&gt;
            &lt;/label&gt;
        &lt;/div&gt;
        &lt;div class="search-alerts"&gt;&lt;/div&gt;
        &lt;ul class="forum-nav-thread-list"&gt;&lt;/ul&gt;
    &lt;/div&gt;
&lt;/script&gt;




&lt;div class="discussion-module" data-discussion-id="29fcaf50336b78e3689c3ff7dee33dee2834a6e3"
    data-user-create-comment="true"
    data-user-create-subcomment="true"
    data-read-only="false"&gt;
    &lt;div class="discussion-module-header"&gt;
        &lt;h3 class="discussion-module-title"&gt;讨论&lt;/h3&gt;
        &lt;div class="inline-discussion-topic"&gt;&lt;span class="inline-discussion-topic-title"&gt;Topic:&lt;/span&gt; 管道与shell：管道 / 初窥管道&lt;/div&gt;
    &lt;/div&gt;
    &lt;button class="discussion-show btn" data-discussion-id="29fcaf50336b78e3689c3ff7dee33dee2834a6e3"&gt;
        &lt;span class="button-text"&gt;显示讨论&lt;/span&gt;
    &lt;/button&gt;
&lt;/div&gt;
&lt;script type="text/javascript"&gt;
var $$course_id = "course\u002Dv1:Internal+B3I062140+2019_T2";

function DiscussionInlineBlock(runtime, element) {
    'use strict';
    new DiscussionInlineView({ el: $(element).find('.discussion-module') });
}
&lt;/script&gt;

&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;

  </div>
  <div id="seq_contents_1" aria-labelledby="tab_1" aria-hidden="true" class="seq_contents tex2jax_ignore asciimath2jax_ignore">
    &lt;div class="xblock xblock-student_view xblock-student_view-vertical" data-runtime-class="LmsRuntime" data-init="VerticalStudentView" data-course-id="course-v1:Internal+B3I062140+2019_T2" data-request-token="03ca6f9e547511ea990d5254001c17d8" data-runtime-version="1" data-usage-id="block-v1:Internal+B3I062140+2019_T2+type@vertical+block@565c25ecc7834a358f420a5fe5def3e6" data-block-type="vertical"&gt;
  

  &lt;h3 class="unit-title"&gt;管道的测试&lt;/h3&gt;

    


&lt;div class="bookmark-button-wrapper"&gt;
  &lt;button class="btn btn-link bookmark-button "
    aria-pressed="false"
    data-bookmark-id="18231047,block-v1:Internal+B3I062140+2019_T2+type@vertical+block@565c25ecc7834a358f420a5fe5def3e6"&gt;
     &lt;span class="sr bookmark-sr"&gt;Click to add&lt;/span&gt;
     &lt;span class="bookmark-text"&gt;Bookmark this page&lt;/span&gt;
    &lt;/button&gt;
&lt;/div&gt;


&lt;div class="vert-mod"&gt;
  &lt;div class="vert vert-0" data-id="block-v1:Internal+B3I062140+2019_T2+type@html+block@a392397f64de4edf8ffb3f2043a122a2"&gt;
    &lt;div class="xblock xblock-student_view xblock-student_view-html xmodule_display xmodule_HtmlModule" data-runtime-class="LmsRuntime" data-init="XBlockToXModuleShim" data-block-type="html" data-request-token="03ca6f9e547511ea990d5254001c17d8" data-runtime-version="1" data-usage-id="block-v1:Internal+B3I062140+2019_T2+type@html+block@a392397f64de4edf8ffb3f2043a122a2" data-type="HTMLModule" data-course-id="course-v1:Internal+B3I062140+2019_T2"&gt;
  &lt;script type="json/xblock-args" class="xblock-json-init-args"&gt;
    {"xmodule-type": "HTMLModule"}
  &lt;/script&gt;
  &lt;p&gt;我们下面就来填充函数实现匿名管道的功能。思考刚才的代码样例，要实现匿名管道，至少需要有两个功能：管道读取、管道写入。&lt;/p&gt;
&lt;p&gt;要想实现管道，首先我们来看看本次实验我们将如何测试。lab6 关于管道的测试有两个，分别是&lt;span style="color: #808080;"&gt;&lt;em&gt;user/testpipe.c&lt;/em&gt;&lt;/span&gt;与&lt;span style="color: #808080;"&gt;&lt;em&gt;user/testpiperace.c。&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;首先我们来观察testpipe的内容&lt;/p&gt;
&lt;p&gt;&lt;code&gt;#include "lib.h"&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;char *msg =&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;"Now is the time for all good men to come to the aid of their party.";&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;void&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;umain(void)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;{&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;char buf[100];&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;int i, pid, p[2];&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;if ((i = pipe(p)) &amp;lt; 0) {&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;user_panic("pipe: %e", i);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;if ((pid = fork()) &amp;lt; 0) {&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;user_panic("fork: %e", i);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;if (pid == 0) {&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;writef("[%08x] pipereadeof close %d\n", env-&amp;gt;env_id, p[1]);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;close(p[1]);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;writef("[%08x] pipereadeof readn %d\n", env-&amp;gt;env_id, p[0]);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;i = readn(p[0], buf, sizeof buf - 1);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;if (i &amp;lt; 0) {&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;user_panic("read: %e", i);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;buf[i] = 0;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;if (strcmp(buf, msg) == 0) {&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;writef("\npipe read closed properly\n");&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;} else {&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;writef("\ngot %d bytes: %s\n", i, buf);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;exit();&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;} else {&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;writef("[%08x] pipereadeof close %d\n", env-&amp;gt;env_id, p[0]);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;close(p[0]);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;writef("[%08x] pipereadeof write %d\n", env-&amp;gt;env_id, p[1]);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;if ((i = write(p[1], msg, strlen(msg))) != strlen(msg)) {&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;user_panic("write: %e", i);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;close(p[1]);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;wait(pid);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;if ((i = pipe(p)) &amp;lt; 0) {&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;user_panic("pipe: %e", i);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;if ((pid = fork()) &amp;lt; 0) {&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;user_panic("fork: %e", i);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;if (pid == 0) {&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;close(p[0]);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;for (;;) {&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;writef(".");&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;if (write(p[1], "x", 1) != 1) {&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;break;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;writef("\npipe write closed properly\n");&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;close(p[0]);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;close(p[1]);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;wait(pid);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&lt;span style="white-space: pre;"&gt; &lt;/span&gt;writef("pipe tests passed\n");&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;实际上可以看出，测试文件使用 pipe 的流程和示例代码是一致的。先使用函数 pipe(int p[2])创建了管道，读端的文件控制块编号2为 p[0]，写端的文件控制块编号为 p[1]。之后使fork() 创建子进程，&lt;strong&gt;注意这时父子进程使用 p[0] 和 p[1] 访问到的内存区域一致&lt;/strong&gt;。之后子进程关闭了 p[1]，从 p[0] 读；父进程关闭了 p[0], 从 p[1] 写入管道。&lt;/p&gt;
&lt;p&gt;lab4 的实验中，我们的 fork 实现是完全遵循 Copy-On-Write 原则的，即对于所有用户态的地址空间都进行了 PTE_COW 的设置。但实际上写时复制并不完全适用，至少在我们当前情景下是不允许写时拷贝。为什么呢？我们来看看 pipe 函数中的关键部分就能知晓答案：&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;int&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;pipe(int pfd[2])&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;{&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 30px;"&gt;int r, va;&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 30px;"&gt;struct Fd *fd0, *fd1;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 30px;"&gt;if ((r = fd_alloc(&amp;amp;fd0)) &amp;lt; 0&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 30px;"&gt;|| (r = syscall_mem_alloc(0, (u_int)fd0, PTE_V|PTE_R|PTE_LIBRARY)) &amp;lt; 0)&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 60px;"&gt;goto err;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 30px;"&gt;if ((r = fd_alloc(&amp;amp;fd1)) &amp;lt; 0&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 30px;"&gt;&lt;span style="font-size: 1em;"&gt;|| (r = syscall_mem_alloc(0, (u_int)fd1, PTE_V|PTE_R|PTE_LIBRARY)) &amp;lt; 0)&lt;/span&gt;&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 60px;"&gt;goto err1;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 30px;"&gt;va = fd2data(fd0);&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 30px;"&gt;if ((r = syscall_mem_alloc(0, va, PTE_V|PTE_R|PTE_LIBRARY)) &amp;lt; 0)&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 60px;"&gt;goto err2;&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 30px;"&gt;if ((r = syscall_mem_map(0, va, 0, fd2data(fd1), PTE_V|PTE_R|PTE_LIBRARY)) &amp;lt; 0)&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 60px;"&gt;goto err3;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 30px;"&gt;...&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;}&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;在 pipe 中，首先分配两个文件描述符并为其分配空间，然后将一个管道作为这两个文件描述符数据区的第一页数据，从而使得这两个文件描述符能够共享一个管道的数据缓冲区。&lt;/p&gt;
&lt;p&gt;&lt;span style="color: #0000ff;"&gt;Exercise 6.1 仔细观察 pipe 中新出现的权限位PTE_LIBRARY，根据上述提示修改 fork系统调用，使得管道缓冲区是父子进程共享的，不设置为写时复制的模式。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;下面我们使用一张图来表示父子进程与管道的数据缓冲区的关系：&lt;/p&gt;
&lt;p&gt;&lt;img src="/assets/courseware/v1/69ccd6728760d027d89f49c25ac4e74e/asset-v1:Internal+B3I062140+2019_T2+type@asset+block/6-pipe-after-fork.jpg" alt="6-pipe-after-fork" type="saveimage" target="[object Object]" preventdefault="function(){r.isDefaultPrevented=n}" stoppropagation="function(){r.isPropagationStopped=n}" stopimmediatepropagation="function(){r.isImmediatePropagationStopped=n}" isdefaultprevented="function t(){return!1}" ispropagationstopped="function t(){return!1}" isimmediatepropagationstopped="function t(){return!1}" width="789" height="288" /&gt;&lt;/p&gt;
&lt;p&gt;实际上，在父子进程中各自 close 掉不再使用的端口后，父子进程与管道缓冲区的关系如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src="/assets/courseware/v1/11810bb7734bdf8b0657c0a68c2efa78/asset-v1:Internal+B3I062140+2019_T2+type@asset+block/6-pipe-after-close.jpg" alt="6-pipe-after-close" type="saveimage" target="[object Object]" preventdefault="function(){r.isDefaultPrevented=n}" stoppropagation="function(){r.isPropagationStopped=n}" stopimmediatepropagation="function(){r.isImmediatePropagationStopped=n}" isdefaultprevented="function t(){return!1}" ispropagationstopped="function t(){return!1}" isimmediatepropagationstopped="function t(){return!1}" width="789" height="288" /&gt;&lt;/p&gt;
&lt;p&gt;下面我们来讲一下struct Pipe，并开始着手填写操作管道端的函数。&lt;/p&gt;
&lt;/div&gt;

  &lt;/div&gt;
  &lt;div class="vert vert-1" data-id="block-v1:Internal+B3I062140+2019_T2+type@discussion+block@04dd2f9a156e4bb59cfa57114ea73c8c"&gt;
    &lt;div class="xblock xblock-student_view xblock-student_view-discussion" data-runtime-class="LmsRuntime" data-init="DiscussionInlineBlock" data-course-id="course-v1:Internal+B3I062140+2019_T2" data-request-token="03ca6f9e547511ea990d5254001c17d8" data-runtime-version="1" data-usage-id="block-v1:Internal+B3I062140+2019_T2+type@discussion+block@04dd2f9a156e4bb59cfa57114ea73c8c" data-block-type="discussion"&gt;
  





&lt;script type="text/javascript"&gt;
  window.PLATFORM_NAME = "CSCore";
    window.ENABLE_DISCUSSION_HOME_PANEL = true;
&lt;/script&gt;



&lt;script aria-hidden="true" type="text/template" id="thread-template"&gt;
    &lt;article class="discussion-article" data-id="&lt;%- id %&gt;" tabindex="-1"&gt;
    &lt;div class="thread-wrapper"&gt;
        &lt;div class="thread-main-wrapper"&gt;
            &lt;div class="thread-content-wrapper"&gt;&lt;/div&gt;
            &lt;div class="post-extended-content"&gt;
                &lt;ol class="responses js-marked-answer-list"&gt;&lt;/ol&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="post-extended-content thread-responses-wrapper"&gt;
            &lt;div class="response-btn-count-wrapper"&gt;
                &lt;% if (!readOnly) { %&gt;
                &lt;div class="add-response"&gt;
                    &lt;button class="btn btn-small add-response-btn"&gt;
                        &lt;%- gettext("Add a Response") %&gt;
                    &lt;/button&gt;
                &lt;/div&gt;
                &lt;% } %&gt;
                &lt;div class="response-count"&gt;&lt;/div&gt;
            &lt;/div&gt;
            &lt;ol class="responses js-response-list"&gt;&lt;/ol&gt;
            &lt;div class="response-pagination"&gt;&lt;/div&gt;
            &lt;div class="post-status-closed bottom-post-status" style="display: none"&gt;
              &lt;%- gettext("This thread is closed.") %&gt;
            &lt;/div&gt;
            &lt;% if (can_create_comment &amp;&amp; !readOnly) { %&gt;
            &lt;form class="discussion-reply-new" data-id="&lt;%- id %&gt;"&gt;
                &lt;h4&gt;&lt;%- gettext("Add a response:") %&gt;&lt;/h4&gt;
                &lt;ul class="discussion-errors"&gt;&lt;/ul&gt;
                &lt;div class="reply-body" data-id="&lt;%- id %&gt;"&gt;&lt;/div&gt;
                &lt;div class="reply-post-control"&gt;
                    &lt;button class="btn discussion-submit-post control-button"&gt;&lt;%- gettext("Submit") %&gt;&lt;/button&gt;
                &lt;/div&gt;
            &lt;/form&gt;
            &lt;% } %&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/article&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-show-template"&gt;
    &lt;div class="discussion-post"&gt;
    &lt;header class="post-header"&gt;
        &lt;% if (!readOnly) { %&gt;
            &lt;div class="post-header-actions"&gt;
                &lt;%=
                _.template(
                    $('#forum-actions').html())(
                    {
                        contentId: cid,
                        contentType: 'post',
                        primaryActions: ['vote', 'follow'],
                        secondaryActions: ['pin', 'edit', 'delete', 'report', 'close'],
                        readOnly: readOnly
                    }
                )
                %&gt;
            &lt;/div&gt;
        &lt;% } %&gt;
        &lt;div class="post-header-content"&gt;
            &lt;h4 class="post-title"&gt;&lt;%- title %&gt;&lt;/h4&gt;
            &lt;p class="posted-details"&gt;
            &lt;%
            var timeAgoHtml = interpolate(
                '&lt;span class="timeago" title="%(created_at)s"&gt;%(created_at)s&lt;/span&gt;',
                {created_at: created_at},
                true
            );
            %&gt;
            &lt;%=
            interpolate(
                // Translators: post_type describes the kind of post this is (e.g. "question" or "discussion");
                // time_ago is how much time has passed since the post was created (e.g. "4 hours ago")
                _.escape(gettext('%(post_type)s posted %(time_ago)s by %(author)s')),
                {post_type: thread_type, time_ago: timeAgoHtml, author: author_display},
                true
            )
            %&gt;
            &lt;/p&gt;
            &lt;div class="post-labels"&gt;
                &lt;span class="post-label post-label-pinned"&gt;
                    &lt;span class="icon fa fa-thumb-tack" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Pinned") %&gt;
                &lt;/span&gt;
                &lt;span class="post-label post-label-reported"&gt;
                    &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Reported") %&gt;
                &lt;/span&gt;
                &lt;span class="post-label post-label-closed"&gt;
                    &lt;span class="icon fa fa-lock" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Closed") %&gt;
                &lt;/span&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/header&gt;

    &lt;div class="post-body"&gt;&lt;%- body %&gt;&lt;/div&gt;
    &lt;div class="post-context"&gt;
        &lt;% if (mode === "tab" &amp;&amp; obj.courseware_url) { %&gt;
            &lt;%
            var courseware_title_linked = interpolate(
                '&lt;a href="%(courseware_url)s"&gt;%(courseware_title)s&lt;/a&gt;',
                {courseware_url: courseware_url, courseware_title: _.escape(courseware_title)},
                true
            );
            %&gt;
            &lt;%=
            interpolate(
                _.escape(gettext('Related to: %(courseware_title_linked)s')),
                {courseware_title_linked: courseware_title_linked},
                true
            )
            %&gt;
        &lt;% } %&gt;
        &lt;div class="group-visibility-label"&gt;
            &lt;% if (obj.group_name) { %&gt;
                &lt;%-
                interpolate(
                    gettext('This post is visible only to %(group_name)s.'),
                    {group_name: obj.group_name},
                    true
                )
                %&gt;
            &lt;% } else { %&gt;
                &lt;%- gettext('This post is visible to everyone.') %&gt;
            &lt;% } %&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-edit-template"&gt;
    &lt;h4&gt;&lt;%- gettext("Editing post") %&gt;&lt;/h4&gt;
&lt;ul class="post-errors"&gt;&lt;/ul&gt;
&lt;div class="forum-edit-post-form-wrapper"&gt;&lt;/div&gt;
&lt;div class="post-field"&gt;
    &lt;label class="field-label"&gt;
        &lt;span class="field-label-text"&gt;&lt;%- gettext("Title") %&gt;&lt;/span&gt;
        &lt;div class="field-help" id="field_help_title"&gt;
            &lt;%- gettext("Add a clear and descriptive title to encourage participation.") %&gt;
        &lt;/div&gt;
        &lt;input aria-describedby="field_help_title" type="text" class="edit-post-title field-input" name="title" value="&lt;%- title %&gt;"&gt;
    &lt;/label&gt;
&lt;/div&gt;
&lt;div class="form-row post-field"&gt;
    &lt;p class="sr-only field-help" id="edit-post-editor-description"&gt;&lt;%- gettext('Edit your post below.') %&gt;&lt;/p&gt;
    &lt;div class="edit-post-body" aria-describedby="edit-post-editor-description" name="body"&gt;&lt;%- body %&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;button type="submit" id="edit-post-submit" class="btn-brand submit post-update"&gt;&lt;%- gettext("Update post") %&gt;&lt;/button&gt;
&lt;button class="btn post-cancel"&gt;&lt;%- gettext("Cancel") %&gt;&lt;/button&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-response-template"&gt;
    &lt;div class="discussion-response"&gt;&lt;/div&gt;
&lt;button class="btn-link action-show-comments"&gt;
    &lt;%
    var fmts = ngettext("Show Comment (%(num_comments)s)", "Show Comments (%(num_comments)s)", comments.length);
    print(interpolate(fmts, {num_comments: comments.length}, true));
    %&gt;
    &lt;span class="icon fa fa-caret-down" aria-hidden="true"&gt;&lt;/span&gt;
&lt;/button&gt;
&lt;ol class="comments"&gt;
    &lt;li class="new-comment"&gt;
        &lt;% if (create_sub_comment &amp;&amp; !readOnly) { %&gt;
            &lt;form class="comment-form" data-id="&lt;%- wmdId %&gt;"&gt;
                &lt;ul class="discussion-errors"&gt;&lt;/ul&gt;
                &lt;label class="sr" for="add-new-comment-&lt;%- wmdId %&gt;"&gt;&lt;%- gettext("Add a comment") %&gt;&lt;/label&gt;
                &lt;div class="comment-body" id="add-new-comment-&lt;%- wmdId %&gt;" data-id="&lt;%- wmdId %&gt;"
                data-placeholder="&lt;%- gettext('Add a comment') %&gt;"&gt;&lt;/div&gt;
                &lt;div class="comment-post-control"&gt;
                    &lt;button class="btn-brand discussion-submit-comment control-button"&gt;&lt;%- gettext("Submit") %&gt;&lt;/button&gt;
                &lt;/div&gt;
            &lt;/form&gt;
        &lt;% } %&gt;
    &lt;/li&gt;
&lt;/ol&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-response-show-template"&gt;
    &lt;header class="response-header"&gt;
  &lt;div class="response-header-content"&gt;
    &lt;%= author_display %&gt;
    &lt;p class="posted-details"&gt;
        &lt;span class="timeago" title="&lt;%= created_at %&gt;"&gt;&lt;%= created_at %&gt;&lt;/span&gt;
        &lt;% if (obj.endorsement &amp;&amp; obj.endorsed) { %&gt;
            -
            &lt;%
            var fmt = null;
            if (thread.get("thread_type") == "question") {
              if (endorsement.username) {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("marked as answer %(time_ago)s by %(user)s");
              } else {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("marked as answer %(time_ago)s");
              }
            } else {
              if (endorsement.username) {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("endorsed %(time_ago)s by %(user)s");
              } else {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("endorsed %(time_ago)s");
              }
            }
            var time_ago = interpolate(
              '&lt;span class="timeago" title="%(time)s"&gt;%(time)s&lt;/span&gt;',
              {time: endorsement.time},
              true
            );
            %&gt;
            &lt;%= interpolate(fmt, {time_ago: time_ago, user: endorser_display}, true) %&gt;
        &lt;% } %&gt;
      &lt;/p&gt;
      &lt;div class="post-labels"&gt;
          &lt;span class="post-label post-label-reported"&gt;
              &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Reported") %&gt;
          &lt;/span&gt;
      &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="response-header-actions"&gt;
        &lt;%=
            _.template(
                $('#forum-actions').html())(
                {
                    contentId: cid,
                    contentType: 'response',
                    primaryActions: ['vote', thread.get('thread_type') == 'question' ? 'answer' : 'endorse'],
                    secondaryActions: ['edit', 'delete', 'report'],
                    readOnly: readOnly
                }
            )
        %&gt;
      &lt;/div&gt;
&lt;/header&gt;

&lt;div class="response-body"&gt;&lt;%- body %&gt;&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-response-edit-template"&gt;
    &lt;div class="edit-post-form"&gt;
    &lt;h1&gt;&lt;%- gettext("Editing response") %&gt;&lt;/h1&gt;
    &lt;ul class="edit-post-form-errors"&gt;&lt;/ul&gt;
    &lt;div class="form-row"&gt;
        &lt;div class="edit-post-body" name="body" data-id="&lt;%- id %&gt;"&gt;&lt;%- body %&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;button type="submit" id="edit-response-submit"class="btn-brand post-update"&gt;&lt;%- gettext("Update response") %&gt;&lt;/button&gt;
    &lt;button class="btn post-cancel"&gt;&lt;%- gettext("Cancel") %&gt;&lt;/button&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="response-comment-show-template"&gt;
    &lt;div class="discussion-comment" id="comment_&lt;%- id %&gt;"&gt;
  &lt;div class="response-body"&gt;&lt;%- body %&gt;&lt;/div&gt;
  &lt;%=
      _.template(
          $('#forum-actions').html())(
          {
              contentId: cid,
              contentType: 'comment',
              primaryActions: [],
              secondaryActions: ['edit', 'delete', 'report'],
              readOnly: readOnly
          }
      )
  %&gt;
  &lt;p class="posted-details"&gt;
    &lt;%
    var time_ago = interpolate(
      '&lt;span class="timeago" title="%(time)s"&gt;%(time)s&lt;/span&gt;',
      {time: created_at},
      true
    );
    %&gt;
    &lt;%= interpolate(
      // Translators: 'timeago' is a placeholder for a fuzzy, relative timestamp (see: https://github.com/rmm5t/jquery-timeago)
      gettext("posted %(time_ago)s by %(author)s"),
      {time_ago: time_ago, author: author_display},
      true
    ) %&gt;
  &lt;/p&gt;
  &lt;div class="post-labels"&gt;
    &lt;span class="post-label post-label-reported"&gt;
      &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Reported") %&gt;
    &lt;/span&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="response-comment-edit-template"&gt;
    &lt;div class="edit-post-form" id="comment_&lt;%- id %&gt;"&gt;
    &lt;h1&gt;&lt;%- gettext("Editing comment") %&gt;&lt;/h1&gt;
    &lt;ul class="edit-comment-form-errors"&gt;&lt;/ul&gt;
    &lt;div class="form-row"&gt;
        &lt;div class="edit-comment-body" name="body" data-id="&lt;%- id %&gt;"&gt;&lt;%- body %&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;button type="submit" id="edit-comment-submit" class="btn-brand post-update"&gt;&lt;%- gettext("Update comment") %&gt;&lt;/button&gt;
    &lt;button class="btn post-cancel"&gt;&lt;%- gettext("Cancel") %&gt;&lt;/button&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-list-item-template"&gt;
    &lt;li data-id="&lt;%- id %&gt;" class="forum-nav-thread&lt;% if (neverRead) { %&gt; never-read&lt;% } %&gt;"&gt;
  &lt;a href="&lt;%- threadUrl %&gt;" class="forum-nav-thread-link"&gt;
    &lt;div class="forum-nav-thread-wrapper-0"&gt;
      &lt;%
      var icon_class, sr_text;
      if (thread_type === "discussion") {
          icon_class = "fa-comments";
          // Translators: This is a label for a Discussion forum thread
          sr_text = gettext("discussion");
      } else if (endorsed) {
          icon_class = "fa-check-square-o";
          // Translators: This is a label for a Question forum thread with a marked answer
          sr_text = gettext("answered question");
      } else {
          icon_class = "fa-question";
          // Translators: This is a label for a Question forum thread without a marked answer
          sr_text = gettext("unanswered question");
      }
      %&gt;
      &lt;span class="sr"&gt;&lt;%= sr_text %&gt;&lt;/span&gt;
      &lt;span class="icon fa &lt;%= icon_class %&gt;" aria-hidden="true"&gt;&lt;/span&gt;
    &lt;/div&gt;&lt;div class="forum-nav-thread-wrapper-1"&gt;
      &lt;span class="forum-nav-thread-title"&gt;&lt;%- title %&gt;&lt;/span&gt;
      &lt;% if (showThreadPreview){ %&gt;
        &lt;div class="thread-preview-body"&gt;&lt;%- threadPreview %&gt;&lt;/div&gt;
      &lt;% } %&gt;
      &lt;% if(typeof(subscribed) === "undefined") { var subscribed = null; } %&gt;
      &lt;% if(pinned || subscribed || staff_authored || community_ta_authored) { %&gt;
        &lt;ul class="forum-nav-thread-labels"&gt;
        &lt;% if (pinned) { %&gt;
          &lt;li class="post-label post-label-pinned"&gt;
            &lt;span class="icon fa fa-thumb-tack" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that has been pinned %&gt;
            &lt;%- gettext("Pinned") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (subscribed) { %&gt;
          &lt;li class="post-label post-label-following"&gt;
            &lt;span class="icon fa fa-star" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that the user is subscribed to %&gt;
            &lt;%- gettext("Following") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (staff_authored) { %&gt;
          &lt;li class="post-label post-label-by-staff"&gt;
            &lt;span class="icon fa fa-user" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that was authored by a member of the course staff %&gt;
            &lt;%- gettext("Staff") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (community_ta_authored) { %&gt;
          &lt;li class="post-label post-label-by-community-ta"&gt;
            &lt;span class="icon fa fa-user" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that was authored by a community TA %&gt;
            &lt;%- gettext("Community TA") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;/ul&gt;
      &lt;% } %&gt;
    &lt;/div&gt;&lt;div class="forum-nav-thread-wrapper-2"&gt;
      &lt;%
      // Translators: 'votes_count' is a numerical placeholder for a specific discussion thread; 'span_start' and 'span_end' placeholders refer to HTML markup.  Please translate the word 'votes'.
      var fmt = ngettext(
           "%(votes_count)s%(span_start)s vote %(span_end)s",
           "%(votes_count)s%(span_start)s votes %(span_end)s",
           votes['up_count']
      );
      %&gt;
      &lt;span class="forum-nav-thread-votes-count"&gt;
      +&lt;%= interpolate(fmt, {
               votes_count: votes['up_count'],
               span_start: '&lt;span class="sr"&gt;',
               span_end: '&lt;/span&gt;'
            }, true)
      %&gt;
      &lt;/span&gt;

      &lt;% if (!neverRead &amp;&amp; unread_comments_count &gt; 0) { %&gt;
        &lt;span class="forum-nav-thread-unread-comments-count"&gt;
          &lt;%-
            StringUtils.interpolate(
              gettext('{unread_comments_count} new'),
              {unread_comments_count: unread_comments_count}
            )
          %&gt;
        &lt;/span&gt;
      &lt;% } %&gt;

      &lt;span class="forum-nav-thread-comments-count"&gt;
      &lt;%
      var fmt;
      // Counts in data do not include the post itself, but the UI should
      var data = {
          'span_sr_open': '&lt;span class="sr"&gt;',
          'span_close': '&lt;/span&gt;',
          'unread_comments_count': unread_comments_count + (read ? 0 : 1),
          'comments_count': comments_count + 1
      };
      if (unread_comments_count &gt; 0) {
          // Translators: 'comments_count' and 'unread_comments_count' are numerical placeholders for a specific discussion thread; 'span_*' placeholders refer to HTML markup.  Please translate the word 'comments'.
          fmt = gettext('%(comments_count)s %(span_sr_open)scomments (%(unread_comments_count)s unread comments)%(span_close)s');
      } else {
          // Translators: 'comments_count' is a numerical placeholder for a specific discussion thread; 'span_*' placeholders refer to HTML markup.  Please translate the word 'comments'.
          fmt = gettext('%(comments_count)s %(span_sr_open)scomments %(span_close)s');
      }
      print(interpolate(fmt, data, true));
      %&gt;
      &lt;/span&gt;
    &lt;/div&gt;
  &lt;/a&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="search-alert-template"&gt;
    &lt;div class="search-alert &lt;%- css_class %&gt;" id="search-alert-&lt;%- cid %&gt;"&gt;
    &lt;div class="search-alert-content"&gt;
        &lt;p class="message"&gt;&lt;%= HtmlUtils.ensureHtml(messageHtml) %&gt;&lt;/p&gt;
    &lt;/div&gt;

    &lt;div class="search-alert-controls"&gt;
        &lt;button class="btn-link dismiss control control-dismiss" title="&lt;%- gettext('Close') %&gt;"&gt;
            &lt;span class="icon fa fa-remove" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/button&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-template"&gt;
    &lt;form class="forum-new-post-form"&gt;
    &lt;h3 class="thread-title"&gt;&lt;%- gettext("Add a Post") %&gt;&lt;/h3&gt;
    &lt;% if (mode === 'inline') { %&gt;
        &lt;button class="btn-default add-post-cancel"&gt;
            &lt;span class="sr"&gt;&lt;%- gettext('Cancel') %&gt;&lt;/span&gt;
            &lt;span class="fa fa-close" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/button&gt;
    &lt;% } %&gt;
    &lt;ul class="post-errors" style="display: none"&gt;&lt;/ul&gt;
    &lt;div class="forum-new-post-form-wrapper"&gt;&lt;/div&gt;
    &lt;% if (cohort_options) { %&gt;
    &lt;div class="post-field group-selector-wrapper &lt;% if (!is_commentable_cohorted) { print('disabled'); } %&gt;"&gt;
        &lt;label class="field-label"&gt;
            &lt;span class="field-label-text"&gt;
                &lt;% //Translators: This labels the selector for which group of students can view a post %&gt;
                &lt;%- gettext("Visible to") %&gt;
            &lt;/span&gt;
            &lt;div class="field-help" id="field_help_visible_to"&gt;
                &lt;%- gettext("Discussion admins, moderators, and TAs can make their posts visible to all students or specify a single cohort.") %&gt;
            &lt;/div&gt;
            &lt;div class="field-input"&gt;
                &lt;select aria-describedby="field_help_visible_to" class="post-topic field-input js-group-select" name="group_id" &lt;% if (!is_commentable_cohorted) { print("disabled"); } %&gt;&gt;
                    &lt;option value=""&gt;&lt;%- gettext("All Groups") %&gt;&lt;/option&gt;
                    &lt;% _.each(cohort_options, function(opt) { %&gt;
                    &lt;option value="&lt;%- opt.value %&gt;" &lt;% if (opt.selected) { print("selected"); } %&gt;&gt;&lt;%- opt.text %&gt;&lt;/option&gt;
                    &lt;% }); %&gt;
                &lt;/select&gt;
            &lt;/div&gt;
        &lt;/label&gt;
    &lt;/div&gt;
    &lt;% } %&gt;
    &lt;div class="post-field"&gt;
        &lt;label class="field-label"&gt;
            &lt;span class="field-label-text"&gt;&lt;%- gettext("Title") %&gt;&lt;/span&gt;
            &lt;div class="field-help" id="field_help_title"&gt;
                &lt;%- gettext("Add a clear and descriptive title to encourage participation.") %&gt;
            &lt;/div&gt;
            &lt;div&gt;
                &lt;input aria-describedby="field_help_title" type="text" class="js-post-title field-input" name="title"&gt;
            &lt;/div&gt;
        &lt;/label&gt;
    &lt;/div&gt;

    &lt;div&gt;
        &lt;span class="field-label-text field-label-text-full" id="new-post-editor-description"&gt;&lt;%- gettext('Your question or idea') %&gt;&lt;/span&gt;
        &lt;div class="js-post-body editor" aria-describedby="new-post-editor-description" name="body"&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="post-options"&gt;
        &lt;label class="post-option is-enabled"&gt;
            &lt;input type="checkbox" name="follow" class="post-option-input js-follow" checked&gt;
            &lt;span class="icon fa fa-star" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("follow this post") %&gt;
        &lt;/label&gt;
        &lt;% if (allow_anonymous) { %&gt;
        &lt;label class="post-option"&gt;
            &lt;input type="checkbox" name="anonymous" class="post-option-input js-anon"&gt;
            &lt;%- gettext("post anonymously") %&gt;
        &lt;/label&gt;
        &lt;% } %&gt;
        &lt;% if (allow_anonymous_to_peers) { %&gt;
        &lt;label class="post-option"&gt;
            &lt;input type="checkbox" name="anonymous_to_peers" class="post-option-input js-anon-peers"&gt;
            &lt;%- gettext("post anonymously to classmates") %&gt;
        &lt;/div&gt;
        &lt;% } %&gt;
    &lt;/div&gt;
    &lt;div&gt;
        &lt;button type="submit" class="btn-brand submit"&gt;&lt;%- gettext('Submit') %&gt;&lt;/button&gt;
        &lt;button type="button" class="btn cancel"&gt;&lt;%- gettext('Cancel') %&gt;&lt;/button&gt;
    &lt;/div&gt;
&lt;/form&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-menu-entry-template"&gt;
    &lt;option class="topic-title" data-discussion-id="&lt;%- id %&gt;" data-cohorted="&lt;%- is_cohorted %&gt;"&gt;&lt;%- text %&gt;&lt;/option&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-menu-category-template"&gt;
    &lt;optgroup label="&lt;%- text %&gt;"&gt;
    &lt;%= edx.HtmlUtils.ensureHtml(entries) %&gt;
&lt;/optgroup&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-alert-template"&gt;
    &lt;div class="alert alert-error pattern-library-shim" role="alert" aria-labelledby="alert-title-error-&lt;%- alertId %&gt;" tabindex="-1"&gt;
    &lt;span class="icon alert-icon fa fa-warning" aria-hidden="true"&gt;&lt;/span&gt;

    &lt;div class="alert-message"&gt;
        &lt;h3 class="sr-only alert-title" id="alert-title-error-&lt;%- alertId %&gt;"&gt;
            &lt;%- gettext("Error posting your message.") %&gt;
        &lt;/h3&gt;

        &lt;p class="alert-copy"&gt;
            &lt;%- gettext(message) %&gt;
        &lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="topic-template"&gt;
    &lt;div class="post-field"&gt;
    &lt;label class="field-label"&gt;
        &lt;span class="field-label-text"&gt;
            &lt;%- gettext("Topic area") %&gt;
        &lt;/span&gt;
        &lt;div class="field-help" id="field_help_topic_area"&gt;
            &lt;%- gettext("Add your post to a relevant topic to help others find it.") %&gt;
        &lt;/div&gt;
        &lt;div class="field-input"&gt;
            &lt;select class="post-topic field-input" aria-describedby="field_help_topic_area" required&gt;
                &lt;%= edx.HtmlUtils.ensureHtml(topics_html) %&gt;
            &lt;/select&gt;
        &lt;/div&gt;
    &lt;/label&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="post-user-display-template"&gt;
    &lt;% if (username) { %&gt;
&lt;a href="&lt;%- user_url %&gt;" class="username"&gt;&lt;%- username %&gt;&lt;/a&gt;
    &lt;% if (is_community_ta) { %&gt;
    &lt;span class="user-label-community-ta"&gt;&lt;%- gettext("Community TA") %&gt;&lt;/span&gt;
    &lt;% } else if (is_staff) { %&gt;
    &lt;span class="user-label-staff"&gt;&lt;%- gettext("Staff") %&gt;&lt;/span&gt;
    &lt;% } %&gt;
&lt;% } else { %&gt;
    &lt;%- gettext('anonymous') %&gt;
&lt;% } %&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="inline-discussion-template"&gt;
    &lt;section class="discussion inline-discussion" data-discussion-id="&lt;%- discussionId %&gt;"&gt;
    &lt;div class="add_post_btn_container &lt;%if (read_only) {%&gt;is-hidden&lt;%} %&gt;"&gt;
        &lt;button class="btn-link new-post-btn"&gt;&lt;%- gettext("Add a Post") %&gt;&lt;/button&gt;
    &lt;/div&gt;

    &lt;article class="new-post-article is-hidden"&gt;&lt;/article&gt;

    &lt;div class="inline-discussion-thread-container"&gt;
        &lt;section class="inline-threads"&gt;
        &lt;/section&gt;

        &lt;div class="inline-thread"&gt;
            &lt;div class="forum-nav-bar"&gt;
                &lt;button class="btn-link all-posts-btn"&gt;
                    &lt;span class="icon fa fa-chevron-prev" aria-hidden="true"&gt;&lt;/span&gt;
                    &lt;span aria-hidden="true"&gt;&lt;%- gettext('All Posts') %&gt;&lt;/span&gt;
                    &lt;span class="sr-only"&gt;&lt;%- gettext('Return to all posts') %&gt;&lt;/span&gt;
                &lt;/button&gt;
            &lt;/div&gt;
            &lt;div class="forum-content"&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/section&gt;


&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="pagination-template"&gt;
    &lt;nav class="discussion-paginator"&gt;
    &lt;ol&gt;
        &lt;% if (previous) { %&gt;
            &lt;li class="previous-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= previous.url %&gt;" data-page-number="&lt;%= previous.number %&gt;"&gt;&amp;lt; &lt;%- gettext("Previous") %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (first) { %&gt;
            &lt;li class="first-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= first.url %&gt;" data-page-number="1"&gt;1&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (leftdots) { %&gt;
            &lt;li class="previous-ellipses"&gt;&lt;%- gettext("…") %&gt;&lt;/li&gt;
        &lt;% } %&gt;

        &lt;% _.each(lowPages, function(page) { %&gt;
            &lt;li class="lower-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= page.url %&gt;" data-page-number="&lt;%= page.number %&gt;"&gt;&lt;%= page.number %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% }); %&gt;
        &lt;li class="current-page"&gt;&lt;span&gt;&lt;%= page %&gt;&lt;/span&gt;&lt;/li&gt;
        &lt;% _.each(highPages, function(page) { %&gt;
            &lt;li class="higher-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= page.url %&gt;" data-page-number="&lt;%= page.number %&gt;"&gt;&lt;%= page.number %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% }); %&gt;

        &lt;% if (rightdots) { %&gt;
            &lt;li class="next-ellipses"&gt;&lt;%- gettext("…") %&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (last) { %&gt;
            &lt;li class="last-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= last.url %&gt;" data-page-number="&lt;%= last.number %&gt;"&gt;&lt;%= last.number %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (next) { %&gt;
            &lt;li class="next-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= next.url %&gt;" data-page-number="&lt;%= next.number %&gt;"&gt;&lt;%- gettext("Next") %&gt; &amp;gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
    &lt;/ol&gt;
&lt;/nav&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="profile-thread-template"&gt;
    &lt;article class="discussion-article" data-id="&lt;%- id %&gt;"&gt;
    &lt;div class="discussion-post"&gt;
        &lt;header&gt;
            &lt;h3&gt;&lt;%- title %&gt;&lt;/h3&gt;
            &lt;p class="posted-details"&gt;
                &lt;% if (user) { %&gt;
                    &lt;a href="&lt;%- user.url %&gt;" class="username"&gt;&lt;%- user.username %&gt;&lt;/a&gt;
                &lt;% } else { %&gt;
                    &lt;%- gettext("anonymous") %&gt;
                &lt;% } %&gt;

                &lt;span class="timeago" title="&lt;%- created_at %&gt;"&gt;&lt;%- created_at %&gt;&lt;/span&gt;
                &lt;span class="post-status-closed top-post-status" style="display: none"&gt;
                    &amp;bull; &lt;%- gettext("This thread is closed.") %&gt;
                &lt;/span&gt;
            &lt;/p&gt;
        &lt;/header&gt;
        &lt;div class="post-body"&gt;&lt;%= abbreviatedBody %&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="post-tools"&gt;
        &lt;a href="&lt;%- permalink %&gt;"&gt;&lt;%- gettext("View discussion") %&gt;&lt;/a&gt;
    &lt;/div&gt;

&lt;/article&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="customwmd-prompt-template"&gt;
    &lt;h4 id="editor-dialog-title"&gt;&lt;%- title %&gt;&lt;/h4&gt;
&lt;div role="status" id="wmd-editor-dialog-form-errors" class="sr" tabindex="-1"&gt;&lt;/div&gt;
&lt;div&gt;
    &lt;form class="form"&gt;
        &lt;fieldset class="field-group"&gt;
            &lt;legend class="form-group-hd sr"&gt;&lt;%- title %&gt;&lt;/legend&gt;
            &lt;div class="field &lt;%- uploadFieldClass %&gt;"&gt;
                &lt;label id="new-url-input-label" for="new-url-input" class="field-label"&gt;
                    &lt;%- urlLabel %&gt;&lt;/label&gt;
                &lt;input type="text" id="new-url-input" class="field-input input-text" aria-describedby="new-url-input-help"&gt;
                &lt;% if (imageUploadHandler) { %&gt;
                    &lt;button id="file-upload-proxy" class="btn btn-primary btn-base form-btn"&gt;
                        &lt;%- chooseFileText %&gt;
                    &lt;/button&gt;
                    &lt;input type="file" name="file-upload" id="file-upload" style="display:none;"/&gt;
                &lt;% } %&gt;
                &lt;div id="new-url-input-field-message" class="field-message has-error" style="display:none"&gt;
                    &lt;span class="field-message-content"&gt;&lt;%- urlError %&gt;&lt;/span&gt;
                &lt;/div&gt;
                &lt;div id="new-url-input-help" class="field-hint"&gt;
                    &lt;%- urlHelp %&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="field"&gt;
                &lt;label for="new-url-desc-input" class="field-label"&gt;&lt;%- urlDescLabel %&gt;&lt;/label&gt;
                &lt;input type="text" id="new-url-desc-input" class="field-input input-text" required aria-describedby="new-url-desc-input-help"&gt;
                &lt;div id="new-url-desc-input-field-message" class="field-message has-error" style="display:none"&gt;
                    &lt;span class="field-message-content"&gt;&lt;%- descError %&gt;&lt;/span&gt;
                &lt;/div&gt;
                &lt;div id="new-url-desc-input-help" class="field-hint"&gt;
                    &lt;%- urlDescHelp %&gt;
                    &lt;% if (urlDescHelpLink) { %&gt;
                        &lt;a href="&lt;%- urlDescHelpLink['href'] %&gt;"&gt;
                            &lt;%- urlDescHelpLink['text'] %&gt;
                        &lt;/a&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="field"&gt;&lt;% if (imageUploadHandler) { %&gt;
                &lt;label for="img-is-decorative" class="field-label label-inline"&gt;
                    &lt;input type="checkbox" id="img-is-decorative" class="field-input input-checkbox"&gt;
                    &lt;span class="field-input-label"&gt;&lt;%- imageIsDecorativeLabel %&gt;&lt;/span&gt;
                &lt;/label&gt; &lt;% }
            %&gt;&lt;/div&gt;
        &lt;/fieldset&gt;
        &lt;div class="form-actions"&gt;
            &lt;input type="button" id="new-link-image-ok" class="btn-brand form-btn" value="&lt;%- okText %&gt;" /&gt;
            &lt;input type="button" id="new-link-image-cancel" class="btn form-btn" value="&lt;%- cancelText %&gt;" &gt;
        &lt;/div&gt;
    &lt;/form&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="nav-loading-template"&gt;
    &lt;div class="forum-nav-loading" tabindex="0"&gt;
    &lt;span class="icon fa fa-spinner fa-spin"/&gt;
    &lt;span class="sr" role="alert"&gt;&lt;%- srText %&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-type-template"&gt;
    &lt;div class="post-field"&gt;
    &lt;div class="field-label"&gt;
        &lt;span class="field-label-text"&gt;
            &lt;% // Translators: This is the label for a control to select a forum post type %&gt;
            &lt;%- gettext("Post type") %&gt;
        &lt;/span&gt;
        &lt;div class="field-help" id="field_help_post_type"&gt;
            &lt;%- gettext("Questions raise issues that need answers. Discussions share ideas and start conversations.") %&gt;
        &lt;/div&gt;
        &lt;div class="field-label"&gt;
            &lt;fieldset class="field-input"&gt;
                &lt;legend class="sr"&gt;&lt;%- gettext("Post type") %&gt;&lt;/legend&gt;
                &lt;input aria-describedby="field_help_post_type" type="radio" name="&lt;%= form_id %&gt;-post-type" class="post-type-input" id="&lt;%= form_id %&gt;-post-type-question" value="question"&gt;
                &lt;label for="&lt;%= form_id %&gt;-post-type-question" class="post-type-label"&gt;
                    &lt;span class="icon fa fa-question" aria-hidden="true"&gt;&lt;/span&gt;
                    &lt;% // Translators: This is a forum post type %&gt;
                    &lt;%- gettext("Question") %&gt;
                &lt;/label&gt;
                &lt;input aria-describedby="field_help_post_type" type="radio" name="&lt;%= form_id %&gt;-post-type" class="post-type-input" id="&lt;%= form_id %&gt;-post-type-discussion" value="discussion" checked&gt;
                &lt;label for="&lt;%= form_id %&gt;-post-type-discussion" class="post-type-label"&gt;
                    &lt;span class="icon fa fa-comments" aria-hidden="true"&gt;&lt;/span&gt;
                    &lt;% // Translators: This is a forum post type %&gt;
                    &lt;%- gettext("Discussion") %&gt;
                &lt;/label&gt;
            &lt;/fieldset&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;


&lt;script aria-hidden="true" type="text/template" id="forum-action-endorse"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-button action-endorse" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Endorse") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Endorse") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unendorse") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-check" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-answer"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-button action-answer" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Mark as Answer") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Mark as Answer") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unmark as Answer") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-check" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-follow"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-button action-follow" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Follow") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Follow") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unfollow") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-star" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-vote"&gt;
    &lt;li class="actions-item"&gt;
    &lt;span aria-hidden="true" class="display-vote is-hidden" &gt;
      &lt;span class="vote-count"&gt;&lt;/span&gt;
    &lt;/span&gt;
    &lt;button class="btn-link action-button action-vote" role="checkbox" aria-checked="false"&gt;
        &lt;% // Vote counts are populated by JS %&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Vote for this post,") %&gt;&amp;nbsp;&lt;/span&gt;
        &lt;span class="sr js-sr-vote-count"&gt;&lt;/span&gt;

        &lt;span class="action-label" aria-hidden="true"&gt;
          &lt;span class="vote-count"&gt;&lt;/span&gt;
        &lt;/span&gt;

        &lt;span class="action-icon" aria-hidden="true"&gt;
            &lt;span class="icon fa fa-plus" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-report"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-report" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Report abuse") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Report") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unreport") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;
          &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-pin"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-pin" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Pin") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Pin") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unpin") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;
          &lt;span class="icon fa fa-thumb-tack" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-close"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-close" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Close") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Close") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Open") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;
          &lt;span class="icon fa fa-lock" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-edit"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-edit"&gt;
        &lt;span class="action-label"&gt;&lt;%- gettext("Edit") %&gt;&lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-pencil" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-delete"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-delete"&gt;
        &lt;span class="action-label"&gt;&lt;%- gettext("Delete") %&gt;&lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-remove" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-actions"&gt;
    &lt;% if (!readOnly) { %&gt;
    &lt;ul class="&lt;%= contentType %&gt;-actions-list"&gt;
        &lt;% _.each(primaryActions, function(action) { print(_.template($('#forum-action-' + action).html())({})) }) %&gt;
        &lt;li class="actions-item is-visible"&gt;
            &lt;div class="more-wrapper"&gt;
                &lt;button class="btn-link action-button action-more" aria-label="&lt;%- gettext('More') %&gt;" aria-haspopup="true" aria-controls="action-menu-&lt;%= contentType %&gt;"&gt;
                    &lt;span class="action-label"&gt;&lt;%- gettext('More') %&gt;&lt;/span&gt;
                    &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-ellipsis-h" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;/button&gt;
                &lt;div class="actions-dropdown" id="action-menu-&lt;%= contentType %&gt;" aria-expanded="false"&gt;
                  &lt;ul class="actions-dropdown-list"&gt;
                    &lt;% _.each(secondaryActions, function(action) { print(_.template($('#forum-action-' + action).html())({})) }) %&gt;
                  &lt;/ul&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/li&gt;
    &lt;/ul&gt;
&lt;% } %&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="alert-popup"&gt;
    &lt;div class='modal' role='alertdialog' id='discussion-alert' aria-describedby='discussion-alert-message'&gt;
    &lt;div class='inner-wrapper discussion-alert-wrapper'&gt;
        &lt;button class='btn close-modal dismiss' title='&lt;%- gettext("Close") %&gt;''&gt;
            &lt;span class='icon fa fa-times' aria-hidden='true'&gt;&lt;/span&gt;
        &lt;/button&gt;
        &lt;header&gt;
            &lt;h2/&gt;&lt;/h2&gt;
            &lt;hr/&gt;
        &lt;/header&gt;
        &lt;p id='discussion-alert-message'&gt;&lt;/p&gt;
        &lt;hr/&gt;
        &lt;button class='btn dismiss'&gt;&lt;%- gettext("OK") %&gt;&lt;/button&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="nav-load-more-link"&gt;
    &lt;li class='forum-nav-load-more'&gt;
    &lt;button class='btn-link forum-nav-load-more-link'&gt;
        &lt;%- gettext("Load more") %&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;



&lt;script type="text/template" id="thread-list-template"&gt;
    &lt;div class="forum-nav-thread-list-wrapper" id="sort-filter-wrapper" tabindex="-1"&gt;
        &lt;div class="forum-nav-refine-bar"&gt;
            &lt;label class="forum-nav-filter-main"&gt;
                &lt;span class="sr"&gt;Filter:&lt;/span&gt;
                &lt;select class="forum-nav-filter-main-control"&gt;
                    &lt;option value="all"&gt;显示全部&lt;/option&gt;
                    &lt;option value="unread"&gt;Unread&lt;/option&gt;
                    &lt;option value="unanswered"&gt;Unanswered&lt;/option&gt;
                &lt;/select&gt;
            &lt;/label&gt;&lt;% if (isCohorted &amp;&amp; isPrivilegedUser) { %&gt;&lt;label class="forum-nav-filter-cohort"&gt;
                &lt;span class="sr"&gt;Cohort:&lt;/span&gt;
                &lt;select class="forum-nav-filter-cohort-control"&gt;
                    &lt;option value=""&gt;in all cohorts&lt;/option&gt;
                &lt;/select&gt;
            &lt;/label&gt;&lt;% } %&gt;&lt;label class="forum-nav-sort"&gt;
                &lt;span class="sr"&gt;Sort:&lt;/span&gt;
                &lt;select class="forum-nav-sort-control"&gt;
                    &lt;option value="activity"&gt;近期活动&lt;/option&gt;
                    &lt;option value="comments"&gt;活跃度&lt;/option&gt;
                    &lt;option value="votes"&gt;最多票数&lt;/option&gt;
                &lt;/select&gt;
            &lt;/label&gt;
        &lt;/div&gt;
        &lt;div class="search-alerts"&gt;&lt;/div&gt;
        &lt;ul class="forum-nav-thread-list"&gt;&lt;/ul&gt;
    &lt;/div&gt;
&lt;/script&gt;




&lt;div class="discussion-module" data-discussion-id="ef913520669f062dc88932b5e860b27ae7f7b009"
    data-user-create-comment="true"
    data-user-create-subcomment="true"
    data-read-only="false"&gt;
    &lt;div class="discussion-module-header"&gt;
        &lt;h3 class="discussion-module-title"&gt;讨论&lt;/h3&gt;
        &lt;div class="inline-discussion-topic"&gt;&lt;span class="inline-discussion-topic-title"&gt;Topic:&lt;/span&gt; 管道与shell：管道 / 管道的测试&lt;/div&gt;
    &lt;/div&gt;
    &lt;button class="discussion-show btn" data-discussion-id="ef913520669f062dc88932b5e860b27ae7f7b009"&gt;
        &lt;span class="button-text"&gt;显示讨论&lt;/span&gt;
    &lt;/button&gt;
&lt;/div&gt;
&lt;script type="text/javascript"&gt;
var $$course_id = "course\u002Dv1:Internal+B3I062140+2019_T2";

function DiscussionInlineBlock(runtime, element) {
    'use strict';
    new DiscussionInlineView({ el: $(element).find('.discussion-module') });
}
&lt;/script&gt;

&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;

  </div>
  <div id="seq_contents_2" aria-labelledby="tab_2" aria-hidden="true" class="seq_contents tex2jax_ignore asciimath2jax_ignore">
    &lt;div class="xblock xblock-student_view xblock-student_view-vertical" data-runtime-class="LmsRuntime" data-init="VerticalStudentView" data-course-id="course-v1:Internal+B3I062140+2019_T2" data-request-token="03ca6f9e547511ea990d5254001c17d8" data-runtime-version="1" data-usage-id="block-v1:Internal+B3I062140+2019_T2+type@vertical+block@0de09bcda6b744f8afc789c783241844" data-block-type="vertical"&gt;
  

  &lt;h3 class="unit-title"&gt;管道的读写&lt;/h3&gt;

    


&lt;div class="bookmark-button-wrapper"&gt;
  &lt;button class="btn btn-link bookmark-button "
    aria-pressed="false"
    data-bookmark-id="18231047,block-v1:Internal+B3I062140+2019_T2+type@vertical+block@0de09bcda6b744f8afc789c783241844"&gt;
     &lt;span class="sr bookmark-sr"&gt;Click to add&lt;/span&gt;
     &lt;span class="bookmark-text"&gt;Bookmark this page&lt;/span&gt;
    &lt;/button&gt;
&lt;/div&gt;


&lt;div class="vert-mod"&gt;
  &lt;div class="vert vert-0" data-id="block-v1:Internal+B3I062140+2019_T2+type@html+block@0d97dc53ce354b70840175d4eddae0b3"&gt;
    &lt;div class="xblock xblock-student_view xblock-student_view-html xmodule_display xmodule_HtmlModule" data-runtime-class="LmsRuntime" data-init="XBlockToXModuleShim" data-block-type="html" data-request-token="03ca6f9e547511ea990d5254001c17d8" data-runtime-version="1" data-usage-id="block-v1:Internal+B3I062140+2019_T2+type@html+block@0d97dc53ce354b70840175d4eddae0b3" data-type="HTMLModule" data-course-id="course-v1:Internal+B3I062140+2019_T2"&gt;
  &lt;script type="json/xblock-args" class="xblock-json-init-args"&gt;
    {"xmodule-type": "HTMLModule"}
  &lt;/script&gt;
  &lt;p&gt;我们可以在 user/pipe.c 中轻松地找到 Pipe 结构体的定义，它的定义如下：&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;code&gt;struct Pipe {&lt;/code&gt;&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 30px;"&gt;&lt;code&gt; u_int p_rpos; // read position&lt;/code&gt;&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 30px;"&gt;&lt;code&gt; u_int p_wpos; // write position&lt;/code&gt;&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 30px;"&gt;&lt;code&gt; u_char p_buf[BY2PIPE]; // data buffer&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;code&gt; };&lt;/code&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;在 Pipe 结构体中,p_rpos 给出了下一个将要从管道读的数据的位置，而 p_wpos 给出了下一个将要向管道写的数据的位置。只有读者可以更新 p_rpos，同样，只有写者可以更新 p_wpos，读者和写者通过这两个变量的值进行协调读写。一个管道有 BY2PIPE(32Byte)大小的缓冲区。&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;这个只有 BY2PIPE 大小的缓冲区发挥的作用类似于环形缓冲区，所以下一个要读或写的位置 i 实际上是 i%BY2PIPE。&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;读者在从管道读取数据时，要将 p_buf[p_rpos%BY2PIPE] 的数据拷贝走，然后读指针自增 1。但是需要注意的是，管道的缓冲区此时可能还没有被写入数据。所以如果管道数据为空，即当 p_rpos &amp;gt;= p_wpos 时，应该进程切换到写者运行。&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;类似于读者，写者在向管道写入数据时，也是将数据存入 p_buf[p_wpos%BY2PIPE]，然后写指针自增 1。需要注意管道的缓冲区可能出现满溢的情况，所以写者必须得在p_wpos - p_rpos &amp;lt; BY2PIPE 时方可运行，否则要一直挂起。&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;上面这些还不足以使得读者写者一定能顺利完成管道操作。假设这样的情景：管道写端已经全部关闭，读者读到缓冲区有效数据的末尾，此时有 p_rpos = p_wpos。按照上面的做法，我们这里应当切换到写者运行。但写者进程已经结束，进程切换就造成了死循环，这时候读者进程如何知道应当退出了呢？&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;为了解决上面提出的问题，我们必须得知道管道的另一端是否已经关闭。不论是在读者还是在写者中，我们都需要对另一端的状态进行判断：当出现缓冲区空或满的情况时，要根据另一端是否关闭来判断是否要返回。如果另一端已经关闭，进程返回 0 即可；如果没有关闭，则切换到其他进程运行。&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;strong&gt;Note 6.2.1 如果管道的写端相关的所有的文件描述符都已经关闭，那么管道读端将会读到文件结尾并返回 0。link : http://linux.die.net/man/7/pipe&lt;/strong&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;那么我们该如何知晓管道的另一端是否已经关闭了呢？这时就要用到我们的static int _pipeisclosed(struct Fd *fd, struct Pipe *p)函数。而这个函数的核心，就是下面我们要讲的恒成立等式了。&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;在之前的图6.2中我们没有明确画出文件描述符所占的页，但实际上，对于每一个匿名管道而言，我们分配了三页空间：一页是读数据的文件描述符 rfd，一页是写数据的文件描述符 wfd，剩下一页是被两个文件描述符共享的管道数据缓冲区。既然管道数据缓冲区 h 是被两个文件描述符所共享的，我们很直观地就能得到一个结论：如果有 1 个读者，1 个写者，那么管道将被引用 2 次，就如同上图所示。pageref 函数能得到页的引用次数，所以实际上有下面这个等式成立：&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;pageref(rfd) + pageref(wfd) = pageref(pipe)&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;strong&gt;Note 6.2.2 内核会对 pages 数组成员维护一个页引用变量 pp_ref 来记录指向该物理页的虚页数量。pageref 的实现实际上就是查询虚页 P 对应的实际物理页，然后返回其 pp_ref 变量的值。&lt;/strong&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;这个等式对我们而言有什么用呢？假设我们现在在运行读者进程，而进行管道写入的进程都已经结束了，那么此时就应该有：pageref(wfd) = 0。所以就有pageref(rfd) = pageref(pipe)。所以我们只要判断这个等式是否成立就可以得知写端是否关闭，对写者来说同理。&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;span style="color: #0000ff;"&gt;Exercise 6.2 根据上述提示与代码中的注释，填写 user/pipe.c 中的 piperead、pipewrite、_pipeisclosed 函数并通过 testpipe 的测试。&lt;/span&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;strong&gt;Note 6.2.3 注意在本次实验中由于文件系统服务所在进程已经默认为 1 号进程 (起始进程为 0 号进程)，在测试时想启用文件系统需要注意 ENV_CREATE(fs_serv)在 init.c 中的位置。&lt;/strong&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;/div&gt;

  &lt;/div&gt;
  &lt;div class="vert vert-1" data-id="block-v1:Internal+B3I062140+2019_T2+type@discussion+block@201a93fb06a843d09ec5e384b3c5676e"&gt;
    &lt;div class="xblock xblock-student_view xblock-student_view-discussion" data-runtime-class="LmsRuntime" data-init="DiscussionInlineBlock" data-course-id="course-v1:Internal+B3I062140+2019_T2" data-request-token="03ca6f9e547511ea990d5254001c17d8" data-runtime-version="1" data-usage-id="block-v1:Internal+B3I062140+2019_T2+type@discussion+block@201a93fb06a843d09ec5e384b3c5676e" data-block-type="discussion"&gt;
  





&lt;script type="text/javascript"&gt;
  window.PLATFORM_NAME = "CSCore";
    window.ENABLE_DISCUSSION_HOME_PANEL = true;
&lt;/script&gt;



&lt;script aria-hidden="true" type="text/template" id="thread-template"&gt;
    &lt;article class="discussion-article" data-id="&lt;%- id %&gt;" tabindex="-1"&gt;
    &lt;div class="thread-wrapper"&gt;
        &lt;div class="thread-main-wrapper"&gt;
            &lt;div class="thread-content-wrapper"&gt;&lt;/div&gt;
            &lt;div class="post-extended-content"&gt;
                &lt;ol class="responses js-marked-answer-list"&gt;&lt;/ol&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="post-extended-content thread-responses-wrapper"&gt;
            &lt;div class="response-btn-count-wrapper"&gt;
                &lt;% if (!readOnly) { %&gt;
                &lt;div class="add-response"&gt;
                    &lt;button class="btn btn-small add-response-btn"&gt;
                        &lt;%- gettext("Add a Response") %&gt;
                    &lt;/button&gt;
                &lt;/div&gt;
                &lt;% } %&gt;
                &lt;div class="response-count"&gt;&lt;/div&gt;
            &lt;/div&gt;
            &lt;ol class="responses js-response-list"&gt;&lt;/ol&gt;
            &lt;div class="response-pagination"&gt;&lt;/div&gt;
            &lt;div class="post-status-closed bottom-post-status" style="display: none"&gt;
              &lt;%- gettext("This thread is closed.") %&gt;
            &lt;/div&gt;
            &lt;% if (can_create_comment &amp;&amp; !readOnly) { %&gt;
            &lt;form class="discussion-reply-new" data-id="&lt;%- id %&gt;"&gt;
                &lt;h4&gt;&lt;%- gettext("Add a response:") %&gt;&lt;/h4&gt;
                &lt;ul class="discussion-errors"&gt;&lt;/ul&gt;
                &lt;div class="reply-body" data-id="&lt;%- id %&gt;"&gt;&lt;/div&gt;
                &lt;div class="reply-post-control"&gt;
                    &lt;button class="btn discussion-submit-post control-button"&gt;&lt;%- gettext("Submit") %&gt;&lt;/button&gt;
                &lt;/div&gt;
            &lt;/form&gt;
            &lt;% } %&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/article&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-show-template"&gt;
    &lt;div class="discussion-post"&gt;
    &lt;header class="post-header"&gt;
        &lt;% if (!readOnly) { %&gt;
            &lt;div class="post-header-actions"&gt;
                &lt;%=
                _.template(
                    $('#forum-actions').html())(
                    {
                        contentId: cid,
                        contentType: 'post',
                        primaryActions: ['vote', 'follow'],
                        secondaryActions: ['pin', 'edit', 'delete', 'report', 'close'],
                        readOnly: readOnly
                    }
                )
                %&gt;
            &lt;/div&gt;
        &lt;% } %&gt;
        &lt;div class="post-header-content"&gt;
            &lt;h4 class="post-title"&gt;&lt;%- title %&gt;&lt;/h4&gt;
            &lt;p class="posted-details"&gt;
            &lt;%
            var timeAgoHtml = interpolate(
                '&lt;span class="timeago" title="%(created_at)s"&gt;%(created_at)s&lt;/span&gt;',
                {created_at: created_at},
                true
            );
            %&gt;
            &lt;%=
            interpolate(
                // Translators: post_type describes the kind of post this is (e.g. "question" or "discussion");
                // time_ago is how much time has passed since the post was created (e.g. "4 hours ago")
                _.escape(gettext('%(post_type)s posted %(time_ago)s by %(author)s')),
                {post_type: thread_type, time_ago: timeAgoHtml, author: author_display},
                true
            )
            %&gt;
            &lt;/p&gt;
            &lt;div class="post-labels"&gt;
                &lt;span class="post-label post-label-pinned"&gt;
                    &lt;span class="icon fa fa-thumb-tack" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Pinned") %&gt;
                &lt;/span&gt;
                &lt;span class="post-label post-label-reported"&gt;
                    &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Reported") %&gt;
                &lt;/span&gt;
                &lt;span class="post-label post-label-closed"&gt;
                    &lt;span class="icon fa fa-lock" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Closed") %&gt;
                &lt;/span&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/header&gt;

    &lt;div class="post-body"&gt;&lt;%- body %&gt;&lt;/div&gt;
    &lt;div class="post-context"&gt;
        &lt;% if (mode === "tab" &amp;&amp; obj.courseware_url) { %&gt;
            &lt;%
            var courseware_title_linked = interpolate(
                '&lt;a href="%(courseware_url)s"&gt;%(courseware_title)s&lt;/a&gt;',
                {courseware_url: courseware_url, courseware_title: _.escape(courseware_title)},
                true
            );
            %&gt;
            &lt;%=
            interpolate(
                _.escape(gettext('Related to: %(courseware_title_linked)s')),
                {courseware_title_linked: courseware_title_linked},
                true
            )
            %&gt;
        &lt;% } %&gt;
        &lt;div class="group-visibility-label"&gt;
            &lt;% if (obj.group_name) { %&gt;
                &lt;%-
                interpolate(
                    gettext('This post is visible only to %(group_name)s.'),
                    {group_name: obj.group_name},
                    true
                )
                %&gt;
            &lt;% } else { %&gt;
                &lt;%- gettext('This post is visible to everyone.') %&gt;
            &lt;% } %&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-edit-template"&gt;
    &lt;h4&gt;&lt;%- gettext("Editing post") %&gt;&lt;/h4&gt;
&lt;ul class="post-errors"&gt;&lt;/ul&gt;
&lt;div class="forum-edit-post-form-wrapper"&gt;&lt;/div&gt;
&lt;div class="post-field"&gt;
    &lt;label class="field-label"&gt;
        &lt;span class="field-label-text"&gt;&lt;%- gettext("Title") %&gt;&lt;/span&gt;
        &lt;div class="field-help" id="field_help_title"&gt;
            &lt;%- gettext("Add a clear and descriptive title to encourage participation.") %&gt;
        &lt;/div&gt;
        &lt;input aria-describedby="field_help_title" type="text" class="edit-post-title field-input" name="title" value="&lt;%- title %&gt;"&gt;
    &lt;/label&gt;
&lt;/div&gt;
&lt;div class="form-row post-field"&gt;
    &lt;p class="sr-only field-help" id="edit-post-editor-description"&gt;&lt;%- gettext('Edit your post below.') %&gt;&lt;/p&gt;
    &lt;div class="edit-post-body" aria-describedby="edit-post-editor-description" name="body"&gt;&lt;%- body %&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;button type="submit" id="edit-post-submit" class="btn-brand submit post-update"&gt;&lt;%- gettext("Update post") %&gt;&lt;/button&gt;
&lt;button class="btn post-cancel"&gt;&lt;%- gettext("Cancel") %&gt;&lt;/button&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-response-template"&gt;
    &lt;div class="discussion-response"&gt;&lt;/div&gt;
&lt;button class="btn-link action-show-comments"&gt;
    &lt;%
    var fmts = ngettext("Show Comment (%(num_comments)s)", "Show Comments (%(num_comments)s)", comments.length);
    print(interpolate(fmts, {num_comments: comments.length}, true));
    %&gt;
    &lt;span class="icon fa fa-caret-down" aria-hidden="true"&gt;&lt;/span&gt;
&lt;/button&gt;
&lt;ol class="comments"&gt;
    &lt;li class="new-comment"&gt;
        &lt;% if (create_sub_comment &amp;&amp; !readOnly) { %&gt;
            &lt;form class="comment-form" data-id="&lt;%- wmdId %&gt;"&gt;
                &lt;ul class="discussion-errors"&gt;&lt;/ul&gt;
                &lt;label class="sr" for="add-new-comment-&lt;%- wmdId %&gt;"&gt;&lt;%- gettext("Add a comment") %&gt;&lt;/label&gt;
                &lt;div class="comment-body" id="add-new-comment-&lt;%- wmdId %&gt;" data-id="&lt;%- wmdId %&gt;"
                data-placeholder="&lt;%- gettext('Add a comment') %&gt;"&gt;&lt;/div&gt;
                &lt;div class="comment-post-control"&gt;
                    &lt;button class="btn-brand discussion-submit-comment control-button"&gt;&lt;%- gettext("Submit") %&gt;&lt;/button&gt;
                &lt;/div&gt;
            &lt;/form&gt;
        &lt;% } %&gt;
    &lt;/li&gt;
&lt;/ol&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-response-show-template"&gt;
    &lt;header class="response-header"&gt;
  &lt;div class="response-header-content"&gt;
    &lt;%= author_display %&gt;
    &lt;p class="posted-details"&gt;
        &lt;span class="timeago" title="&lt;%= created_at %&gt;"&gt;&lt;%= created_at %&gt;&lt;/span&gt;
        &lt;% if (obj.endorsement &amp;&amp; obj.endorsed) { %&gt;
            -
            &lt;%
            var fmt = null;
            if (thread.get("thread_type") == "question") {
              if (endorsement.username) {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("marked as answer %(time_ago)s by %(user)s");
              } else {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("marked as answer %(time_ago)s");
              }
            } else {
              if (endorsement.username) {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("endorsed %(time_ago)s by %(user)s");
              } else {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("endorsed %(time_ago)s");
              }
            }
            var time_ago = interpolate(
              '&lt;span class="timeago" title="%(time)s"&gt;%(time)s&lt;/span&gt;',
              {time: endorsement.time},
              true
            );
            %&gt;
            &lt;%= interpolate(fmt, {time_ago: time_ago, user: endorser_display}, true) %&gt;
        &lt;% } %&gt;
      &lt;/p&gt;
      &lt;div class="post-labels"&gt;
          &lt;span class="post-label post-label-reported"&gt;
              &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Reported") %&gt;
          &lt;/span&gt;
      &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="response-header-actions"&gt;
        &lt;%=
            _.template(
                $('#forum-actions').html())(
                {
                    contentId: cid,
                    contentType: 'response',
                    primaryActions: ['vote', thread.get('thread_type') == 'question' ? 'answer' : 'endorse'],
                    secondaryActions: ['edit', 'delete', 'report'],
                    readOnly: readOnly
                }
            )
        %&gt;
      &lt;/div&gt;
&lt;/header&gt;

&lt;div class="response-body"&gt;&lt;%- body %&gt;&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-response-edit-template"&gt;
    &lt;div class="edit-post-form"&gt;
    &lt;h1&gt;&lt;%- gettext("Editing response") %&gt;&lt;/h1&gt;
    &lt;ul class="edit-post-form-errors"&gt;&lt;/ul&gt;
    &lt;div class="form-row"&gt;
        &lt;div class="edit-post-body" name="body" data-id="&lt;%- id %&gt;"&gt;&lt;%- body %&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;button type="submit" id="edit-response-submit"class="btn-brand post-update"&gt;&lt;%- gettext("Update response") %&gt;&lt;/button&gt;
    &lt;button class="btn post-cancel"&gt;&lt;%- gettext("Cancel") %&gt;&lt;/button&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="response-comment-show-template"&gt;
    &lt;div class="discussion-comment" id="comment_&lt;%- id %&gt;"&gt;
  &lt;div class="response-body"&gt;&lt;%- body %&gt;&lt;/div&gt;
  &lt;%=
      _.template(
          $('#forum-actions').html())(
          {
              contentId: cid,
              contentType: 'comment',
              primaryActions: [],
              secondaryActions: ['edit', 'delete', 'report'],
              readOnly: readOnly
          }
      )
  %&gt;
  &lt;p class="posted-details"&gt;
    &lt;%
    var time_ago = interpolate(
      '&lt;span class="timeago" title="%(time)s"&gt;%(time)s&lt;/span&gt;',
      {time: created_at},
      true
    );
    %&gt;
    &lt;%= interpolate(
      // Translators: 'timeago' is a placeholder for a fuzzy, relative timestamp (see: https://github.com/rmm5t/jquery-timeago)
      gettext("posted %(time_ago)s by %(author)s"),
      {time_ago: time_ago, author: author_display},
      true
    ) %&gt;
  &lt;/p&gt;
  &lt;div class="post-labels"&gt;
    &lt;span class="post-label post-label-reported"&gt;
      &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Reported") %&gt;
    &lt;/span&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="response-comment-edit-template"&gt;
    &lt;div class="edit-post-form" id="comment_&lt;%- id %&gt;"&gt;
    &lt;h1&gt;&lt;%- gettext("Editing comment") %&gt;&lt;/h1&gt;
    &lt;ul class="edit-comment-form-errors"&gt;&lt;/ul&gt;
    &lt;div class="form-row"&gt;
        &lt;div class="edit-comment-body" name="body" data-id="&lt;%- id %&gt;"&gt;&lt;%- body %&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;button type="submit" id="edit-comment-submit" class="btn-brand post-update"&gt;&lt;%- gettext("Update comment") %&gt;&lt;/button&gt;
    &lt;button class="btn post-cancel"&gt;&lt;%- gettext("Cancel") %&gt;&lt;/button&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-list-item-template"&gt;
    &lt;li data-id="&lt;%- id %&gt;" class="forum-nav-thread&lt;% if (neverRead) { %&gt; never-read&lt;% } %&gt;"&gt;
  &lt;a href="&lt;%- threadUrl %&gt;" class="forum-nav-thread-link"&gt;
    &lt;div class="forum-nav-thread-wrapper-0"&gt;
      &lt;%
      var icon_class, sr_text;
      if (thread_type === "discussion") {
          icon_class = "fa-comments";
          // Translators: This is a label for a Discussion forum thread
          sr_text = gettext("discussion");
      } else if (endorsed) {
          icon_class = "fa-check-square-o";
          // Translators: This is a label for a Question forum thread with a marked answer
          sr_text = gettext("answered question");
      } else {
          icon_class = "fa-question";
          // Translators: This is a label for a Question forum thread without a marked answer
          sr_text = gettext("unanswered question");
      }
      %&gt;
      &lt;span class="sr"&gt;&lt;%= sr_text %&gt;&lt;/span&gt;
      &lt;span class="icon fa &lt;%= icon_class %&gt;" aria-hidden="true"&gt;&lt;/span&gt;
    &lt;/div&gt;&lt;div class="forum-nav-thread-wrapper-1"&gt;
      &lt;span class="forum-nav-thread-title"&gt;&lt;%- title %&gt;&lt;/span&gt;
      &lt;% if (showThreadPreview){ %&gt;
        &lt;div class="thread-preview-body"&gt;&lt;%- threadPreview %&gt;&lt;/div&gt;
      &lt;% } %&gt;
      &lt;% if(typeof(subscribed) === "undefined") { var subscribed = null; } %&gt;
      &lt;% if(pinned || subscribed || staff_authored || community_ta_authored) { %&gt;
        &lt;ul class="forum-nav-thread-labels"&gt;
        &lt;% if (pinned) { %&gt;
          &lt;li class="post-label post-label-pinned"&gt;
            &lt;span class="icon fa fa-thumb-tack" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that has been pinned %&gt;
            &lt;%- gettext("Pinned") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (subscribed) { %&gt;
          &lt;li class="post-label post-label-following"&gt;
            &lt;span class="icon fa fa-star" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that the user is subscribed to %&gt;
            &lt;%- gettext("Following") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (staff_authored) { %&gt;
          &lt;li class="post-label post-label-by-staff"&gt;
            &lt;span class="icon fa fa-user" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that was authored by a member of the course staff %&gt;
            &lt;%- gettext("Staff") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (community_ta_authored) { %&gt;
          &lt;li class="post-label post-label-by-community-ta"&gt;
            &lt;span class="icon fa fa-user" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that was authored by a community TA %&gt;
            &lt;%- gettext("Community TA") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;/ul&gt;
      &lt;% } %&gt;
    &lt;/div&gt;&lt;div class="forum-nav-thread-wrapper-2"&gt;
      &lt;%
      // Translators: 'votes_count' is a numerical placeholder for a specific discussion thread; 'span_start' and 'span_end' placeholders refer to HTML markup.  Please translate the word 'votes'.
      var fmt = ngettext(
           "%(votes_count)s%(span_start)s vote %(span_end)s",
           "%(votes_count)s%(span_start)s votes %(span_end)s",
           votes['up_count']
      );
      %&gt;
      &lt;span class="forum-nav-thread-votes-count"&gt;
      +&lt;%= interpolate(fmt, {
               votes_count: votes['up_count'],
               span_start: '&lt;span class="sr"&gt;',
               span_end: '&lt;/span&gt;'
            }, true)
      %&gt;
      &lt;/span&gt;

      &lt;% if (!neverRead &amp;&amp; unread_comments_count &gt; 0) { %&gt;
        &lt;span class="forum-nav-thread-unread-comments-count"&gt;
          &lt;%-
            StringUtils.interpolate(
              gettext('{unread_comments_count} new'),
              {unread_comments_count: unread_comments_count}
            )
          %&gt;
        &lt;/span&gt;
      &lt;% } %&gt;

      &lt;span class="forum-nav-thread-comments-count"&gt;
      &lt;%
      var fmt;
      // Counts in data do not include the post itself, but the UI should
      var data = {
          'span_sr_open': '&lt;span class="sr"&gt;',
          'span_close': '&lt;/span&gt;',
          'unread_comments_count': unread_comments_count + (read ? 0 : 1),
          'comments_count': comments_count + 1
      };
      if (unread_comments_count &gt; 0) {
          // Translators: 'comments_count' and 'unread_comments_count' are numerical placeholders for a specific discussion thread; 'span_*' placeholders refer to HTML markup.  Please translate the word 'comments'.
          fmt = gettext('%(comments_count)s %(span_sr_open)scomments (%(unread_comments_count)s unread comments)%(span_close)s');
      } else {
          // Translators: 'comments_count' is a numerical placeholder for a specific discussion thread; 'span_*' placeholders refer to HTML markup.  Please translate the word 'comments'.
          fmt = gettext('%(comments_count)s %(span_sr_open)scomments %(span_close)s');
      }
      print(interpolate(fmt, data, true));
      %&gt;
      &lt;/span&gt;
    &lt;/div&gt;
  &lt;/a&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="search-alert-template"&gt;
    &lt;div class="search-alert &lt;%- css_class %&gt;" id="search-alert-&lt;%- cid %&gt;"&gt;
    &lt;div class="search-alert-content"&gt;
        &lt;p class="message"&gt;&lt;%= HtmlUtils.ensureHtml(messageHtml) %&gt;&lt;/p&gt;
    &lt;/div&gt;

    &lt;div class="search-alert-controls"&gt;
        &lt;button class="btn-link dismiss control control-dismiss" title="&lt;%- gettext('Close') %&gt;"&gt;
            &lt;span class="icon fa fa-remove" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/button&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-template"&gt;
    &lt;form class="forum-new-post-form"&gt;
    &lt;h3 class="thread-title"&gt;&lt;%- gettext("Add a Post") %&gt;&lt;/h3&gt;
    &lt;% if (mode === 'inline') { %&gt;
        &lt;button class="btn-default add-post-cancel"&gt;
            &lt;span class="sr"&gt;&lt;%- gettext('Cancel') %&gt;&lt;/span&gt;
            &lt;span class="fa fa-close" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/button&gt;
    &lt;% } %&gt;
    &lt;ul class="post-errors" style="display: none"&gt;&lt;/ul&gt;
    &lt;div class="forum-new-post-form-wrapper"&gt;&lt;/div&gt;
    &lt;% if (cohort_options) { %&gt;
    &lt;div class="post-field group-selector-wrapper &lt;% if (!is_commentable_cohorted) { print('disabled'); } %&gt;"&gt;
        &lt;label class="field-label"&gt;
            &lt;span class="field-label-text"&gt;
                &lt;% //Translators: This labels the selector for which group of students can view a post %&gt;
                &lt;%- gettext("Visible to") %&gt;
            &lt;/span&gt;
            &lt;div class="field-help" id="field_help_visible_to"&gt;
                &lt;%- gettext("Discussion admins, moderators, and TAs can make their posts visible to all students or specify a single cohort.") %&gt;
            &lt;/div&gt;
            &lt;div class="field-input"&gt;
                &lt;select aria-describedby="field_help_visible_to" class="post-topic field-input js-group-select" name="group_id" &lt;% if (!is_commentable_cohorted) { print("disabled"); } %&gt;&gt;
                    &lt;option value=""&gt;&lt;%- gettext("All Groups") %&gt;&lt;/option&gt;
                    &lt;% _.each(cohort_options, function(opt) { %&gt;
                    &lt;option value="&lt;%- opt.value %&gt;" &lt;% if (opt.selected) { print("selected"); } %&gt;&gt;&lt;%- opt.text %&gt;&lt;/option&gt;
                    &lt;% }); %&gt;
                &lt;/select&gt;
            &lt;/div&gt;
        &lt;/label&gt;
    &lt;/div&gt;
    &lt;% } %&gt;
    &lt;div class="post-field"&gt;
        &lt;label class="field-label"&gt;
            &lt;span class="field-label-text"&gt;&lt;%- gettext("Title") %&gt;&lt;/span&gt;
            &lt;div class="field-help" id="field_help_title"&gt;
                &lt;%- gettext("Add a clear and descriptive title to encourage participation.") %&gt;
            &lt;/div&gt;
            &lt;div&gt;
                &lt;input aria-describedby="field_help_title" type="text" class="js-post-title field-input" name="title"&gt;
            &lt;/div&gt;
        &lt;/label&gt;
    &lt;/div&gt;

    &lt;div&gt;
        &lt;span class="field-label-text field-label-text-full" id="new-post-editor-description"&gt;&lt;%- gettext('Your question or idea') %&gt;&lt;/span&gt;
        &lt;div class="js-post-body editor" aria-describedby="new-post-editor-description" name="body"&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="post-options"&gt;
        &lt;label class="post-option is-enabled"&gt;
            &lt;input type="checkbox" name="follow" class="post-option-input js-follow" checked&gt;
            &lt;span class="icon fa fa-star" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("follow this post") %&gt;
        &lt;/label&gt;
        &lt;% if (allow_anonymous) { %&gt;
        &lt;label class="post-option"&gt;
            &lt;input type="checkbox" name="anonymous" class="post-option-input js-anon"&gt;
            &lt;%- gettext("post anonymously") %&gt;
        &lt;/label&gt;
        &lt;% } %&gt;
        &lt;% if (allow_anonymous_to_peers) { %&gt;
        &lt;label class="post-option"&gt;
            &lt;input type="checkbox" name="anonymous_to_peers" class="post-option-input js-anon-peers"&gt;
            &lt;%- gettext("post anonymously to classmates") %&gt;
        &lt;/div&gt;
        &lt;% } %&gt;
    &lt;/div&gt;
    &lt;div&gt;
        &lt;button type="submit" class="btn-brand submit"&gt;&lt;%- gettext('Submit') %&gt;&lt;/button&gt;
        &lt;button type="button" class="btn cancel"&gt;&lt;%- gettext('Cancel') %&gt;&lt;/button&gt;
    &lt;/div&gt;
&lt;/form&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-menu-entry-template"&gt;
    &lt;option class="topic-title" data-discussion-id="&lt;%- id %&gt;" data-cohorted="&lt;%- is_cohorted %&gt;"&gt;&lt;%- text %&gt;&lt;/option&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-menu-category-template"&gt;
    &lt;optgroup label="&lt;%- text %&gt;"&gt;
    &lt;%= edx.HtmlUtils.ensureHtml(entries) %&gt;
&lt;/optgroup&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-alert-template"&gt;
    &lt;div class="alert alert-error pattern-library-shim" role="alert" aria-labelledby="alert-title-error-&lt;%- alertId %&gt;" tabindex="-1"&gt;
    &lt;span class="icon alert-icon fa fa-warning" aria-hidden="true"&gt;&lt;/span&gt;

    &lt;div class="alert-message"&gt;
        &lt;h3 class="sr-only alert-title" id="alert-title-error-&lt;%- alertId %&gt;"&gt;
            &lt;%- gettext("Error posting your message.") %&gt;
        &lt;/h3&gt;

        &lt;p class="alert-copy"&gt;
            &lt;%- gettext(message) %&gt;
        &lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="topic-template"&gt;
    &lt;div class="post-field"&gt;
    &lt;label class="field-label"&gt;
        &lt;span class="field-label-text"&gt;
            &lt;%- gettext("Topic area") %&gt;
        &lt;/span&gt;
        &lt;div class="field-help" id="field_help_topic_area"&gt;
            &lt;%- gettext("Add your post to a relevant topic to help others find it.") %&gt;
        &lt;/div&gt;
        &lt;div class="field-input"&gt;
            &lt;select class="post-topic field-input" aria-describedby="field_help_topic_area" required&gt;
                &lt;%= edx.HtmlUtils.ensureHtml(topics_html) %&gt;
            &lt;/select&gt;
        &lt;/div&gt;
    &lt;/label&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="post-user-display-template"&gt;
    &lt;% if (username) { %&gt;
&lt;a href="&lt;%- user_url %&gt;" class="username"&gt;&lt;%- username %&gt;&lt;/a&gt;
    &lt;% if (is_community_ta) { %&gt;
    &lt;span class="user-label-community-ta"&gt;&lt;%- gettext("Community TA") %&gt;&lt;/span&gt;
    &lt;% } else if (is_staff) { %&gt;
    &lt;span class="user-label-staff"&gt;&lt;%- gettext("Staff") %&gt;&lt;/span&gt;
    &lt;% } %&gt;
&lt;% } else { %&gt;
    &lt;%- gettext('anonymous') %&gt;
&lt;% } %&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="inline-discussion-template"&gt;
    &lt;section class="discussion inline-discussion" data-discussion-id="&lt;%- discussionId %&gt;"&gt;
    &lt;div class="add_post_btn_container &lt;%if (read_only) {%&gt;is-hidden&lt;%} %&gt;"&gt;
        &lt;button class="btn-link new-post-btn"&gt;&lt;%- gettext("Add a Post") %&gt;&lt;/button&gt;
    &lt;/div&gt;

    &lt;article class="new-post-article is-hidden"&gt;&lt;/article&gt;

    &lt;div class="inline-discussion-thread-container"&gt;
        &lt;section class="inline-threads"&gt;
        &lt;/section&gt;

        &lt;div class="inline-thread"&gt;
            &lt;div class="forum-nav-bar"&gt;
                &lt;button class="btn-link all-posts-btn"&gt;
                    &lt;span class="icon fa fa-chevron-prev" aria-hidden="true"&gt;&lt;/span&gt;
                    &lt;span aria-hidden="true"&gt;&lt;%- gettext('All Posts') %&gt;&lt;/span&gt;
                    &lt;span class="sr-only"&gt;&lt;%- gettext('Return to all posts') %&gt;&lt;/span&gt;
                &lt;/button&gt;
            &lt;/div&gt;
            &lt;div class="forum-content"&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/section&gt;


&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="pagination-template"&gt;
    &lt;nav class="discussion-paginator"&gt;
    &lt;ol&gt;
        &lt;% if (previous) { %&gt;
            &lt;li class="previous-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= previous.url %&gt;" data-page-number="&lt;%= previous.number %&gt;"&gt;&amp;lt; &lt;%- gettext("Previous") %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (first) { %&gt;
            &lt;li class="first-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= first.url %&gt;" data-page-number="1"&gt;1&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (leftdots) { %&gt;
            &lt;li class="previous-ellipses"&gt;&lt;%- gettext("…") %&gt;&lt;/li&gt;
        &lt;% } %&gt;

        &lt;% _.each(lowPages, function(page) { %&gt;
            &lt;li class="lower-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= page.url %&gt;" data-page-number="&lt;%= page.number %&gt;"&gt;&lt;%= page.number %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% }); %&gt;
        &lt;li class="current-page"&gt;&lt;span&gt;&lt;%= page %&gt;&lt;/span&gt;&lt;/li&gt;
        &lt;% _.each(highPages, function(page) { %&gt;
            &lt;li class="higher-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= page.url %&gt;" data-page-number="&lt;%= page.number %&gt;"&gt;&lt;%= page.number %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% }); %&gt;

        &lt;% if (rightdots) { %&gt;
            &lt;li class="next-ellipses"&gt;&lt;%- gettext("…") %&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (last) { %&gt;
            &lt;li class="last-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= last.url %&gt;" data-page-number="&lt;%= last.number %&gt;"&gt;&lt;%= last.number %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (next) { %&gt;
            &lt;li class="next-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= next.url %&gt;" data-page-number="&lt;%= next.number %&gt;"&gt;&lt;%- gettext("Next") %&gt; &amp;gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
    &lt;/ol&gt;
&lt;/nav&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="profile-thread-template"&gt;
    &lt;article class="discussion-article" data-id="&lt;%- id %&gt;"&gt;
    &lt;div class="discussion-post"&gt;
        &lt;header&gt;
            &lt;h3&gt;&lt;%- title %&gt;&lt;/h3&gt;
            &lt;p class="posted-details"&gt;
                &lt;% if (user) { %&gt;
                    &lt;a href="&lt;%- user.url %&gt;" class="username"&gt;&lt;%- user.username %&gt;&lt;/a&gt;
                &lt;% } else { %&gt;
                    &lt;%- gettext("anonymous") %&gt;
                &lt;% } %&gt;

                &lt;span class="timeago" title="&lt;%- created_at %&gt;"&gt;&lt;%- created_at %&gt;&lt;/span&gt;
                &lt;span class="post-status-closed top-post-status" style="display: none"&gt;
                    &amp;bull; &lt;%- gettext("This thread is closed.") %&gt;
                &lt;/span&gt;
            &lt;/p&gt;
        &lt;/header&gt;
        &lt;div class="post-body"&gt;&lt;%= abbreviatedBody %&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="post-tools"&gt;
        &lt;a href="&lt;%- permalink %&gt;"&gt;&lt;%- gettext("View discussion") %&gt;&lt;/a&gt;
    &lt;/div&gt;

&lt;/article&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="customwmd-prompt-template"&gt;
    &lt;h4 id="editor-dialog-title"&gt;&lt;%- title %&gt;&lt;/h4&gt;
&lt;div role="status" id="wmd-editor-dialog-form-errors" class="sr" tabindex="-1"&gt;&lt;/div&gt;
&lt;div&gt;
    &lt;form class="form"&gt;
        &lt;fieldset class="field-group"&gt;
            &lt;legend class="form-group-hd sr"&gt;&lt;%- title %&gt;&lt;/legend&gt;
            &lt;div class="field &lt;%- uploadFieldClass %&gt;"&gt;
                &lt;label id="new-url-input-label" for="new-url-input" class="field-label"&gt;
                    &lt;%- urlLabel %&gt;&lt;/label&gt;
                &lt;input type="text" id="new-url-input" class="field-input input-text" aria-describedby="new-url-input-help"&gt;
                &lt;% if (imageUploadHandler) { %&gt;
                    &lt;button id="file-upload-proxy" class="btn btn-primary btn-base form-btn"&gt;
                        &lt;%- chooseFileText %&gt;
                    &lt;/button&gt;
                    &lt;input type="file" name="file-upload" id="file-upload" style="display:none;"/&gt;
                &lt;% } %&gt;
                &lt;div id="new-url-input-field-message" class="field-message has-error" style="display:none"&gt;
                    &lt;span class="field-message-content"&gt;&lt;%- urlError %&gt;&lt;/span&gt;
                &lt;/div&gt;
                &lt;div id="new-url-input-help" class="field-hint"&gt;
                    &lt;%- urlHelp %&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="field"&gt;
                &lt;label for="new-url-desc-input" class="field-label"&gt;&lt;%- urlDescLabel %&gt;&lt;/label&gt;
                &lt;input type="text" id="new-url-desc-input" class="field-input input-text" required aria-describedby="new-url-desc-input-help"&gt;
                &lt;div id="new-url-desc-input-field-message" class="field-message has-error" style="display:none"&gt;
                    &lt;span class="field-message-content"&gt;&lt;%- descError %&gt;&lt;/span&gt;
                &lt;/div&gt;
                &lt;div id="new-url-desc-input-help" class="field-hint"&gt;
                    &lt;%- urlDescHelp %&gt;
                    &lt;% if (urlDescHelpLink) { %&gt;
                        &lt;a href="&lt;%- urlDescHelpLink['href'] %&gt;"&gt;
                            &lt;%- urlDescHelpLink['text'] %&gt;
                        &lt;/a&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="field"&gt;&lt;% if (imageUploadHandler) { %&gt;
                &lt;label for="img-is-decorative" class="field-label label-inline"&gt;
                    &lt;input type="checkbox" id="img-is-decorative" class="field-input input-checkbox"&gt;
                    &lt;span class="field-input-label"&gt;&lt;%- imageIsDecorativeLabel %&gt;&lt;/span&gt;
                &lt;/label&gt; &lt;% }
            %&gt;&lt;/div&gt;
        &lt;/fieldset&gt;
        &lt;div class="form-actions"&gt;
            &lt;input type="button" id="new-link-image-ok" class="btn-brand form-btn" value="&lt;%- okText %&gt;" /&gt;
            &lt;input type="button" id="new-link-image-cancel" class="btn form-btn" value="&lt;%- cancelText %&gt;" &gt;
        &lt;/div&gt;
    &lt;/form&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="nav-loading-template"&gt;
    &lt;div class="forum-nav-loading" tabindex="0"&gt;
    &lt;span class="icon fa fa-spinner fa-spin"/&gt;
    &lt;span class="sr" role="alert"&gt;&lt;%- srText %&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-type-template"&gt;
    &lt;div class="post-field"&gt;
    &lt;div class="field-label"&gt;
        &lt;span class="field-label-text"&gt;
            &lt;% // Translators: This is the label for a control to select a forum post type %&gt;
            &lt;%- gettext("Post type") %&gt;
        &lt;/span&gt;
        &lt;div class="field-help" id="field_help_post_type"&gt;
            &lt;%- gettext("Questions raise issues that need answers. Discussions share ideas and start conversations.") %&gt;
        &lt;/div&gt;
        &lt;div class="field-label"&gt;
            &lt;fieldset class="field-input"&gt;
                &lt;legend class="sr"&gt;&lt;%- gettext("Post type") %&gt;&lt;/legend&gt;
                &lt;input aria-describedby="field_help_post_type" type="radio" name="&lt;%= form_id %&gt;-post-type" class="post-type-input" id="&lt;%= form_id %&gt;-post-type-question" value="question"&gt;
                &lt;label for="&lt;%= form_id %&gt;-post-type-question" class="post-type-label"&gt;
                    &lt;span class="icon fa fa-question" aria-hidden="true"&gt;&lt;/span&gt;
                    &lt;% // Translators: This is a forum post type %&gt;
                    &lt;%- gettext("Question") %&gt;
                &lt;/label&gt;
                &lt;input aria-describedby="field_help_post_type" type="radio" name="&lt;%= form_id %&gt;-post-type" class="post-type-input" id="&lt;%= form_id %&gt;-post-type-discussion" value="discussion" checked&gt;
                &lt;label for="&lt;%= form_id %&gt;-post-type-discussion" class="post-type-label"&gt;
                    &lt;span class="icon fa fa-comments" aria-hidden="true"&gt;&lt;/span&gt;
                    &lt;% // Translators: This is a forum post type %&gt;
                    &lt;%- gettext("Discussion") %&gt;
                &lt;/label&gt;
            &lt;/fieldset&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;


&lt;script aria-hidden="true" type="text/template" id="forum-action-endorse"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-button action-endorse" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Endorse") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Endorse") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unendorse") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-check" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-answer"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-button action-answer" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Mark as Answer") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Mark as Answer") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unmark as Answer") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-check" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-follow"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-button action-follow" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Follow") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Follow") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unfollow") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-star" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-vote"&gt;
    &lt;li class="actions-item"&gt;
    &lt;span aria-hidden="true" class="display-vote is-hidden" &gt;
      &lt;span class="vote-count"&gt;&lt;/span&gt;
    &lt;/span&gt;
    &lt;button class="btn-link action-button action-vote" role="checkbox" aria-checked="false"&gt;
        &lt;% // Vote counts are populated by JS %&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Vote for this post,") %&gt;&amp;nbsp;&lt;/span&gt;
        &lt;span class="sr js-sr-vote-count"&gt;&lt;/span&gt;

        &lt;span class="action-label" aria-hidden="true"&gt;
          &lt;span class="vote-count"&gt;&lt;/span&gt;
        &lt;/span&gt;

        &lt;span class="action-icon" aria-hidden="true"&gt;
            &lt;span class="icon fa fa-plus" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-report"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-report" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Report abuse") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Report") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unreport") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;
          &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-pin"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-pin" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Pin") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Pin") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unpin") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;
          &lt;span class="icon fa fa-thumb-tack" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-close"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-close" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Close") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Close") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Open") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;
          &lt;span class="icon fa fa-lock" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-edit"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-edit"&gt;
        &lt;span class="action-label"&gt;&lt;%- gettext("Edit") %&gt;&lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-pencil" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-delete"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-delete"&gt;
        &lt;span class="action-label"&gt;&lt;%- gettext("Delete") %&gt;&lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-remove" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-actions"&gt;
    &lt;% if (!readOnly) { %&gt;
    &lt;ul class="&lt;%= contentType %&gt;-actions-list"&gt;
        &lt;% _.each(primaryActions, function(action) { print(_.template($('#forum-action-' + action).html())({})) }) %&gt;
        &lt;li class="actions-item is-visible"&gt;
            &lt;div class="more-wrapper"&gt;
                &lt;button class="btn-link action-button action-more" aria-label="&lt;%- gettext('More') %&gt;" aria-haspopup="true" aria-controls="action-menu-&lt;%= contentType %&gt;"&gt;
                    &lt;span class="action-label"&gt;&lt;%- gettext('More') %&gt;&lt;/span&gt;
                    &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-ellipsis-h" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;/button&gt;
                &lt;div class="actions-dropdown" id="action-menu-&lt;%= contentType %&gt;" aria-expanded="false"&gt;
                  &lt;ul class="actions-dropdown-list"&gt;
                    &lt;% _.each(secondaryActions, function(action) { print(_.template($('#forum-action-' + action).html())({})) }) %&gt;
                  &lt;/ul&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/li&gt;
    &lt;/ul&gt;
&lt;% } %&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="alert-popup"&gt;
    &lt;div class='modal' role='alertdialog' id='discussion-alert' aria-describedby='discussion-alert-message'&gt;
    &lt;div class='inner-wrapper discussion-alert-wrapper'&gt;
        &lt;button class='btn close-modal dismiss' title='&lt;%- gettext("Close") %&gt;''&gt;
            &lt;span class='icon fa fa-times' aria-hidden='true'&gt;&lt;/span&gt;
        &lt;/button&gt;
        &lt;header&gt;
            &lt;h2/&gt;&lt;/h2&gt;
            &lt;hr/&gt;
        &lt;/header&gt;
        &lt;p id='discussion-alert-message'&gt;&lt;/p&gt;
        &lt;hr/&gt;
        &lt;button class='btn dismiss'&gt;&lt;%- gettext("OK") %&gt;&lt;/button&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="nav-load-more-link"&gt;
    &lt;li class='forum-nav-load-more'&gt;
    &lt;button class='btn-link forum-nav-load-more-link'&gt;
        &lt;%- gettext("Load more") %&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;



&lt;script type="text/template" id="thread-list-template"&gt;
    &lt;div class="forum-nav-thread-list-wrapper" id="sort-filter-wrapper" tabindex="-1"&gt;
        &lt;div class="forum-nav-refine-bar"&gt;
            &lt;label class="forum-nav-filter-main"&gt;
                &lt;span class="sr"&gt;Filter:&lt;/span&gt;
                &lt;select class="forum-nav-filter-main-control"&gt;
                    &lt;option value="all"&gt;显示全部&lt;/option&gt;
                    &lt;option value="unread"&gt;Unread&lt;/option&gt;
                    &lt;option value="unanswered"&gt;Unanswered&lt;/option&gt;
                &lt;/select&gt;
            &lt;/label&gt;&lt;% if (isCohorted &amp;&amp; isPrivilegedUser) { %&gt;&lt;label class="forum-nav-filter-cohort"&gt;
                &lt;span class="sr"&gt;Cohort:&lt;/span&gt;
                &lt;select class="forum-nav-filter-cohort-control"&gt;
                    &lt;option value=""&gt;in all cohorts&lt;/option&gt;
                &lt;/select&gt;
            &lt;/label&gt;&lt;% } %&gt;&lt;label class="forum-nav-sort"&gt;
                &lt;span class="sr"&gt;Sort:&lt;/span&gt;
                &lt;select class="forum-nav-sort-control"&gt;
                    &lt;option value="activity"&gt;近期活动&lt;/option&gt;
                    &lt;option value="comments"&gt;活跃度&lt;/option&gt;
                    &lt;option value="votes"&gt;最多票数&lt;/option&gt;
                &lt;/select&gt;
            &lt;/label&gt;
        &lt;/div&gt;
        &lt;div class="search-alerts"&gt;&lt;/div&gt;
        &lt;ul class="forum-nav-thread-list"&gt;&lt;/ul&gt;
    &lt;/div&gt;
&lt;/script&gt;




&lt;div class="discussion-module" data-discussion-id="c8883455a47656f70bc6b6aa32cc3a1edfac1e12"
    data-user-create-comment="true"
    data-user-create-subcomment="true"
    data-read-only="false"&gt;
    &lt;div class="discussion-module-header"&gt;
        &lt;h3 class="discussion-module-title"&gt;讨论&lt;/h3&gt;
        &lt;div class="inline-discussion-topic"&gt;&lt;span class="inline-discussion-topic-title"&gt;Topic:&lt;/span&gt; 管道与shell：管道 / 管道的读写&lt;/div&gt;
    &lt;/div&gt;
    &lt;button class="discussion-show btn" data-discussion-id="c8883455a47656f70bc6b6aa32cc3a1edfac1e12"&gt;
        &lt;span class="button-text"&gt;显示讨论&lt;/span&gt;
    &lt;/button&gt;
&lt;/div&gt;
&lt;script type="text/javascript"&gt;
var $$course_id = "course\u002Dv1:Internal+B3I062140+2019_T2";

function DiscussionInlineBlock(runtime, element) {
    'use strict';
    new DiscussionInlineView({ el: $(element).find('.discussion-module') });
}
&lt;/script&gt;

&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;

  </div>
  <div id="seq_contents_3" aria-labelledby="tab_3" aria-hidden="true" class="seq_contents tex2jax_ignore asciimath2jax_ignore">
    &lt;div class="xblock xblock-student_view xblock-student_view-vertical" data-runtime-class="LmsRuntime" data-init="VerticalStudentView" data-course-id="course-v1:Internal+B3I062140+2019_T2" data-request-token="03ca6f9e547511ea990d5254001c17d8" data-runtime-version="1" data-usage-id="block-v1:Internal+B3I062140+2019_T2+type@vertical+block@5a48091cd0474bc3a261fecc92e8d1b5" data-block-type="vertical"&gt;
  

  &lt;h3 class="unit-title"&gt;管道的竞争&lt;/h3&gt;

    


&lt;div class="bookmark-button-wrapper"&gt;
  &lt;button class="btn btn-link bookmark-button "
    aria-pressed="false"
    data-bookmark-id="18231047,block-v1:Internal+B3I062140+2019_T2+type@vertical+block@5a48091cd0474bc3a261fecc92e8d1b5"&gt;
     &lt;span class="sr bookmark-sr"&gt;Click to add&lt;/span&gt;
     &lt;span class="bookmark-text"&gt;Bookmark this page&lt;/span&gt;
    &lt;/button&gt;
&lt;/div&gt;


&lt;div class="vert-mod"&gt;
  &lt;div class="vert vert-0" data-id="block-v1:Internal+B3I062140+2019_T2+type@html+block@d740c470397d41a8b6e604e468f549e9"&gt;
    &lt;div class="xblock xblock-student_view xblock-student_view-html xmodule_display xmodule_HtmlModule" data-runtime-class="LmsRuntime" data-init="XBlockToXModuleShim" data-block-type="html" data-request-token="03ca6f9e547511ea990d5254001c17d8" data-runtime-version="1" data-usage-id="block-v1:Internal+B3I062140+2019_T2+type@html+block@d740c470397d41a8b6e604e468f549e9" data-type="HTMLModule" data-course-id="course-v1:Internal+B3I062140+2019_T2"&gt;
  &lt;script type="json/xblock-args" class="xblock-json-init-args"&gt;
    {"xmodule-type": "HTMLModule"}
  &lt;/script&gt;
  &lt;p&gt;我们的小操作系统采用的是时间片轮转调度的进程调度算法，这点你应该在 lab3 中就深有体会了。这种抢占式的进程管理就意味着，用户进程随时有可能会被打断。&lt;/p&gt;
&lt;p&gt;当然，如果进程间是孤立的，随时打断也没有关系。但当多个进程共享同一个变量时，执行同一段代码，不同的进程执行顺序有可能产生完全不同的结果，造成运行结果的不确定性。而进程通信需要共享（不论是管道还是共享内存），所以我们要对进程中共享变量的读写操作有足够高的警惕。&lt;/p&gt;
&lt;p&gt;实际上，因为管道本身的共享性质，所以在管道中有一系列的竞争情况。在当前这种不加锁控制的情况下，我们无法保证_pipeisclosed用于管道另一端关闭的判断一定返回正确的结果。&lt;/p&gt;
&lt;p&gt;我们重新看之前写的_pipeisclosed函数。在这个函数中我们对pageref(fd structure)与pageref(pipe structure)进行了等价关系的判断。假如不考虑进程竞争，不论是在读者还是写者进程中，我们会认为:&lt;/p&gt;
&lt;p&gt;&amp;bull; 对 fd 和对 pipe 的 pp_ref 的写入是同步的。&lt;/p&gt;
&lt;p&gt;&amp;bull; 对 fd 和对 pipe 的 pp_ref 的读取是同步的。&lt;/p&gt;
&lt;p&gt;但现在我们处于进程竞争、执行顺序不定的情景下，上述两种情况现在都会出现不同步的现象。想想看，如果在下面这种场景下，我们前面提到的等式还是恒成立的吗：&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&amp;nbsp;pipe(p);&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;if(fork() == 0 ){&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 30px;"&gt;close(p[1]);&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 30px;"&gt;read(p[0],buf,sizeof buf);&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;}else{&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 30px;"&gt;close(p[0]);&lt;/p&gt;
&lt;p style="margin: 0px; padding-left: 30px;"&gt;write(p[1],"Hello",5);&lt;/p&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;}&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&amp;bull; fork 结束后，子进程先执行。时钟中断产生在 close(p[1]) 与 read 之间，父进程开始执行。&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&amp;bull; 父进程在 close(p[0]) 中，p[0] 已经解除了对 pipe 的映射 (unmap)，还没有来得及解除对 p[0] 的映射，时钟中断产生，子进程接着执行。&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&amp;bull; 注意此时各个页的引用情况：pageref(p[0]) = 2(因为父进程还没有解除对 p[0] 的映射)，而 pageref(p[1]) = 1(因为子进程已经关闭了 p[1])。但注意，此时 pipe 的pageref 是 2，子进程中 p[0] 引用了 pipe，同时父进程中 p[0] 刚解除对 pipe 的映射，所以在父进程中也只有 p[1] 引用了 pipe。&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&lt;/p&gt;
&lt;p style="margin: 0px;"&gt;&amp;bull; 子进程执行 read，read 中首先判断写者是否关闭。比较 pageref(pipe) 与 pageref(p[0])之后发现它们都是 2，说明写端已经关闭，于是子进程退出。&lt;/p&gt;
&lt;p&gt;&lt;span style="color: #0000ff;"&gt;Thinking 6.2 上面这种不同步修改 pp_ref 而导致的进程竞争问题在 user/fd.c 中的dup 函数中也存在。请结合代码模仿上述情景，分析一下我们的 dup 函数中为什么会出现预想之外的情况？&amp;nbsp;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;那看到这里你有可能会问：在 close 中，既然问题出现在两次 unmap 之间，那么我们为什么不能使两次 unmap 统一起来是一个原子操作呢？要注意，在我们的小操作系统中，只有 syscall_ 开头的&lt;strong&gt;系统调用函数&lt;/strong&gt;是原子操作，其他所有包括 fork 这些函数都是可能会被打断的。一次系统调用只能 unmap 一页，所以我们是不能保持两次 unmap为一个原子操作的。那是不是一定要两次 unmap 是原子操作才能使得_pipeisclosed一定返回正确结果呢？&lt;/p&gt;
&lt;p&gt;&lt;span style="color: #0000ff;"&gt;Thinking 6.3 阅读上述材料并思考：为什么系统调用一定是原子操作呢？如果你觉得不是所有的系统调用都是原子操作，请给出反例。希望能结合相关代码进行分析。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;答案当然是否定的，_pipeisclosed函数返回正确结果的条件其实只是：&lt;/p&gt;
&lt;p&gt;&amp;bull; 写端关闭当且仅当 pageref(p[0]) == pageref(pipe);&lt;/p&gt;
&lt;p&gt;&amp;bull; 读端关闭当且仅当 pageref(p[1]) == pageref(pipe);&lt;/p&gt;
&lt;p&gt;比如说第一个条件，写端关闭时，当然有 pageref(p[0]) == pageref(pipe)。所以我们要解决的实际上是 &lt;strong&gt;当 pageref(p[0]) == pageref(pipe) 时&lt;/strong&gt;，写端关闭。正面如果不好解决问题，我们可以考虑从其逆否命题着手，即要满足：当写端没有关闭的时候，pageref(p[0]) ̸= pageref(pipe)。&lt;/p&gt;
&lt;p&gt;我们考虑之前那个预想之外的情景，它出现的最关键原因在于：pipe 的引用次数总比 fd 要高。当管道的 close 进行到一半时，&lt;strong&gt;若先解除 pipe 的映射，再解除 fd 的映射&lt;/strong&gt;，就会使得 pipe 的引用次数的-1 先于 fd。这就导致在两个 unmap 的间隙，会出现pageref(pipe) == pageref(fd) 的情况。那么若调换 fd 和 pipe 在 close 中的 unmap 顺序，能否解决这个问题呢？&lt;/p&gt;
&lt;p&gt;&lt;span style="color: #0000ff;"&gt;Thinking 6.4 仔细阅读上面这段话，并思考下列问题&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span style="color: #0000ff;"&gt;&amp;bull; 按照上述说法控制 pipeclose 中 fd 和 pipe unmap 的顺序，是否可以解决上述场景的进程竞争问题？给出你的分析过程。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span style="color: #0000ff;"&gt;&amp;bull; 我们只分析了 close 时的情形，那么对于 dup 中出现的情况又该如何解决？请模仿上述材料写写你的理解。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;根据上面的描述我们其实已经能够得出一个结论：控制 fd 与 pipe 的 map/unmap的顺序可以解决上述情景中出现的进程竞争问题。&lt;/p&gt;
&lt;p&gt;那么下面根据你所思考的内容进行实践吧：&lt;/p&gt;
&lt;p&gt;&lt;span style="color: #0000ff;"&gt;Exercise 6.3 修改 user/pipe.c 中的 pipeclose 与 user/fd.c 中的 dup 函数以避免上述情景中的进程竞争情况。&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;

  &lt;/div&gt;
  &lt;div class="vert vert-1" data-id="block-v1:Internal+B3I062140+2019_T2+type@discussion+block@61386e1f7dd04de7a733689e1ae410f4"&gt;
    &lt;div class="xblock xblock-student_view xblock-student_view-discussion" data-runtime-class="LmsRuntime" data-init="DiscussionInlineBlock" data-course-id="course-v1:Internal+B3I062140+2019_T2" data-request-token="03ca6f9e547511ea990d5254001c17d8" data-runtime-version="1" data-usage-id="block-v1:Internal+B3I062140+2019_T2+type@discussion+block@61386e1f7dd04de7a733689e1ae410f4" data-block-type="discussion"&gt;
  





&lt;script type="text/javascript"&gt;
  window.PLATFORM_NAME = "CSCore";
    window.ENABLE_DISCUSSION_HOME_PANEL = true;
&lt;/script&gt;



&lt;script aria-hidden="true" type="text/template" id="thread-template"&gt;
    &lt;article class="discussion-article" data-id="&lt;%- id %&gt;" tabindex="-1"&gt;
    &lt;div class="thread-wrapper"&gt;
        &lt;div class="thread-main-wrapper"&gt;
            &lt;div class="thread-content-wrapper"&gt;&lt;/div&gt;
            &lt;div class="post-extended-content"&gt;
                &lt;ol class="responses js-marked-answer-list"&gt;&lt;/ol&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="post-extended-content thread-responses-wrapper"&gt;
            &lt;div class="response-btn-count-wrapper"&gt;
                &lt;% if (!readOnly) { %&gt;
                &lt;div class="add-response"&gt;
                    &lt;button class="btn btn-small add-response-btn"&gt;
                        &lt;%- gettext("Add a Response") %&gt;
                    &lt;/button&gt;
                &lt;/div&gt;
                &lt;% } %&gt;
                &lt;div class="response-count"&gt;&lt;/div&gt;
            &lt;/div&gt;
            &lt;ol class="responses js-response-list"&gt;&lt;/ol&gt;
            &lt;div class="response-pagination"&gt;&lt;/div&gt;
            &lt;div class="post-status-closed bottom-post-status" style="display: none"&gt;
              &lt;%- gettext("This thread is closed.") %&gt;
            &lt;/div&gt;
            &lt;% if (can_create_comment &amp;&amp; !readOnly) { %&gt;
            &lt;form class="discussion-reply-new" data-id="&lt;%- id %&gt;"&gt;
                &lt;h4&gt;&lt;%- gettext("Add a response:") %&gt;&lt;/h4&gt;
                &lt;ul class="discussion-errors"&gt;&lt;/ul&gt;
                &lt;div class="reply-body" data-id="&lt;%- id %&gt;"&gt;&lt;/div&gt;
                &lt;div class="reply-post-control"&gt;
                    &lt;button class="btn discussion-submit-post control-button"&gt;&lt;%- gettext("Submit") %&gt;&lt;/button&gt;
                &lt;/div&gt;
            &lt;/form&gt;
            &lt;% } %&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/article&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-show-template"&gt;
    &lt;div class="discussion-post"&gt;
    &lt;header class="post-header"&gt;
        &lt;% if (!readOnly) { %&gt;
            &lt;div class="post-header-actions"&gt;
                &lt;%=
                _.template(
                    $('#forum-actions').html())(
                    {
                        contentId: cid,
                        contentType: 'post',
                        primaryActions: ['vote', 'follow'],
                        secondaryActions: ['pin', 'edit', 'delete', 'report', 'close'],
                        readOnly: readOnly
                    }
                )
                %&gt;
            &lt;/div&gt;
        &lt;% } %&gt;
        &lt;div class="post-header-content"&gt;
            &lt;h4 class="post-title"&gt;&lt;%- title %&gt;&lt;/h4&gt;
            &lt;p class="posted-details"&gt;
            &lt;%
            var timeAgoHtml = interpolate(
                '&lt;span class="timeago" title="%(created_at)s"&gt;%(created_at)s&lt;/span&gt;',
                {created_at: created_at},
                true
            );
            %&gt;
            &lt;%=
            interpolate(
                // Translators: post_type describes the kind of post this is (e.g. "question" or "discussion");
                // time_ago is how much time has passed since the post was created (e.g. "4 hours ago")
                _.escape(gettext('%(post_type)s posted %(time_ago)s by %(author)s')),
                {post_type: thread_type, time_ago: timeAgoHtml, author: author_display},
                true
            )
            %&gt;
            &lt;/p&gt;
            &lt;div class="post-labels"&gt;
                &lt;span class="post-label post-label-pinned"&gt;
                    &lt;span class="icon fa fa-thumb-tack" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Pinned") %&gt;
                &lt;/span&gt;
                &lt;span class="post-label post-label-reported"&gt;
                    &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Reported") %&gt;
                &lt;/span&gt;
                &lt;span class="post-label post-label-closed"&gt;
                    &lt;span class="icon fa fa-lock" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Closed") %&gt;
                &lt;/span&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/header&gt;

    &lt;div class="post-body"&gt;&lt;%- body %&gt;&lt;/div&gt;
    &lt;div class="post-context"&gt;
        &lt;% if (mode === "tab" &amp;&amp; obj.courseware_url) { %&gt;
            &lt;%
            var courseware_title_linked = interpolate(
                '&lt;a href="%(courseware_url)s"&gt;%(courseware_title)s&lt;/a&gt;',
                {courseware_url: courseware_url, courseware_title: _.escape(courseware_title)},
                true
            );
            %&gt;
            &lt;%=
            interpolate(
                _.escape(gettext('Related to: %(courseware_title_linked)s')),
                {courseware_title_linked: courseware_title_linked},
                true
            )
            %&gt;
        &lt;% } %&gt;
        &lt;div class="group-visibility-label"&gt;
            &lt;% if (obj.group_name) { %&gt;
                &lt;%-
                interpolate(
                    gettext('This post is visible only to %(group_name)s.'),
                    {group_name: obj.group_name},
                    true
                )
                %&gt;
            &lt;% } else { %&gt;
                &lt;%- gettext('This post is visible to everyone.') %&gt;
            &lt;% } %&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-edit-template"&gt;
    &lt;h4&gt;&lt;%- gettext("Editing post") %&gt;&lt;/h4&gt;
&lt;ul class="post-errors"&gt;&lt;/ul&gt;
&lt;div class="forum-edit-post-form-wrapper"&gt;&lt;/div&gt;
&lt;div class="post-field"&gt;
    &lt;label class="field-label"&gt;
        &lt;span class="field-label-text"&gt;&lt;%- gettext("Title") %&gt;&lt;/span&gt;
        &lt;div class="field-help" id="field_help_title"&gt;
            &lt;%- gettext("Add a clear and descriptive title to encourage participation.") %&gt;
        &lt;/div&gt;
        &lt;input aria-describedby="field_help_title" type="text" class="edit-post-title field-input" name="title" value="&lt;%- title %&gt;"&gt;
    &lt;/label&gt;
&lt;/div&gt;
&lt;div class="form-row post-field"&gt;
    &lt;p class="sr-only field-help" id="edit-post-editor-description"&gt;&lt;%- gettext('Edit your post below.') %&gt;&lt;/p&gt;
    &lt;div class="edit-post-body" aria-describedby="edit-post-editor-description" name="body"&gt;&lt;%- body %&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;button type="submit" id="edit-post-submit" class="btn-brand submit post-update"&gt;&lt;%- gettext("Update post") %&gt;&lt;/button&gt;
&lt;button class="btn post-cancel"&gt;&lt;%- gettext("Cancel") %&gt;&lt;/button&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-response-template"&gt;
    &lt;div class="discussion-response"&gt;&lt;/div&gt;
&lt;button class="btn-link action-show-comments"&gt;
    &lt;%
    var fmts = ngettext("Show Comment (%(num_comments)s)", "Show Comments (%(num_comments)s)", comments.length);
    print(interpolate(fmts, {num_comments: comments.length}, true));
    %&gt;
    &lt;span class="icon fa fa-caret-down" aria-hidden="true"&gt;&lt;/span&gt;
&lt;/button&gt;
&lt;ol class="comments"&gt;
    &lt;li class="new-comment"&gt;
        &lt;% if (create_sub_comment &amp;&amp; !readOnly) { %&gt;
            &lt;form class="comment-form" data-id="&lt;%- wmdId %&gt;"&gt;
                &lt;ul class="discussion-errors"&gt;&lt;/ul&gt;
                &lt;label class="sr" for="add-new-comment-&lt;%- wmdId %&gt;"&gt;&lt;%- gettext("Add a comment") %&gt;&lt;/label&gt;
                &lt;div class="comment-body" id="add-new-comment-&lt;%- wmdId %&gt;" data-id="&lt;%- wmdId %&gt;"
                data-placeholder="&lt;%- gettext('Add a comment') %&gt;"&gt;&lt;/div&gt;
                &lt;div class="comment-post-control"&gt;
                    &lt;button class="btn-brand discussion-submit-comment control-button"&gt;&lt;%- gettext("Submit") %&gt;&lt;/button&gt;
                &lt;/div&gt;
            &lt;/form&gt;
        &lt;% } %&gt;
    &lt;/li&gt;
&lt;/ol&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-response-show-template"&gt;
    &lt;header class="response-header"&gt;
  &lt;div class="response-header-content"&gt;
    &lt;%= author_display %&gt;
    &lt;p class="posted-details"&gt;
        &lt;span class="timeago" title="&lt;%= created_at %&gt;"&gt;&lt;%= created_at %&gt;&lt;/span&gt;
        &lt;% if (obj.endorsement &amp;&amp; obj.endorsed) { %&gt;
            -
            &lt;%
            var fmt = null;
            if (thread.get("thread_type") == "question") {
              if (endorsement.username) {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("marked as answer %(time_ago)s by %(user)s");
              } else {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("marked as answer %(time_ago)s");
              }
            } else {
              if (endorsement.username) {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("endorsed %(time_ago)s by %(user)s");
              } else {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("endorsed %(time_ago)s");
              }
            }
            var time_ago = interpolate(
              '&lt;span class="timeago" title="%(time)s"&gt;%(time)s&lt;/span&gt;',
              {time: endorsement.time},
              true
            );
            %&gt;
            &lt;%= interpolate(fmt, {time_ago: time_ago, user: endorser_display}, true) %&gt;
        &lt;% } %&gt;
      &lt;/p&gt;
      &lt;div class="post-labels"&gt;
          &lt;span class="post-label post-label-reported"&gt;
              &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Reported") %&gt;
          &lt;/span&gt;
      &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="response-header-actions"&gt;
        &lt;%=
            _.template(
                $('#forum-actions').html())(
                {
                    contentId: cid,
                    contentType: 'response',
                    primaryActions: ['vote', thread.get('thread_type') == 'question' ? 'answer' : 'endorse'],
                    secondaryActions: ['edit', 'delete', 'report'],
                    readOnly: readOnly
                }
            )
        %&gt;
      &lt;/div&gt;
&lt;/header&gt;

&lt;div class="response-body"&gt;&lt;%- body %&gt;&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-response-edit-template"&gt;
    &lt;div class="edit-post-form"&gt;
    &lt;h1&gt;&lt;%- gettext("Editing response") %&gt;&lt;/h1&gt;
    &lt;ul class="edit-post-form-errors"&gt;&lt;/ul&gt;
    &lt;div class="form-row"&gt;
        &lt;div class="edit-post-body" name="body" data-id="&lt;%- id %&gt;"&gt;&lt;%- body %&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;button type="submit" id="edit-response-submit"class="btn-brand post-update"&gt;&lt;%- gettext("Update response") %&gt;&lt;/button&gt;
    &lt;button class="btn post-cancel"&gt;&lt;%- gettext("Cancel") %&gt;&lt;/button&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="response-comment-show-template"&gt;
    &lt;div class="discussion-comment" id="comment_&lt;%- id %&gt;"&gt;
  &lt;div class="response-body"&gt;&lt;%- body %&gt;&lt;/div&gt;
  &lt;%=
      _.template(
          $('#forum-actions').html())(
          {
              contentId: cid,
              contentType: 'comment',
              primaryActions: [],
              secondaryActions: ['edit', 'delete', 'report'],
              readOnly: readOnly
          }
      )
  %&gt;
  &lt;p class="posted-details"&gt;
    &lt;%
    var time_ago = interpolate(
      '&lt;span class="timeago" title="%(time)s"&gt;%(time)s&lt;/span&gt;',
      {time: created_at},
      true
    );
    %&gt;
    &lt;%= interpolate(
      // Translators: 'timeago' is a placeholder for a fuzzy, relative timestamp (see: https://github.com/rmm5t/jquery-timeago)
      gettext("posted %(time_ago)s by %(author)s"),
      {time_ago: time_ago, author: author_display},
      true
    ) %&gt;
  &lt;/p&gt;
  &lt;div class="post-labels"&gt;
    &lt;span class="post-label post-label-reported"&gt;
      &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Reported") %&gt;
    &lt;/span&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="response-comment-edit-template"&gt;
    &lt;div class="edit-post-form" id="comment_&lt;%- id %&gt;"&gt;
    &lt;h1&gt;&lt;%- gettext("Editing comment") %&gt;&lt;/h1&gt;
    &lt;ul class="edit-comment-form-errors"&gt;&lt;/ul&gt;
    &lt;div class="form-row"&gt;
        &lt;div class="edit-comment-body" name="body" data-id="&lt;%- id %&gt;"&gt;&lt;%- body %&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;button type="submit" id="edit-comment-submit" class="btn-brand post-update"&gt;&lt;%- gettext("Update comment") %&gt;&lt;/button&gt;
    &lt;button class="btn post-cancel"&gt;&lt;%- gettext("Cancel") %&gt;&lt;/button&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-list-item-template"&gt;
    &lt;li data-id="&lt;%- id %&gt;" class="forum-nav-thread&lt;% if (neverRead) { %&gt; never-read&lt;% } %&gt;"&gt;
  &lt;a href="&lt;%- threadUrl %&gt;" class="forum-nav-thread-link"&gt;
    &lt;div class="forum-nav-thread-wrapper-0"&gt;
      &lt;%
      var icon_class, sr_text;
      if (thread_type === "discussion") {
          icon_class = "fa-comments";
          // Translators: This is a label for a Discussion forum thread
          sr_text = gettext("discussion");
      } else if (endorsed) {
          icon_class = "fa-check-square-o";
          // Translators: This is a label for a Question forum thread with a marked answer
          sr_text = gettext("answered question");
      } else {
          icon_class = "fa-question";
          // Translators: This is a label for a Question forum thread without a marked answer
          sr_text = gettext("unanswered question");
      }
      %&gt;
      &lt;span class="sr"&gt;&lt;%= sr_text %&gt;&lt;/span&gt;
      &lt;span class="icon fa &lt;%= icon_class %&gt;" aria-hidden="true"&gt;&lt;/span&gt;
    &lt;/div&gt;&lt;div class="forum-nav-thread-wrapper-1"&gt;
      &lt;span class="forum-nav-thread-title"&gt;&lt;%- title %&gt;&lt;/span&gt;
      &lt;% if (showThreadPreview){ %&gt;
        &lt;div class="thread-preview-body"&gt;&lt;%- threadPreview %&gt;&lt;/div&gt;
      &lt;% } %&gt;
      &lt;% if(typeof(subscribed) === "undefined") { var subscribed = null; } %&gt;
      &lt;% if(pinned || subscribed || staff_authored || community_ta_authored) { %&gt;
        &lt;ul class="forum-nav-thread-labels"&gt;
        &lt;% if (pinned) { %&gt;
          &lt;li class="post-label post-label-pinned"&gt;
            &lt;span class="icon fa fa-thumb-tack" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that has been pinned %&gt;
            &lt;%- gettext("Pinned") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (subscribed) { %&gt;
          &lt;li class="post-label post-label-following"&gt;
            &lt;span class="icon fa fa-star" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that the user is subscribed to %&gt;
            &lt;%- gettext("Following") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (staff_authored) { %&gt;
          &lt;li class="post-label post-label-by-staff"&gt;
            &lt;span class="icon fa fa-user" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that was authored by a member of the course staff %&gt;
            &lt;%- gettext("Staff") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (community_ta_authored) { %&gt;
          &lt;li class="post-label post-label-by-community-ta"&gt;
            &lt;span class="icon fa fa-user" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that was authored by a community TA %&gt;
            &lt;%- gettext("Community TA") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;/ul&gt;
      &lt;% } %&gt;
    &lt;/div&gt;&lt;div class="forum-nav-thread-wrapper-2"&gt;
      &lt;%
      // Translators: 'votes_count' is a numerical placeholder for a specific discussion thread; 'span_start' and 'span_end' placeholders refer to HTML markup.  Please translate the word 'votes'.
      var fmt = ngettext(
           "%(votes_count)s%(span_start)s vote %(span_end)s",
           "%(votes_count)s%(span_start)s votes %(span_end)s",
           votes['up_count']
      );
      %&gt;
      &lt;span class="forum-nav-thread-votes-count"&gt;
      +&lt;%= interpolate(fmt, {
               votes_count: votes['up_count'],
               span_start: '&lt;span class="sr"&gt;',
               span_end: '&lt;/span&gt;'
            }, true)
      %&gt;
      &lt;/span&gt;

      &lt;% if (!neverRead &amp;&amp; unread_comments_count &gt; 0) { %&gt;
        &lt;span class="forum-nav-thread-unread-comments-count"&gt;
          &lt;%-
            StringUtils.interpolate(
              gettext('{unread_comments_count} new'),
              {unread_comments_count: unread_comments_count}
            )
          %&gt;
        &lt;/span&gt;
      &lt;% } %&gt;

      &lt;span class="forum-nav-thread-comments-count"&gt;
      &lt;%
      var fmt;
      // Counts in data do not include the post itself, but the UI should
      var data = {
          'span_sr_open': '&lt;span class="sr"&gt;',
          'span_close': '&lt;/span&gt;',
          'unread_comments_count': unread_comments_count + (read ? 0 : 1),
          'comments_count': comments_count + 1
      };
      if (unread_comments_count &gt; 0) {
          // Translators: 'comments_count' and 'unread_comments_count' are numerical placeholders for a specific discussion thread; 'span_*' placeholders refer to HTML markup.  Please translate the word 'comments'.
          fmt = gettext('%(comments_count)s %(span_sr_open)scomments (%(unread_comments_count)s unread comments)%(span_close)s');
      } else {
          // Translators: 'comments_count' is a numerical placeholder for a specific discussion thread; 'span_*' placeholders refer to HTML markup.  Please translate the word 'comments'.
          fmt = gettext('%(comments_count)s %(span_sr_open)scomments %(span_close)s');
      }
      print(interpolate(fmt, data, true));
      %&gt;
      &lt;/span&gt;
    &lt;/div&gt;
  &lt;/a&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="search-alert-template"&gt;
    &lt;div class="search-alert &lt;%- css_class %&gt;" id="search-alert-&lt;%- cid %&gt;"&gt;
    &lt;div class="search-alert-content"&gt;
        &lt;p class="message"&gt;&lt;%= HtmlUtils.ensureHtml(messageHtml) %&gt;&lt;/p&gt;
    &lt;/div&gt;

    &lt;div class="search-alert-controls"&gt;
        &lt;button class="btn-link dismiss control control-dismiss" title="&lt;%- gettext('Close') %&gt;"&gt;
            &lt;span class="icon fa fa-remove" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/button&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-template"&gt;
    &lt;form class="forum-new-post-form"&gt;
    &lt;h3 class="thread-title"&gt;&lt;%- gettext("Add a Post") %&gt;&lt;/h3&gt;
    &lt;% if (mode === 'inline') { %&gt;
        &lt;button class="btn-default add-post-cancel"&gt;
            &lt;span class="sr"&gt;&lt;%- gettext('Cancel') %&gt;&lt;/span&gt;
            &lt;span class="fa fa-close" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/button&gt;
    &lt;% } %&gt;
    &lt;ul class="post-errors" style="display: none"&gt;&lt;/ul&gt;
    &lt;div class="forum-new-post-form-wrapper"&gt;&lt;/div&gt;
    &lt;% if (cohort_options) { %&gt;
    &lt;div class="post-field group-selector-wrapper &lt;% if (!is_commentable_cohorted) { print('disabled'); } %&gt;"&gt;
        &lt;label class="field-label"&gt;
            &lt;span class="field-label-text"&gt;
                &lt;% //Translators: This labels the selector for which group of students can view a post %&gt;
                &lt;%- gettext("Visible to") %&gt;
            &lt;/span&gt;
            &lt;div class="field-help" id="field_help_visible_to"&gt;
                &lt;%- gettext("Discussion admins, moderators, and TAs can make their posts visible to all students or specify a single cohort.") %&gt;
            &lt;/div&gt;
            &lt;div class="field-input"&gt;
                &lt;select aria-describedby="field_help_visible_to" class="post-topic field-input js-group-select" name="group_id" &lt;% if (!is_commentable_cohorted) { print("disabled"); } %&gt;&gt;
                    &lt;option value=""&gt;&lt;%- gettext("All Groups") %&gt;&lt;/option&gt;
                    &lt;% _.each(cohort_options, function(opt) { %&gt;
                    &lt;option value="&lt;%- opt.value %&gt;" &lt;% if (opt.selected) { print("selected"); } %&gt;&gt;&lt;%- opt.text %&gt;&lt;/option&gt;
                    &lt;% }); %&gt;
                &lt;/select&gt;
            &lt;/div&gt;
        &lt;/label&gt;
    &lt;/div&gt;
    &lt;% } %&gt;
    &lt;div class="post-field"&gt;
        &lt;label class="field-label"&gt;
            &lt;span class="field-label-text"&gt;&lt;%- gettext("Title") %&gt;&lt;/span&gt;
            &lt;div class="field-help" id="field_help_title"&gt;
                &lt;%- gettext("Add a clear and descriptive title to encourage participation.") %&gt;
            &lt;/div&gt;
            &lt;div&gt;
                &lt;input aria-describedby="field_help_title" type="text" class="js-post-title field-input" name="title"&gt;
            &lt;/div&gt;
        &lt;/label&gt;
    &lt;/div&gt;

    &lt;div&gt;
        &lt;span class="field-label-text field-label-text-full" id="new-post-editor-description"&gt;&lt;%- gettext('Your question or idea') %&gt;&lt;/span&gt;
        &lt;div class="js-post-body editor" aria-describedby="new-post-editor-description" name="body"&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="post-options"&gt;
        &lt;label class="post-option is-enabled"&gt;
            &lt;input type="checkbox" name="follow" class="post-option-input js-follow" checked&gt;
            &lt;span class="icon fa fa-star" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("follow this post") %&gt;
        &lt;/label&gt;
        &lt;% if (allow_anonymous) { %&gt;
        &lt;label class="post-option"&gt;
            &lt;input type="checkbox" name="anonymous" class="post-option-input js-anon"&gt;
            &lt;%- gettext("post anonymously") %&gt;
        &lt;/label&gt;
        &lt;% } %&gt;
        &lt;% if (allow_anonymous_to_peers) { %&gt;
        &lt;label class="post-option"&gt;
            &lt;input type="checkbox" name="anonymous_to_peers" class="post-option-input js-anon-peers"&gt;
            &lt;%- gettext("post anonymously to classmates") %&gt;
        &lt;/div&gt;
        &lt;% } %&gt;
    &lt;/div&gt;
    &lt;div&gt;
        &lt;button type="submit" class="btn-brand submit"&gt;&lt;%- gettext('Submit') %&gt;&lt;/button&gt;
        &lt;button type="button" class="btn cancel"&gt;&lt;%- gettext('Cancel') %&gt;&lt;/button&gt;
    &lt;/div&gt;
&lt;/form&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-menu-entry-template"&gt;
    &lt;option class="topic-title" data-discussion-id="&lt;%- id %&gt;" data-cohorted="&lt;%- is_cohorted %&gt;"&gt;&lt;%- text %&gt;&lt;/option&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-menu-category-template"&gt;
    &lt;optgroup label="&lt;%- text %&gt;"&gt;
    &lt;%= edx.HtmlUtils.ensureHtml(entries) %&gt;
&lt;/optgroup&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-alert-template"&gt;
    &lt;div class="alert alert-error pattern-library-shim" role="alert" aria-labelledby="alert-title-error-&lt;%- alertId %&gt;" tabindex="-1"&gt;
    &lt;span class="icon alert-icon fa fa-warning" aria-hidden="true"&gt;&lt;/span&gt;

    &lt;div class="alert-message"&gt;
        &lt;h3 class="sr-only alert-title" id="alert-title-error-&lt;%- alertId %&gt;"&gt;
            &lt;%- gettext("Error posting your message.") %&gt;
        &lt;/h3&gt;

        &lt;p class="alert-copy"&gt;
            &lt;%- gettext(message) %&gt;
        &lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="topic-template"&gt;
    &lt;div class="post-field"&gt;
    &lt;label class="field-label"&gt;
        &lt;span class="field-label-text"&gt;
            &lt;%- gettext("Topic area") %&gt;
        &lt;/span&gt;
        &lt;div class="field-help" id="field_help_topic_area"&gt;
            &lt;%- gettext("Add your post to a relevant topic to help others find it.") %&gt;
        &lt;/div&gt;
        &lt;div class="field-input"&gt;
            &lt;select class="post-topic field-input" aria-describedby="field_help_topic_area" required&gt;
                &lt;%= edx.HtmlUtils.ensureHtml(topics_html) %&gt;
            &lt;/select&gt;
        &lt;/div&gt;
    &lt;/label&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="post-user-display-template"&gt;
    &lt;% if (username) { %&gt;
&lt;a href="&lt;%- user_url %&gt;" class="username"&gt;&lt;%- username %&gt;&lt;/a&gt;
    &lt;% if (is_community_ta) { %&gt;
    &lt;span class="user-label-community-ta"&gt;&lt;%- gettext("Community TA") %&gt;&lt;/span&gt;
    &lt;% } else if (is_staff) { %&gt;
    &lt;span class="user-label-staff"&gt;&lt;%- gettext("Staff") %&gt;&lt;/span&gt;
    &lt;% } %&gt;
&lt;% } else { %&gt;
    &lt;%- gettext('anonymous') %&gt;
&lt;% } %&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="inline-discussion-template"&gt;
    &lt;section class="discussion inline-discussion" data-discussion-id="&lt;%- discussionId %&gt;"&gt;
    &lt;div class="add_post_btn_container &lt;%if (read_only) {%&gt;is-hidden&lt;%} %&gt;"&gt;
        &lt;button class="btn-link new-post-btn"&gt;&lt;%- gettext("Add a Post") %&gt;&lt;/button&gt;
    &lt;/div&gt;

    &lt;article class="new-post-article is-hidden"&gt;&lt;/article&gt;

    &lt;div class="inline-discussion-thread-container"&gt;
        &lt;section class="inline-threads"&gt;
        &lt;/section&gt;

        &lt;div class="inline-thread"&gt;
            &lt;div class="forum-nav-bar"&gt;
                &lt;button class="btn-link all-posts-btn"&gt;
                    &lt;span class="icon fa fa-chevron-prev" aria-hidden="true"&gt;&lt;/span&gt;
                    &lt;span aria-hidden="true"&gt;&lt;%- gettext('All Posts') %&gt;&lt;/span&gt;
                    &lt;span class="sr-only"&gt;&lt;%- gettext('Return to all posts') %&gt;&lt;/span&gt;
                &lt;/button&gt;
            &lt;/div&gt;
            &lt;div class="forum-content"&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/section&gt;


&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="pagination-template"&gt;
    &lt;nav class="discussion-paginator"&gt;
    &lt;ol&gt;
        &lt;% if (previous) { %&gt;
            &lt;li class="previous-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= previous.url %&gt;" data-page-number="&lt;%= previous.number %&gt;"&gt;&amp;lt; &lt;%- gettext("Previous") %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (first) { %&gt;
            &lt;li class="first-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= first.url %&gt;" data-page-number="1"&gt;1&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (leftdots) { %&gt;
            &lt;li class="previous-ellipses"&gt;&lt;%- gettext("…") %&gt;&lt;/li&gt;
        &lt;% } %&gt;

        &lt;% _.each(lowPages, function(page) { %&gt;
            &lt;li class="lower-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= page.url %&gt;" data-page-number="&lt;%= page.number %&gt;"&gt;&lt;%= page.number %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% }); %&gt;
        &lt;li class="current-page"&gt;&lt;span&gt;&lt;%= page %&gt;&lt;/span&gt;&lt;/li&gt;
        &lt;% _.each(highPages, function(page) { %&gt;
            &lt;li class="higher-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= page.url %&gt;" data-page-number="&lt;%= page.number %&gt;"&gt;&lt;%= page.number %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% }); %&gt;

        &lt;% if (rightdots) { %&gt;
            &lt;li class="next-ellipses"&gt;&lt;%- gettext("…") %&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (last) { %&gt;
            &lt;li class="last-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= last.url %&gt;" data-page-number="&lt;%= last.number %&gt;"&gt;&lt;%= last.number %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (next) { %&gt;
            &lt;li class="next-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= next.url %&gt;" data-page-number="&lt;%= next.number %&gt;"&gt;&lt;%- gettext("Next") %&gt; &amp;gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
    &lt;/ol&gt;
&lt;/nav&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="profile-thread-template"&gt;
    &lt;article class="discussion-article" data-id="&lt;%- id %&gt;"&gt;
    &lt;div class="discussion-post"&gt;
        &lt;header&gt;
            &lt;h3&gt;&lt;%- title %&gt;&lt;/h3&gt;
            &lt;p class="posted-details"&gt;
                &lt;% if (user) { %&gt;
                    &lt;a href="&lt;%- user.url %&gt;" class="username"&gt;&lt;%- user.username %&gt;&lt;/a&gt;
                &lt;% } else { %&gt;
                    &lt;%- gettext("anonymous") %&gt;
                &lt;% } %&gt;

                &lt;span class="timeago" title="&lt;%- created_at %&gt;"&gt;&lt;%- created_at %&gt;&lt;/span&gt;
                &lt;span class="post-status-closed top-post-status" style="display: none"&gt;
                    &amp;bull; &lt;%- gettext("This thread is closed.") %&gt;
                &lt;/span&gt;
            &lt;/p&gt;
        &lt;/header&gt;
        &lt;div class="post-body"&gt;&lt;%= abbreviatedBody %&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="post-tools"&gt;
        &lt;a href="&lt;%- permalink %&gt;"&gt;&lt;%- gettext("View discussion") %&gt;&lt;/a&gt;
    &lt;/div&gt;

&lt;/article&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="customwmd-prompt-template"&gt;
    &lt;h4 id="editor-dialog-title"&gt;&lt;%- title %&gt;&lt;/h4&gt;
&lt;div role="status" id="wmd-editor-dialog-form-errors" class="sr" tabindex="-1"&gt;&lt;/div&gt;
&lt;div&gt;
    &lt;form class="form"&gt;
        &lt;fieldset class="field-group"&gt;
            &lt;legend class="form-group-hd sr"&gt;&lt;%- title %&gt;&lt;/legend&gt;
            &lt;div class="field &lt;%- uploadFieldClass %&gt;"&gt;
                &lt;label id="new-url-input-label" for="new-url-input" class="field-label"&gt;
                    &lt;%- urlLabel %&gt;&lt;/label&gt;
                &lt;input type="text" id="new-url-input" class="field-input input-text" aria-describedby="new-url-input-help"&gt;
                &lt;% if (imageUploadHandler) { %&gt;
                    &lt;button id="file-upload-proxy" class="btn btn-primary btn-base form-btn"&gt;
                        &lt;%- chooseFileText %&gt;
                    &lt;/button&gt;
                    &lt;input type="file" name="file-upload" id="file-upload" style="display:none;"/&gt;
                &lt;% } %&gt;
                &lt;div id="new-url-input-field-message" class="field-message has-error" style="display:none"&gt;
                    &lt;span class="field-message-content"&gt;&lt;%- urlError %&gt;&lt;/span&gt;
                &lt;/div&gt;
                &lt;div id="new-url-input-help" class="field-hint"&gt;
                    &lt;%- urlHelp %&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="field"&gt;
                &lt;label for="new-url-desc-input" class="field-label"&gt;&lt;%- urlDescLabel %&gt;&lt;/label&gt;
                &lt;input type="text" id="new-url-desc-input" class="field-input input-text" required aria-describedby="new-url-desc-input-help"&gt;
                &lt;div id="new-url-desc-input-field-message" class="field-message has-error" style="display:none"&gt;
                    &lt;span class="field-message-content"&gt;&lt;%- descError %&gt;&lt;/span&gt;
                &lt;/div&gt;
                &lt;div id="new-url-desc-input-help" class="field-hint"&gt;
                    &lt;%- urlDescHelp %&gt;
                    &lt;% if (urlDescHelpLink) { %&gt;
                        &lt;a href="&lt;%- urlDescHelpLink['href'] %&gt;"&gt;
                            &lt;%- urlDescHelpLink['text'] %&gt;
                        &lt;/a&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="field"&gt;&lt;% if (imageUploadHandler) { %&gt;
                &lt;label for="img-is-decorative" class="field-label label-inline"&gt;
                    &lt;input type="checkbox" id="img-is-decorative" class="field-input input-checkbox"&gt;
                    &lt;span class="field-input-label"&gt;&lt;%- imageIsDecorativeLabel %&gt;&lt;/span&gt;
                &lt;/label&gt; &lt;% }
            %&gt;&lt;/div&gt;
        &lt;/fieldset&gt;
        &lt;div class="form-actions"&gt;
            &lt;input type="button" id="new-link-image-ok" class="btn-brand form-btn" value="&lt;%- okText %&gt;" /&gt;
            &lt;input type="button" id="new-link-image-cancel" class="btn form-btn" value="&lt;%- cancelText %&gt;" &gt;
        &lt;/div&gt;
    &lt;/form&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="nav-loading-template"&gt;
    &lt;div class="forum-nav-loading" tabindex="0"&gt;
    &lt;span class="icon fa fa-spinner fa-spin"/&gt;
    &lt;span class="sr" role="alert"&gt;&lt;%- srText %&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-type-template"&gt;
    &lt;div class="post-field"&gt;
    &lt;div class="field-label"&gt;
        &lt;span class="field-label-text"&gt;
            &lt;% // Translators: This is the label for a control to select a forum post type %&gt;
            &lt;%- gettext("Post type") %&gt;
        &lt;/span&gt;
        &lt;div class="field-help" id="field_help_post_type"&gt;
            &lt;%- gettext("Questions raise issues that need answers. Discussions share ideas and start conversations.") %&gt;
        &lt;/div&gt;
        &lt;div class="field-label"&gt;
            &lt;fieldset class="field-input"&gt;
                &lt;legend class="sr"&gt;&lt;%- gettext("Post type") %&gt;&lt;/legend&gt;
                &lt;input aria-describedby="field_help_post_type" type="radio" name="&lt;%= form_id %&gt;-post-type" class="post-type-input" id="&lt;%= form_id %&gt;-post-type-question" value="question"&gt;
                &lt;label for="&lt;%= form_id %&gt;-post-type-question" class="post-type-label"&gt;
                    &lt;span class="icon fa fa-question" aria-hidden="true"&gt;&lt;/span&gt;
                    &lt;% // Translators: This is a forum post type %&gt;
                    &lt;%- gettext("Question") %&gt;
                &lt;/label&gt;
                &lt;input aria-describedby="field_help_post_type" type="radio" name="&lt;%= form_id %&gt;-post-type" class="post-type-input" id="&lt;%= form_id %&gt;-post-type-discussion" value="discussion" checked&gt;
                &lt;label for="&lt;%= form_id %&gt;-post-type-discussion" class="post-type-label"&gt;
                    &lt;span class="icon fa fa-comments" aria-hidden="true"&gt;&lt;/span&gt;
                    &lt;% // Translators: This is a forum post type %&gt;
                    &lt;%- gettext("Discussion") %&gt;
                &lt;/label&gt;
            &lt;/fieldset&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;


&lt;script aria-hidden="true" type="text/template" id="forum-action-endorse"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-button action-endorse" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Endorse") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Endorse") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unendorse") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-check" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-answer"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-button action-answer" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Mark as Answer") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Mark as Answer") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unmark as Answer") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-check" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-follow"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-button action-follow" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Follow") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Follow") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unfollow") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-star" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-vote"&gt;
    &lt;li class="actions-item"&gt;
    &lt;span aria-hidden="true" class="display-vote is-hidden" &gt;
      &lt;span class="vote-count"&gt;&lt;/span&gt;
    &lt;/span&gt;
    &lt;button class="btn-link action-button action-vote" role="checkbox" aria-checked="false"&gt;
        &lt;% // Vote counts are populated by JS %&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Vote for this post,") %&gt;&amp;nbsp;&lt;/span&gt;
        &lt;span class="sr js-sr-vote-count"&gt;&lt;/span&gt;

        &lt;span class="action-label" aria-hidden="true"&gt;
          &lt;span class="vote-count"&gt;&lt;/span&gt;
        &lt;/span&gt;

        &lt;span class="action-icon" aria-hidden="true"&gt;
            &lt;span class="icon fa fa-plus" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-report"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-report" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Report abuse") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Report") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unreport") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;
          &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-pin"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-pin" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Pin") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Pin") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unpin") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;
          &lt;span class="icon fa fa-thumb-tack" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-close"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-close" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Close") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Close") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Open") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;
          &lt;span class="icon fa fa-lock" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-edit"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-edit"&gt;
        &lt;span class="action-label"&gt;&lt;%- gettext("Edit") %&gt;&lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-pencil" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-delete"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-delete"&gt;
        &lt;span class="action-label"&gt;&lt;%- gettext("Delete") %&gt;&lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-remove" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-actions"&gt;
    &lt;% if (!readOnly) { %&gt;
    &lt;ul class="&lt;%= contentType %&gt;-actions-list"&gt;
        &lt;% _.each(primaryActions, function(action) { print(_.template($('#forum-action-' + action).html())({})) }) %&gt;
        &lt;li class="actions-item is-visible"&gt;
            &lt;div class="more-wrapper"&gt;
                &lt;button class="btn-link action-button action-more" aria-label="&lt;%- gettext('More') %&gt;" aria-haspopup="true" aria-controls="action-menu-&lt;%= contentType %&gt;"&gt;
                    &lt;span class="action-label"&gt;&lt;%- gettext('More') %&gt;&lt;/span&gt;
                    &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-ellipsis-h" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;/button&gt;
                &lt;div class="actions-dropdown" id="action-menu-&lt;%= contentType %&gt;" aria-expanded="false"&gt;
                  &lt;ul class="actions-dropdown-list"&gt;
                    &lt;% _.each(secondaryActions, function(action) { print(_.template($('#forum-action-' + action).html())({})) }) %&gt;
                  &lt;/ul&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/li&gt;
    &lt;/ul&gt;
&lt;% } %&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="alert-popup"&gt;
    &lt;div class='modal' role='alertdialog' id='discussion-alert' aria-describedby='discussion-alert-message'&gt;
    &lt;div class='inner-wrapper discussion-alert-wrapper'&gt;
        &lt;button class='btn close-modal dismiss' title='&lt;%- gettext("Close") %&gt;''&gt;
            &lt;span class='icon fa fa-times' aria-hidden='true'&gt;&lt;/span&gt;
        &lt;/button&gt;
        &lt;header&gt;
            &lt;h2/&gt;&lt;/h2&gt;
            &lt;hr/&gt;
        &lt;/header&gt;
        &lt;p id='discussion-alert-message'&gt;&lt;/p&gt;
        &lt;hr/&gt;
        &lt;button class='btn dismiss'&gt;&lt;%- gettext("OK") %&gt;&lt;/button&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="nav-load-more-link"&gt;
    &lt;li class='forum-nav-load-more'&gt;
    &lt;button class='btn-link forum-nav-load-more-link'&gt;
        &lt;%- gettext("Load more") %&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;



&lt;script type="text/template" id="thread-list-template"&gt;
    &lt;div class="forum-nav-thread-list-wrapper" id="sort-filter-wrapper" tabindex="-1"&gt;
        &lt;div class="forum-nav-refine-bar"&gt;
            &lt;label class="forum-nav-filter-main"&gt;
                &lt;span class="sr"&gt;Filter:&lt;/span&gt;
                &lt;select class="forum-nav-filter-main-control"&gt;
                    &lt;option value="all"&gt;显示全部&lt;/option&gt;
                    &lt;option value="unread"&gt;Unread&lt;/option&gt;
                    &lt;option value="unanswered"&gt;Unanswered&lt;/option&gt;
                &lt;/select&gt;
            &lt;/label&gt;&lt;% if (isCohorted &amp;&amp; isPrivilegedUser) { %&gt;&lt;label class="forum-nav-filter-cohort"&gt;
                &lt;span class="sr"&gt;Cohort:&lt;/span&gt;
                &lt;select class="forum-nav-filter-cohort-control"&gt;
                    &lt;option value=""&gt;in all cohorts&lt;/option&gt;
                &lt;/select&gt;
            &lt;/label&gt;&lt;% } %&gt;&lt;label class="forum-nav-sort"&gt;
                &lt;span class="sr"&gt;Sort:&lt;/span&gt;
                &lt;select class="forum-nav-sort-control"&gt;
                    &lt;option value="activity"&gt;近期活动&lt;/option&gt;
                    &lt;option value="comments"&gt;活跃度&lt;/option&gt;
                    &lt;option value="votes"&gt;最多票数&lt;/option&gt;
                &lt;/select&gt;
            &lt;/label&gt;
        &lt;/div&gt;
        &lt;div class="search-alerts"&gt;&lt;/div&gt;
        &lt;ul class="forum-nav-thread-list"&gt;&lt;/ul&gt;
    &lt;/div&gt;
&lt;/script&gt;




&lt;div class="discussion-module" data-discussion-id="6ddc474f56e95b2076be3ce69068d4c030dca4af"
    data-user-create-comment="true"
    data-user-create-subcomment="true"
    data-read-only="false"&gt;
    &lt;div class="discussion-module-header"&gt;
        &lt;h3 class="discussion-module-title"&gt;讨论&lt;/h3&gt;
        &lt;div class="inline-discussion-topic"&gt;&lt;span class="inline-discussion-topic-title"&gt;Topic:&lt;/span&gt; 管道与shell：管道 / 管道的竞争&lt;/div&gt;
    &lt;/div&gt;
    &lt;button class="discussion-show btn" data-discussion-id="6ddc474f56e95b2076be3ce69068d4c030dca4af"&gt;
        &lt;span class="button-text"&gt;显示讨论&lt;/span&gt;
    &lt;/button&gt;
&lt;/div&gt;
&lt;script type="text/javascript"&gt;
var $$course_id = "course\u002Dv1:Internal+B3I062140+2019_T2";

function DiscussionInlineBlock(runtime, element) {
    'use strict';
    new DiscussionInlineView({ el: $(element).find('.discussion-module') });
}
&lt;/script&gt;

&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;

  </div>
  <div id="seq_contents_4" aria-labelledby="tab_4" aria-hidden="true" class="seq_contents tex2jax_ignore asciimath2jax_ignore">
    &lt;div class="xblock xblock-student_view xblock-student_view-vertical" data-runtime-class="LmsRuntime" data-init="VerticalStudentView" data-course-id="course-v1:Internal+B3I062140+2019_T2" data-request-token="03ca6f9e547511ea990d5254001c17d8" data-runtime-version="1" data-usage-id="block-v1:Internal+B3I062140+2019_T2+type@vertical+block@8403255768af45fdaafec6d9348f0573" data-block-type="vertical"&gt;
  

  &lt;h3 class="unit-title"&gt;管道的同步&lt;/h3&gt;

    


&lt;div class="bookmark-button-wrapper"&gt;
  &lt;button class="btn btn-link bookmark-button "
    aria-pressed="false"
    data-bookmark-id="18231047,block-v1:Internal+B3I062140+2019_T2+type@vertical+block@8403255768af45fdaafec6d9348f0573"&gt;
     &lt;span class="sr bookmark-sr"&gt;Click to add&lt;/span&gt;
     &lt;span class="bookmark-text"&gt;Bookmark this page&lt;/span&gt;
    &lt;/button&gt;
&lt;/div&gt;


&lt;div class="vert-mod"&gt;
  &lt;div class="vert vert-0" data-id="block-v1:Internal+B3I062140+2019_T2+type@html+block@b8c5b93b970645d6879915a6873f0cea"&gt;
    &lt;div class="xblock xblock-student_view xblock-student_view-html xmodule_display xmodule_HtmlModule" data-runtime-class="LmsRuntime" data-init="XBlockToXModuleShim" data-block-type="html" data-request-token="03ca6f9e547511ea990d5254001c17d8" data-runtime-version="1" data-usage-id="block-v1:Internal+B3I062140+2019_T2+type@html+block@b8c5b93b970645d6879915a6873f0cea" data-type="HTMLModule" data-course-id="course-v1:Internal+B3I062140+2019_T2"&gt;
  &lt;script type="json/xblock-args" class="xblock-json-init-args"&gt;
    {"xmodule-type": "HTMLModule"}
  &lt;/script&gt;
  &lt;p style="font-size: 16px; margin-top: 20px;"&gt;我们通过控制修改 pp_ref 的前后顺序避免了&amp;ldquo;写数据&amp;rdquo;导致的错觉，但是我们还得解决第二个问题：读取 pp_ref 的同步问题。&lt;/p&gt;
&lt;p style="font-size: 16px;"&gt;同样是上面的代码，我们思考下面的情景：&lt;/p&gt;
&lt;p style="font-size: 16px;"&gt;&amp;bull; fork 结束后，子进程先执行。执行完 close(p[1]) 后，执行 read，要从 p[0] 读取数据。但由于此时管道数据缓冲区为空，所以 read 函数要判断父进程中的写端是否关闭，进入到 _pipeisclosed 函数，pageref(fd) 值为 2(父进程和子进程都打开了p[0])，时钟中断产生。&lt;/p&gt;
&lt;p style="font-size: 16px;"&gt;&amp;bull; 内核切换到父进程执行，父进程 close(p[0])，之后向管道缓冲区写数据。要写的数据较多，写到一半时钟中断产生，内核切换到子进程运行。&lt;/p&gt;
&lt;p style="font-size: 16px;"&gt;&amp;bull; 子进程继续运行，获取到 pageref(pipe) 值为 2(父进程打开了 p[1], 子进程打开了p[0])，引用值相等，于是认为父进程的写端已经关闭，子进程退出。&lt;/p&gt;
&lt;p style="font-size: 16px;"&gt;上述现象出现的根源在哪里呢？fd 是一个父子进程共享的变量，但子进程中的 pageref(fd)没有随父进程对 fd 的修改而同步，这就造成了子进程读到的 pageref(fd) 成为了&amp;ldquo;脏数据&amp;rdquo;。为了保证读的同步性，子进程应当重新读取 pageref(fd) 和 pageref(pipe)，并且要在确认两次读取之间进程没有切换后，才能返回正确的结果。为了实现这一点，我们要使用到之前一直都没用到的变量：env_runs。&lt;/p&gt;
&lt;p style="font-size: 16px;"&gt;env_runs 记录了一个进程 env_run 的次数，这样我们就可以根据某个操作 do() 前后进程 env_runs 值是否相等，来判断在 do() 中进程是否发生了切换。&lt;/p&gt;
&lt;p style="font-size: 16px;"&gt;&lt;span style="color: #0000ff;"&gt;Exercise 6.4 根据上面的表述，修改_pipeisclosed函数，使得它满足&amp;rdquo; 同步读&amp;rdquo; 的要求。注意 env_runs 变量是需要维护的。&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;

  &lt;/div&gt;
  &lt;div class="vert vert-1" data-id="block-v1:Internal+B3I062140+2019_T2+type@discussion+block@7765b9c9e35f4308af798e4de8901ebc"&gt;
    &lt;div class="xblock xblock-student_view xblock-student_view-discussion" data-runtime-class="LmsRuntime" data-init="DiscussionInlineBlock" data-course-id="course-v1:Internal+B3I062140+2019_T2" data-request-token="03ca6f9e547511ea990d5254001c17d8" data-runtime-version="1" data-usage-id="block-v1:Internal+B3I062140+2019_T2+type@discussion+block@7765b9c9e35f4308af798e4de8901ebc" data-block-type="discussion"&gt;
  





&lt;script type="text/javascript"&gt;
  window.PLATFORM_NAME = "CSCore";
    window.ENABLE_DISCUSSION_HOME_PANEL = true;
&lt;/script&gt;



&lt;script aria-hidden="true" type="text/template" id="thread-template"&gt;
    &lt;article class="discussion-article" data-id="&lt;%- id %&gt;" tabindex="-1"&gt;
    &lt;div class="thread-wrapper"&gt;
        &lt;div class="thread-main-wrapper"&gt;
            &lt;div class="thread-content-wrapper"&gt;&lt;/div&gt;
            &lt;div class="post-extended-content"&gt;
                &lt;ol class="responses js-marked-answer-list"&gt;&lt;/ol&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="post-extended-content thread-responses-wrapper"&gt;
            &lt;div class="response-btn-count-wrapper"&gt;
                &lt;% if (!readOnly) { %&gt;
                &lt;div class="add-response"&gt;
                    &lt;button class="btn btn-small add-response-btn"&gt;
                        &lt;%- gettext("Add a Response") %&gt;
                    &lt;/button&gt;
                &lt;/div&gt;
                &lt;% } %&gt;
                &lt;div class="response-count"&gt;&lt;/div&gt;
            &lt;/div&gt;
            &lt;ol class="responses js-response-list"&gt;&lt;/ol&gt;
            &lt;div class="response-pagination"&gt;&lt;/div&gt;
            &lt;div class="post-status-closed bottom-post-status" style="display: none"&gt;
              &lt;%- gettext("This thread is closed.") %&gt;
            &lt;/div&gt;
            &lt;% if (can_create_comment &amp;&amp; !readOnly) { %&gt;
            &lt;form class="discussion-reply-new" data-id="&lt;%- id %&gt;"&gt;
                &lt;h4&gt;&lt;%- gettext("Add a response:") %&gt;&lt;/h4&gt;
                &lt;ul class="discussion-errors"&gt;&lt;/ul&gt;
                &lt;div class="reply-body" data-id="&lt;%- id %&gt;"&gt;&lt;/div&gt;
                &lt;div class="reply-post-control"&gt;
                    &lt;button class="btn discussion-submit-post control-button"&gt;&lt;%- gettext("Submit") %&gt;&lt;/button&gt;
                &lt;/div&gt;
            &lt;/form&gt;
            &lt;% } %&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/article&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-show-template"&gt;
    &lt;div class="discussion-post"&gt;
    &lt;header class="post-header"&gt;
        &lt;% if (!readOnly) { %&gt;
            &lt;div class="post-header-actions"&gt;
                &lt;%=
                _.template(
                    $('#forum-actions').html())(
                    {
                        contentId: cid,
                        contentType: 'post',
                        primaryActions: ['vote', 'follow'],
                        secondaryActions: ['pin', 'edit', 'delete', 'report', 'close'],
                        readOnly: readOnly
                    }
                )
                %&gt;
            &lt;/div&gt;
        &lt;% } %&gt;
        &lt;div class="post-header-content"&gt;
            &lt;h4 class="post-title"&gt;&lt;%- title %&gt;&lt;/h4&gt;
            &lt;p class="posted-details"&gt;
            &lt;%
            var timeAgoHtml = interpolate(
                '&lt;span class="timeago" title="%(created_at)s"&gt;%(created_at)s&lt;/span&gt;',
                {created_at: created_at},
                true
            );
            %&gt;
            &lt;%=
            interpolate(
                // Translators: post_type describes the kind of post this is (e.g. "question" or "discussion");
                // time_ago is how much time has passed since the post was created (e.g. "4 hours ago")
                _.escape(gettext('%(post_type)s posted %(time_ago)s by %(author)s')),
                {post_type: thread_type, time_ago: timeAgoHtml, author: author_display},
                true
            )
            %&gt;
            &lt;/p&gt;
            &lt;div class="post-labels"&gt;
                &lt;span class="post-label post-label-pinned"&gt;
                    &lt;span class="icon fa fa-thumb-tack" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Pinned") %&gt;
                &lt;/span&gt;
                &lt;span class="post-label post-label-reported"&gt;
                    &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Reported") %&gt;
                &lt;/span&gt;
                &lt;span class="post-label post-label-closed"&gt;
                    &lt;span class="icon fa fa-lock" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Closed") %&gt;
                &lt;/span&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/header&gt;

    &lt;div class="post-body"&gt;&lt;%- body %&gt;&lt;/div&gt;
    &lt;div class="post-context"&gt;
        &lt;% if (mode === "tab" &amp;&amp; obj.courseware_url) { %&gt;
            &lt;%
            var courseware_title_linked = interpolate(
                '&lt;a href="%(courseware_url)s"&gt;%(courseware_title)s&lt;/a&gt;',
                {courseware_url: courseware_url, courseware_title: _.escape(courseware_title)},
                true
            );
            %&gt;
            &lt;%=
            interpolate(
                _.escape(gettext('Related to: %(courseware_title_linked)s')),
                {courseware_title_linked: courseware_title_linked},
                true
            )
            %&gt;
        &lt;% } %&gt;
        &lt;div class="group-visibility-label"&gt;
            &lt;% if (obj.group_name) { %&gt;
                &lt;%-
                interpolate(
                    gettext('This post is visible only to %(group_name)s.'),
                    {group_name: obj.group_name},
                    true
                )
                %&gt;
            &lt;% } else { %&gt;
                &lt;%- gettext('This post is visible to everyone.') %&gt;
            &lt;% } %&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-edit-template"&gt;
    &lt;h4&gt;&lt;%- gettext("Editing post") %&gt;&lt;/h4&gt;
&lt;ul class="post-errors"&gt;&lt;/ul&gt;
&lt;div class="forum-edit-post-form-wrapper"&gt;&lt;/div&gt;
&lt;div class="post-field"&gt;
    &lt;label class="field-label"&gt;
        &lt;span class="field-label-text"&gt;&lt;%- gettext("Title") %&gt;&lt;/span&gt;
        &lt;div class="field-help" id="field_help_title"&gt;
            &lt;%- gettext("Add a clear and descriptive title to encourage participation.") %&gt;
        &lt;/div&gt;
        &lt;input aria-describedby="field_help_title" type="text" class="edit-post-title field-input" name="title" value="&lt;%- title %&gt;"&gt;
    &lt;/label&gt;
&lt;/div&gt;
&lt;div class="form-row post-field"&gt;
    &lt;p class="sr-only field-help" id="edit-post-editor-description"&gt;&lt;%- gettext('Edit your post below.') %&gt;&lt;/p&gt;
    &lt;div class="edit-post-body" aria-describedby="edit-post-editor-description" name="body"&gt;&lt;%- body %&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;button type="submit" id="edit-post-submit" class="btn-brand submit post-update"&gt;&lt;%- gettext("Update post") %&gt;&lt;/button&gt;
&lt;button class="btn post-cancel"&gt;&lt;%- gettext("Cancel") %&gt;&lt;/button&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-response-template"&gt;
    &lt;div class="discussion-response"&gt;&lt;/div&gt;
&lt;button class="btn-link action-show-comments"&gt;
    &lt;%
    var fmts = ngettext("Show Comment (%(num_comments)s)", "Show Comments (%(num_comments)s)", comments.length);
    print(interpolate(fmts, {num_comments: comments.length}, true));
    %&gt;
    &lt;span class="icon fa fa-caret-down" aria-hidden="true"&gt;&lt;/span&gt;
&lt;/button&gt;
&lt;ol class="comments"&gt;
    &lt;li class="new-comment"&gt;
        &lt;% if (create_sub_comment &amp;&amp; !readOnly) { %&gt;
            &lt;form class="comment-form" data-id="&lt;%- wmdId %&gt;"&gt;
                &lt;ul class="discussion-errors"&gt;&lt;/ul&gt;
                &lt;label class="sr" for="add-new-comment-&lt;%- wmdId %&gt;"&gt;&lt;%- gettext("Add a comment") %&gt;&lt;/label&gt;
                &lt;div class="comment-body" id="add-new-comment-&lt;%- wmdId %&gt;" data-id="&lt;%- wmdId %&gt;"
                data-placeholder="&lt;%- gettext('Add a comment') %&gt;"&gt;&lt;/div&gt;
                &lt;div class="comment-post-control"&gt;
                    &lt;button class="btn-brand discussion-submit-comment control-button"&gt;&lt;%- gettext("Submit") %&gt;&lt;/button&gt;
                &lt;/div&gt;
            &lt;/form&gt;
        &lt;% } %&gt;
    &lt;/li&gt;
&lt;/ol&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-response-show-template"&gt;
    &lt;header class="response-header"&gt;
  &lt;div class="response-header-content"&gt;
    &lt;%= author_display %&gt;
    &lt;p class="posted-details"&gt;
        &lt;span class="timeago" title="&lt;%= created_at %&gt;"&gt;&lt;%= created_at %&gt;&lt;/span&gt;
        &lt;% if (obj.endorsement &amp;&amp; obj.endorsed) { %&gt;
            -
            &lt;%
            var fmt = null;
            if (thread.get("thread_type") == "question") {
              if (endorsement.username) {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("marked as answer %(time_ago)s by %(user)s");
              } else {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("marked as answer %(time_ago)s");
              }
            } else {
              if (endorsement.username) {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("endorsed %(time_ago)s by %(user)s");
              } else {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("endorsed %(time_ago)s");
              }
            }
            var time_ago = interpolate(
              '&lt;span class="timeago" title="%(time)s"&gt;%(time)s&lt;/span&gt;',
              {time: endorsement.time},
              true
            );
            %&gt;
            &lt;%= interpolate(fmt, {time_ago: time_ago, user: endorser_display}, true) %&gt;
        &lt;% } %&gt;
      &lt;/p&gt;
      &lt;div class="post-labels"&gt;
          &lt;span class="post-label post-label-reported"&gt;
              &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Reported") %&gt;
          &lt;/span&gt;
      &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="response-header-actions"&gt;
        &lt;%=
            _.template(
                $('#forum-actions').html())(
                {
                    contentId: cid,
                    contentType: 'response',
                    primaryActions: ['vote', thread.get('thread_type') == 'question' ? 'answer' : 'endorse'],
                    secondaryActions: ['edit', 'delete', 'report'],
                    readOnly: readOnly
                }
            )
        %&gt;
      &lt;/div&gt;
&lt;/header&gt;

&lt;div class="response-body"&gt;&lt;%- body %&gt;&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-response-edit-template"&gt;
    &lt;div class="edit-post-form"&gt;
    &lt;h1&gt;&lt;%- gettext("Editing response") %&gt;&lt;/h1&gt;
    &lt;ul class="edit-post-form-errors"&gt;&lt;/ul&gt;
    &lt;div class="form-row"&gt;
        &lt;div class="edit-post-body" name="body" data-id="&lt;%- id %&gt;"&gt;&lt;%- body %&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;button type="submit" id="edit-response-submit"class="btn-brand post-update"&gt;&lt;%- gettext("Update response") %&gt;&lt;/button&gt;
    &lt;button class="btn post-cancel"&gt;&lt;%- gettext("Cancel") %&gt;&lt;/button&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="response-comment-show-template"&gt;
    &lt;div class="discussion-comment" id="comment_&lt;%- id %&gt;"&gt;
  &lt;div class="response-body"&gt;&lt;%- body %&gt;&lt;/div&gt;
  &lt;%=
      _.template(
          $('#forum-actions').html())(
          {
              contentId: cid,
              contentType: 'comment',
              primaryActions: [],
              secondaryActions: ['edit', 'delete', 'report'],
              readOnly: readOnly
          }
      )
  %&gt;
  &lt;p class="posted-details"&gt;
    &lt;%
    var time_ago = interpolate(
      '&lt;span class="timeago" title="%(time)s"&gt;%(time)s&lt;/span&gt;',
      {time: created_at},
      true
    );
    %&gt;
    &lt;%= interpolate(
      // Translators: 'timeago' is a placeholder for a fuzzy, relative timestamp (see: https://github.com/rmm5t/jquery-timeago)
      gettext("posted %(time_ago)s by %(author)s"),
      {time_ago: time_ago, author: author_display},
      true
    ) %&gt;
  &lt;/p&gt;
  &lt;div class="post-labels"&gt;
    &lt;span class="post-label post-label-reported"&gt;
      &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("Reported") %&gt;
    &lt;/span&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="response-comment-edit-template"&gt;
    &lt;div class="edit-post-form" id="comment_&lt;%- id %&gt;"&gt;
    &lt;h1&gt;&lt;%- gettext("Editing comment") %&gt;&lt;/h1&gt;
    &lt;ul class="edit-comment-form-errors"&gt;&lt;/ul&gt;
    &lt;div class="form-row"&gt;
        &lt;div class="edit-comment-body" name="body" data-id="&lt;%- id %&gt;"&gt;&lt;%- body %&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;button type="submit" id="edit-comment-submit" class="btn-brand post-update"&gt;&lt;%- gettext("Update comment") %&gt;&lt;/button&gt;
    &lt;button class="btn post-cancel"&gt;&lt;%- gettext("Cancel") %&gt;&lt;/button&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-list-item-template"&gt;
    &lt;li data-id="&lt;%- id %&gt;" class="forum-nav-thread&lt;% if (neverRead) { %&gt; never-read&lt;% } %&gt;"&gt;
  &lt;a href="&lt;%- threadUrl %&gt;" class="forum-nav-thread-link"&gt;
    &lt;div class="forum-nav-thread-wrapper-0"&gt;
      &lt;%
      var icon_class, sr_text;
      if (thread_type === "discussion") {
          icon_class = "fa-comments";
          // Translators: This is a label for a Discussion forum thread
          sr_text = gettext("discussion");
      } else if (endorsed) {
          icon_class = "fa-check-square-o";
          // Translators: This is a label for a Question forum thread with a marked answer
          sr_text = gettext("answered question");
      } else {
          icon_class = "fa-question";
          // Translators: This is a label for a Question forum thread without a marked answer
          sr_text = gettext("unanswered question");
      }
      %&gt;
      &lt;span class="sr"&gt;&lt;%= sr_text %&gt;&lt;/span&gt;
      &lt;span class="icon fa &lt;%= icon_class %&gt;" aria-hidden="true"&gt;&lt;/span&gt;
    &lt;/div&gt;&lt;div class="forum-nav-thread-wrapper-1"&gt;
      &lt;span class="forum-nav-thread-title"&gt;&lt;%- title %&gt;&lt;/span&gt;
      &lt;% if (showThreadPreview){ %&gt;
        &lt;div class="thread-preview-body"&gt;&lt;%- threadPreview %&gt;&lt;/div&gt;
      &lt;% } %&gt;
      &lt;% if(typeof(subscribed) === "undefined") { var subscribed = null; } %&gt;
      &lt;% if(pinned || subscribed || staff_authored || community_ta_authored) { %&gt;
        &lt;ul class="forum-nav-thread-labels"&gt;
        &lt;% if (pinned) { %&gt;
          &lt;li class="post-label post-label-pinned"&gt;
            &lt;span class="icon fa fa-thumb-tack" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that has been pinned %&gt;
            &lt;%- gettext("Pinned") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (subscribed) { %&gt;
          &lt;li class="post-label post-label-following"&gt;
            &lt;span class="icon fa fa-star" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that the user is subscribed to %&gt;
            &lt;%- gettext("Following") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (staff_authored) { %&gt;
          &lt;li class="post-label post-label-by-staff"&gt;
            &lt;span class="icon fa fa-user" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that was authored by a member of the course staff %&gt;
            &lt;%- gettext("Staff") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (community_ta_authored) { %&gt;
          &lt;li class="post-label post-label-by-community-ta"&gt;
            &lt;span class="icon fa fa-user" aria-hidden="true"&gt;&lt;/span&gt;
            &lt;% // Translators: This is a label for a forum thread that was authored by a community TA %&gt;
            &lt;%- gettext("Community TA") %&gt;
          &lt;/li&gt;
        &lt;% } %&gt;
        &lt;/ul&gt;
      &lt;% } %&gt;
    &lt;/div&gt;&lt;div class="forum-nav-thread-wrapper-2"&gt;
      &lt;%
      // Translators: 'votes_count' is a numerical placeholder for a specific discussion thread; 'span_start' and 'span_end' placeholders refer to HTML markup.  Please translate the word 'votes'.
      var fmt = ngettext(
           "%(votes_count)s%(span_start)s vote %(span_end)s",
           "%(votes_count)s%(span_start)s votes %(span_end)s",
           votes['up_count']
      );
      %&gt;
      &lt;span class="forum-nav-thread-votes-count"&gt;
      +&lt;%= interpolate(fmt, {
               votes_count: votes['up_count'],
               span_start: '&lt;span class="sr"&gt;',
               span_end: '&lt;/span&gt;'
            }, true)
      %&gt;
      &lt;/span&gt;

      &lt;% if (!neverRead &amp;&amp; unread_comments_count &gt; 0) { %&gt;
        &lt;span class="forum-nav-thread-unread-comments-count"&gt;
          &lt;%-
            StringUtils.interpolate(
              gettext('{unread_comments_count} new'),
              {unread_comments_count: unread_comments_count}
            )
          %&gt;
        &lt;/span&gt;
      &lt;% } %&gt;

      &lt;span class="forum-nav-thread-comments-count"&gt;
      &lt;%
      var fmt;
      // Counts in data do not include the post itself, but the UI should
      var data = {
          'span_sr_open': '&lt;span class="sr"&gt;',
          'span_close': '&lt;/span&gt;',
          'unread_comments_count': unread_comments_count + (read ? 0 : 1),
          'comments_count': comments_count + 1
      };
      if (unread_comments_count &gt; 0) {
          // Translators: 'comments_count' and 'unread_comments_count' are numerical placeholders for a specific discussion thread; 'span_*' placeholders refer to HTML markup.  Please translate the word 'comments'.
          fmt = gettext('%(comments_count)s %(span_sr_open)scomments (%(unread_comments_count)s unread comments)%(span_close)s');
      } else {
          // Translators: 'comments_count' is a numerical placeholder for a specific discussion thread; 'span_*' placeholders refer to HTML markup.  Please translate the word 'comments'.
          fmt = gettext('%(comments_count)s %(span_sr_open)scomments %(span_close)s');
      }
      print(interpolate(fmt, data, true));
      %&gt;
      &lt;/span&gt;
    &lt;/div&gt;
  &lt;/a&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="search-alert-template"&gt;
    &lt;div class="search-alert &lt;%- css_class %&gt;" id="search-alert-&lt;%- cid %&gt;"&gt;
    &lt;div class="search-alert-content"&gt;
        &lt;p class="message"&gt;&lt;%= HtmlUtils.ensureHtml(messageHtml) %&gt;&lt;/p&gt;
    &lt;/div&gt;

    &lt;div class="search-alert-controls"&gt;
        &lt;button class="btn-link dismiss control control-dismiss" title="&lt;%- gettext('Close') %&gt;"&gt;
            &lt;span class="icon fa fa-remove" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/button&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-template"&gt;
    &lt;form class="forum-new-post-form"&gt;
    &lt;h3 class="thread-title"&gt;&lt;%- gettext("Add a Post") %&gt;&lt;/h3&gt;
    &lt;% if (mode === 'inline') { %&gt;
        &lt;button class="btn-default add-post-cancel"&gt;
            &lt;span class="sr"&gt;&lt;%- gettext('Cancel') %&gt;&lt;/span&gt;
            &lt;span class="fa fa-close" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/button&gt;
    &lt;% } %&gt;
    &lt;ul class="post-errors" style="display: none"&gt;&lt;/ul&gt;
    &lt;div class="forum-new-post-form-wrapper"&gt;&lt;/div&gt;
    &lt;% if (cohort_options) { %&gt;
    &lt;div class="post-field group-selector-wrapper &lt;% if (!is_commentable_cohorted) { print('disabled'); } %&gt;"&gt;
        &lt;label class="field-label"&gt;
            &lt;span class="field-label-text"&gt;
                &lt;% //Translators: This labels the selector for which group of students can view a post %&gt;
                &lt;%- gettext("Visible to") %&gt;
            &lt;/span&gt;
            &lt;div class="field-help" id="field_help_visible_to"&gt;
                &lt;%- gettext("Discussion admins, moderators, and TAs can make their posts visible to all students or specify a single cohort.") %&gt;
            &lt;/div&gt;
            &lt;div class="field-input"&gt;
                &lt;select aria-describedby="field_help_visible_to" class="post-topic field-input js-group-select" name="group_id" &lt;% if (!is_commentable_cohorted) { print("disabled"); } %&gt;&gt;
                    &lt;option value=""&gt;&lt;%- gettext("All Groups") %&gt;&lt;/option&gt;
                    &lt;% _.each(cohort_options, function(opt) { %&gt;
                    &lt;option value="&lt;%- opt.value %&gt;" &lt;% if (opt.selected) { print("selected"); } %&gt;&gt;&lt;%- opt.text %&gt;&lt;/option&gt;
                    &lt;% }); %&gt;
                &lt;/select&gt;
            &lt;/div&gt;
        &lt;/label&gt;
    &lt;/div&gt;
    &lt;% } %&gt;
    &lt;div class="post-field"&gt;
        &lt;label class="field-label"&gt;
            &lt;span class="field-label-text"&gt;&lt;%- gettext("Title") %&gt;&lt;/span&gt;
            &lt;div class="field-help" id="field_help_title"&gt;
                &lt;%- gettext("Add a clear and descriptive title to encourage participation.") %&gt;
            &lt;/div&gt;
            &lt;div&gt;
                &lt;input aria-describedby="field_help_title" type="text" class="js-post-title field-input" name="title"&gt;
            &lt;/div&gt;
        &lt;/label&gt;
    &lt;/div&gt;

    &lt;div&gt;
        &lt;span class="field-label-text field-label-text-full" id="new-post-editor-description"&gt;&lt;%- gettext('Your question or idea') %&gt;&lt;/span&gt;
        &lt;div class="js-post-body editor" aria-describedby="new-post-editor-description" name="body"&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="post-options"&gt;
        &lt;label class="post-option is-enabled"&gt;
            &lt;input type="checkbox" name="follow" class="post-option-input js-follow" checked&gt;
            &lt;span class="icon fa fa-star" aria-hidden="true"&gt;&lt;/span&gt;&lt;%- gettext("follow this post") %&gt;
        &lt;/label&gt;
        &lt;% if (allow_anonymous) { %&gt;
        &lt;label class="post-option"&gt;
            &lt;input type="checkbox" name="anonymous" class="post-option-input js-anon"&gt;
            &lt;%- gettext("post anonymously") %&gt;
        &lt;/label&gt;
        &lt;% } %&gt;
        &lt;% if (allow_anonymous_to_peers) { %&gt;
        &lt;label class="post-option"&gt;
            &lt;input type="checkbox" name="anonymous_to_peers" class="post-option-input js-anon-peers"&gt;
            &lt;%- gettext("post anonymously to classmates") %&gt;
        &lt;/div&gt;
        &lt;% } %&gt;
    &lt;/div&gt;
    &lt;div&gt;
        &lt;button type="submit" class="btn-brand submit"&gt;&lt;%- gettext('Submit') %&gt;&lt;/button&gt;
        &lt;button type="button" class="btn cancel"&gt;&lt;%- gettext('Cancel') %&gt;&lt;/button&gt;
    &lt;/div&gt;
&lt;/form&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-menu-entry-template"&gt;
    &lt;option class="topic-title" data-discussion-id="&lt;%- id %&gt;" data-cohorted="&lt;%- is_cohorted %&gt;"&gt;&lt;%- text %&gt;&lt;/option&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-menu-category-template"&gt;
    &lt;optgroup label="&lt;%- text %&gt;"&gt;
    &lt;%= edx.HtmlUtils.ensureHtml(entries) %&gt;
&lt;/optgroup&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="new-post-alert-template"&gt;
    &lt;div class="alert alert-error pattern-library-shim" role="alert" aria-labelledby="alert-title-error-&lt;%- alertId %&gt;" tabindex="-1"&gt;
    &lt;span class="icon alert-icon fa fa-warning" aria-hidden="true"&gt;&lt;/span&gt;

    &lt;div class="alert-message"&gt;
        &lt;h3 class="sr-only alert-title" id="alert-title-error-&lt;%- alertId %&gt;"&gt;
            &lt;%- gettext("Error posting your message.") %&gt;
        &lt;/h3&gt;

        &lt;p class="alert-copy"&gt;
            &lt;%- gettext(message) %&gt;
        &lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="topic-template"&gt;
    &lt;div class="post-field"&gt;
    &lt;label class="field-label"&gt;
        &lt;span class="field-label-text"&gt;
            &lt;%- gettext("Topic area") %&gt;
        &lt;/span&gt;
        &lt;div class="field-help" id="field_help_topic_area"&gt;
            &lt;%- gettext("Add your post to a relevant topic to help others find it.") %&gt;
        &lt;/div&gt;
        &lt;div class="field-input"&gt;
            &lt;select class="post-topic field-input" aria-describedby="field_help_topic_area" required&gt;
                &lt;%= edx.HtmlUtils.ensureHtml(topics_html) %&gt;
            &lt;/select&gt;
        &lt;/div&gt;
    &lt;/label&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="post-user-display-template"&gt;
    &lt;% if (username) { %&gt;
&lt;a href="&lt;%- user_url %&gt;" class="username"&gt;&lt;%- username %&gt;&lt;/a&gt;
    &lt;% if (is_community_ta) { %&gt;
    &lt;span class="user-label-community-ta"&gt;&lt;%- gettext("Community TA") %&gt;&lt;/span&gt;
    &lt;% } else if (is_staff) { %&gt;
    &lt;span class="user-label-staff"&gt;&lt;%- gettext("Staff") %&gt;&lt;/span&gt;
    &lt;% } %&gt;
&lt;% } else { %&gt;
    &lt;%- gettext('anonymous') %&gt;
&lt;% } %&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="inline-discussion-template"&gt;
    &lt;section class="discussion inline-discussion" data-discussion-id="&lt;%- discussionId %&gt;"&gt;
    &lt;div class="add_post_btn_container &lt;%if (read_only) {%&gt;is-hidden&lt;%} %&gt;"&gt;
        &lt;button class="btn-link new-post-btn"&gt;&lt;%- gettext("Add a Post") %&gt;&lt;/button&gt;
    &lt;/div&gt;

    &lt;article class="new-post-article is-hidden"&gt;&lt;/article&gt;

    &lt;div class="inline-discussion-thread-container"&gt;
        &lt;section class="inline-threads"&gt;
        &lt;/section&gt;

        &lt;div class="inline-thread"&gt;
            &lt;div class="forum-nav-bar"&gt;
                &lt;button class="btn-link all-posts-btn"&gt;
                    &lt;span class="icon fa fa-chevron-prev" aria-hidden="true"&gt;&lt;/span&gt;
                    &lt;span aria-hidden="true"&gt;&lt;%- gettext('All Posts') %&gt;&lt;/span&gt;
                    &lt;span class="sr-only"&gt;&lt;%- gettext('Return to all posts') %&gt;&lt;/span&gt;
                &lt;/button&gt;
            &lt;/div&gt;
            &lt;div class="forum-content"&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/section&gt;


&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="pagination-template"&gt;
    &lt;nav class="discussion-paginator"&gt;
    &lt;ol&gt;
        &lt;% if (previous) { %&gt;
            &lt;li class="previous-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= previous.url %&gt;" data-page-number="&lt;%= previous.number %&gt;"&gt;&amp;lt; &lt;%- gettext("Previous") %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (first) { %&gt;
            &lt;li class="first-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= first.url %&gt;" data-page-number="1"&gt;1&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (leftdots) { %&gt;
            &lt;li class="previous-ellipses"&gt;&lt;%- gettext("…") %&gt;&lt;/li&gt;
        &lt;% } %&gt;

        &lt;% _.each(lowPages, function(page) { %&gt;
            &lt;li class="lower-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= page.url %&gt;" data-page-number="&lt;%= page.number %&gt;"&gt;&lt;%= page.number %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% }); %&gt;
        &lt;li class="current-page"&gt;&lt;span&gt;&lt;%= page %&gt;&lt;/span&gt;&lt;/li&gt;
        &lt;% _.each(highPages, function(page) { %&gt;
            &lt;li class="higher-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= page.url %&gt;" data-page-number="&lt;%= page.number %&gt;"&gt;&lt;%= page.number %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% }); %&gt;

        &lt;% if (rightdots) { %&gt;
            &lt;li class="next-ellipses"&gt;&lt;%- gettext("…") %&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (last) { %&gt;
            &lt;li class="last-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= last.url %&gt;" data-page-number="&lt;%= last.number %&gt;"&gt;&lt;%= last.number %&gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
        &lt;% if (next) { %&gt;
            &lt;li class="next-page"&gt;&lt;a class="discussion-pagination" href="&lt;%= next.url %&gt;" data-page-number="&lt;%= next.number %&gt;"&gt;&lt;%- gettext("Next") %&gt; &amp;gt;&lt;/a&gt;&lt;/li&gt;
        &lt;% } %&gt;
    &lt;/ol&gt;
&lt;/nav&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="profile-thread-template"&gt;
    &lt;article class="discussion-article" data-id="&lt;%- id %&gt;"&gt;
    &lt;div class="discussion-post"&gt;
        &lt;header&gt;
            &lt;h3&gt;&lt;%- title %&gt;&lt;/h3&gt;
            &lt;p class="posted-details"&gt;
                &lt;% if (user) { %&gt;
                    &lt;a href="&lt;%- user.url %&gt;" class="username"&gt;&lt;%- user.username %&gt;&lt;/a&gt;
                &lt;% } else { %&gt;
                    &lt;%- gettext("anonymous") %&gt;
                &lt;% } %&gt;

                &lt;span class="timeago" title="&lt;%- created_at %&gt;"&gt;&lt;%- created_at %&gt;&lt;/span&gt;
                &lt;span class="post-status-closed top-post-status" style="display: none"&gt;
                    &amp;bull; &lt;%- gettext("This thread is closed.") %&gt;
                &lt;/span&gt;
            &lt;/p&gt;
        &lt;/header&gt;
        &lt;div class="post-body"&gt;&lt;%= abbreviatedBody %&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="post-tools"&gt;
        &lt;a href="&lt;%- permalink %&gt;"&gt;&lt;%- gettext("View discussion") %&gt;&lt;/a&gt;
    &lt;/div&gt;

&lt;/article&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="customwmd-prompt-template"&gt;
    &lt;h4 id="editor-dialog-title"&gt;&lt;%- title %&gt;&lt;/h4&gt;
&lt;div role="status" id="wmd-editor-dialog-form-errors" class="sr" tabindex="-1"&gt;&lt;/div&gt;
&lt;div&gt;
    &lt;form class="form"&gt;
        &lt;fieldset class="field-group"&gt;
            &lt;legend class="form-group-hd sr"&gt;&lt;%- title %&gt;&lt;/legend&gt;
            &lt;div class="field &lt;%- uploadFieldClass %&gt;"&gt;
                &lt;label id="new-url-input-label" for="new-url-input" class="field-label"&gt;
                    &lt;%- urlLabel %&gt;&lt;/label&gt;
                &lt;input type="text" id="new-url-input" class="field-input input-text" aria-describedby="new-url-input-help"&gt;
                &lt;% if (imageUploadHandler) { %&gt;
                    &lt;button id="file-upload-proxy" class="btn btn-primary btn-base form-btn"&gt;
                        &lt;%- chooseFileText %&gt;
                    &lt;/button&gt;
                    &lt;input type="file" name="file-upload" id="file-upload" style="display:none;"/&gt;
                &lt;% } %&gt;
                &lt;div id="new-url-input-field-message" class="field-message has-error" style="display:none"&gt;
                    &lt;span class="field-message-content"&gt;&lt;%- urlError %&gt;&lt;/span&gt;
                &lt;/div&gt;
                &lt;div id="new-url-input-help" class="field-hint"&gt;
                    &lt;%- urlHelp %&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="field"&gt;
                &lt;label for="new-url-desc-input" class="field-label"&gt;&lt;%- urlDescLabel %&gt;&lt;/label&gt;
                &lt;input type="text" id="new-url-desc-input" class="field-input input-text" required aria-describedby="new-url-desc-input-help"&gt;
                &lt;div id="new-url-desc-input-field-message" class="field-message has-error" style="display:none"&gt;
                    &lt;span class="field-message-content"&gt;&lt;%- descError %&gt;&lt;/span&gt;
                &lt;/div&gt;
                &lt;div id="new-url-desc-input-help" class="field-hint"&gt;
                    &lt;%- urlDescHelp %&gt;
                    &lt;% if (urlDescHelpLink) { %&gt;
                        &lt;a href="&lt;%- urlDescHelpLink['href'] %&gt;"&gt;
                            &lt;%- urlDescHelpLink['text'] %&gt;
                        &lt;/a&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="field"&gt;&lt;% if (imageUploadHandler) { %&gt;
                &lt;label for="img-is-decorative" class="field-label label-inline"&gt;
                    &lt;input type="checkbox" id="img-is-decorative" class="field-input input-checkbox"&gt;
                    &lt;span class="field-input-label"&gt;&lt;%- imageIsDecorativeLabel %&gt;&lt;/span&gt;
                &lt;/label&gt; &lt;% }
            %&gt;&lt;/div&gt;
        &lt;/fieldset&gt;
        &lt;div class="form-actions"&gt;
            &lt;input type="button" id="new-link-image-ok" class="btn-brand form-btn" value="&lt;%- okText %&gt;" /&gt;
            &lt;input type="button" id="new-link-image-cancel" class="btn form-btn" value="&lt;%- cancelText %&gt;" &gt;
        &lt;/div&gt;
    &lt;/form&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="nav-loading-template"&gt;
    &lt;div class="forum-nav-loading" tabindex="0"&gt;
    &lt;span class="icon fa fa-spinner fa-spin"/&gt;
    &lt;span class="sr" role="alert"&gt;&lt;%- srText %&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="thread-type-template"&gt;
    &lt;div class="post-field"&gt;
    &lt;div class="field-label"&gt;
        &lt;span class="field-label-text"&gt;
            &lt;% // Translators: This is the label for a control to select a forum post type %&gt;
            &lt;%- gettext("Post type") %&gt;
        &lt;/span&gt;
        &lt;div class="field-help" id="field_help_post_type"&gt;
            &lt;%- gettext("Questions raise issues that need answers. Discussions share ideas and start conversations.") %&gt;
        &lt;/div&gt;
        &lt;div class="field-label"&gt;
            &lt;fieldset class="field-input"&gt;
                &lt;legend class="sr"&gt;&lt;%- gettext("Post type") %&gt;&lt;/legend&gt;
                &lt;input aria-describedby="field_help_post_type" type="radio" name="&lt;%= form_id %&gt;-post-type" class="post-type-input" id="&lt;%= form_id %&gt;-post-type-question" value="question"&gt;
                &lt;label for="&lt;%= form_id %&gt;-post-type-question" class="post-type-label"&gt;
                    &lt;span class="icon fa fa-question" aria-hidden="true"&gt;&lt;/span&gt;
                    &lt;% // Translators: This is a forum post type %&gt;
                    &lt;%- gettext("Question") %&gt;
                &lt;/label&gt;
                &lt;input aria-describedby="field_help_post_type" type="radio" name="&lt;%= form_id %&gt;-post-type" class="post-type-input" id="&lt;%= form_id %&gt;-post-type-discussion" value="discussion" checked&gt;
                &lt;label for="&lt;%= form_id %&gt;-post-type-discussion" class="post-type-label"&gt;
                    &lt;span class="icon fa fa-comments" aria-hidden="true"&gt;&lt;/span&gt;
                    &lt;% // Translators: This is a forum post type %&gt;
                    &lt;%- gettext("Discussion") %&gt;
                &lt;/label&gt;
            &lt;/fieldset&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;


&lt;script aria-hidden="true" type="text/template" id="forum-action-endorse"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-button action-endorse" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Endorse") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Endorse") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unendorse") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-check" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-answer"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-button action-answer" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Mark as Answer") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Mark as Answer") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unmark as Answer") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-check" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-follow"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-button action-follow" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Follow") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Follow") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unfollow") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-star" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-vote"&gt;
    &lt;li class="actions-item"&gt;
    &lt;span aria-hidden="true" class="display-vote is-hidden" &gt;
      &lt;span class="vote-count"&gt;&lt;/span&gt;
    &lt;/span&gt;
    &lt;button class="btn-link action-button action-vote" role="checkbox" aria-checked="false"&gt;
        &lt;% // Vote counts are populated by JS %&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Vote for this post,") %&gt;&amp;nbsp;&lt;/span&gt;
        &lt;span class="sr js-sr-vote-count"&gt;&lt;/span&gt;

        &lt;span class="action-label" aria-hidden="true"&gt;
          &lt;span class="vote-count"&gt;&lt;/span&gt;
        &lt;/span&gt;

        &lt;span class="action-icon" aria-hidden="true"&gt;
            &lt;span class="icon fa fa-plus" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-report"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-report" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Report abuse") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Report") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unreport") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;
          &lt;span class="icon fa fa-flag" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-pin"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-pin" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Pin") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Pin") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Unpin") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;
          &lt;span class="icon fa fa-thumb-tack" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-close"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-close" role="checkbox" aria-checked="false"&gt;
        &lt;span class="sr"&gt;&lt;%- gettext("Close") %&gt;&lt;/span&gt;
        &lt;span class="action-label" aria-hidden="true"&gt;
            &lt;span class="label-unchecked"&gt;&lt;%- gettext("Close") %&gt;&lt;/span&gt;
            &lt;span class="label-checked"&gt;&lt;%- gettext("Open") %&gt;&lt;/span&gt;
        &lt;/span&gt;
        &lt;span class="action-icon"&gt;
          &lt;span class="icon fa fa-lock" aria-hidden="true"&gt;&lt;/span&gt;
        &lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-edit"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-edit"&gt;
        &lt;span class="action-label"&gt;&lt;%- gettext("Edit") %&gt;&lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-pencil" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-action-delete"&gt;
    &lt;li class="actions-item"&gt;
    &lt;button class="btn-link action-list-item action-delete"&gt;
        &lt;span class="action-label"&gt;&lt;%- gettext("Delete") %&gt;&lt;/span&gt;
        &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-remove" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="forum-actions"&gt;
    &lt;% if (!readOnly) { %&gt;
    &lt;ul class="&lt;%= contentType %&gt;-actions-list"&gt;
        &lt;% _.each(primaryActions, function(action) { print(_.template($('#forum-action-' + action).html())({})) }) %&gt;
        &lt;li class="actions-item is-visible"&gt;
            &lt;div class="more-wrapper"&gt;
                &lt;button class="btn-link action-button action-more" aria-label="&lt;%- gettext('More') %&gt;" aria-haspopup="true" aria-controls="action-menu-&lt;%= contentType %&gt;"&gt;
                    &lt;span class="action-label"&gt;&lt;%- gettext('More') %&gt;&lt;/span&gt;
                    &lt;span class="action-icon"&gt;&lt;span class="icon fa fa-ellipsis-h" aria-hidden="true"&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;/button&gt;
                &lt;div class="actions-dropdown" id="action-menu-&lt;%= contentType %&gt;" aria-expanded="false"&gt;
                  &lt;ul class="actions-dropdown-list"&gt;
                    &lt;% _.each(secondaryActions, function(action) { print(_.template($('#forum-action-' + action).html())({})) }) %&gt;
                  &lt;/ul&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/li&gt;
    &lt;/ul&gt;
&lt;% } %&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="alert-popup"&gt;
    &lt;div class='modal' role='alertdialog' id='discussion-alert' aria-describedby='discussion-alert-message'&gt;
    &lt;div class='inner-wrapper discussion-alert-wrapper'&gt;
        &lt;button class='btn close-modal dismiss' title='&lt;%- gettext("Close") %&gt;''&gt;
            &lt;span class='icon fa fa-times' aria-hidden='true'&gt;&lt;/span&gt;
        &lt;/button&gt;
        &lt;header&gt;
            &lt;h2/&gt;&lt;/h2&gt;
            &lt;hr/&gt;
        &lt;/header&gt;
        &lt;p id='discussion-alert-message'&gt;&lt;/p&gt;
        &lt;hr/&gt;
        &lt;button class='btn dismiss'&gt;&lt;%- gettext("OK") %&gt;&lt;/button&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/script&gt;
&lt;script aria-hidden="true" type="text/template" id="nav-load-more-link"&gt;
    &lt;li class='forum-nav-load-more'&gt;
    &lt;button class='btn-link forum-nav-load-more-link'&gt;
        &lt;%- gettext("Load more") %&gt;
    &lt;/button&gt;
&lt;/li&gt;

&lt;/script&gt;



&lt;script type="text/template" id="thread-list-template"&gt;
    &lt;div class="forum-nav-thread-list-wrapper" id="sort-filter-wrapper" tabindex="-1"&gt;
        &lt;div class="forum-nav-refine-bar"&gt;
            &lt;label class="forum-nav-filter-main"&gt;
                &lt;span class="sr"&gt;Filter:&lt;/span&gt;
                &lt;select class="forum-nav-filter-main-control"&gt;
                    &lt;option value="all"&gt;显示全部&lt;/option&gt;
                    &lt;option value="unread"&gt;Unread&lt;/option&gt;
                    &lt;option value="unanswered"&gt;Unanswered&lt;/option&gt;
                &lt;/select&gt;
            &lt;/label&gt;&lt;% if (isCohorted &amp;&amp; isPrivilegedUser) { %&gt;&lt;label class="forum-nav-filter-cohort"&gt;
                &lt;span class="sr"&gt;Cohort:&lt;/span&gt;
                &lt;select class="forum-nav-filter-cohort-control"&gt;
                    &lt;option value=""&gt;in all cohorts&lt;/option&gt;
                &lt;/select&gt;
            &lt;/label&gt;&lt;% } %&gt;&lt;label class="forum-nav-sort"&gt;
                &lt;span class="sr"&gt;Sort:&lt;/span&gt;
                &lt;select class="forum-nav-sort-control"&gt;
                    &lt;option value="activity"&gt;近期活动&lt;/option&gt;
                    &lt;option value="comments"&gt;活跃度&lt;/option&gt;
                    &lt;option value="votes"&gt;最多票数&lt;/option&gt;
                &lt;/select&gt;
            &lt;/label&gt;
        &lt;/div&gt;
        &lt;div class="search-alerts"&gt;&lt;/div&gt;
        &lt;ul class="forum-nav-thread-list"&gt;&lt;/ul&gt;
    &lt;/div&gt;
&lt;/script&gt;




&lt;div class="discussion-module" data-discussion-id="401c5b51db9f938c7b7f72eef000df375f446d78"
    data-user-create-comment="true"
    data-user-create-subcomment="true"
    data-read-only="false"&gt;
    &lt;div class="discussion-module-header"&gt;
        &lt;h3 class="discussion-module-title"&gt;讨论&lt;/h3&gt;
        &lt;div class="inline-discussion-topic"&gt;&lt;span class="inline-discussion-topic-title"&gt;Topic:&lt;/span&gt; 管道与shell：管道 / 管道的同步&lt;/div&gt;
    &lt;/div&gt;
    &lt;button class="discussion-show btn" data-discussion-id="401c5b51db9f938c7b7f72eef000df375f446d78"&gt;
        &lt;span class="button-text"&gt;显示讨论&lt;/span&gt;
    &lt;/button&gt;
&lt;/div&gt;
&lt;script type="text/javascript"&gt;
var $$course_id = "course\u002Dv1:Internal+B3I062140+2019_T2";

function DiscussionInlineBlock(runtime, element) {
    'use strict';
    new DiscussionInlineView({ el: $(element).find('.discussion-module') });
}
&lt;/script&gt;

&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;

  </div>
  <div id="seq_content" aria-labelledby="tab_2">
    <div class="xblock xblock-student_view xblock-student_view-vertical xblock-initialized" data-runtime-class="LmsRuntime" data-init="VerticalStudentView" data-course-id="course-v1:Internal+B3I062140+2019_T2" data-request-token="03ca6f9e547511ea990d5254001c17d8" data-runtime-version="1" data-usage-id="block-v1:Internal+B3I062140+2019_T2+type@vertical+block@0de09bcda6b744f8afc789c783241844" data-block-type="vertical">
  

  <h3 class="unit-title">管道的读写</h3>

    


<div class="bookmark-button-wrapper">
  <button class="btn btn-link bookmark-button" aria-pressed="false" data-bookmark-id="18231047,block-v1:Internal+B3I062140+2019_T2+type@vertical+block@0de09bcda6b744f8afc789c783241844">
     <span class="sr bookmark-sr">Click to add</span>
     <span class="bookmark-text">Bookmark this page</span>
    </button>
</div>


<div class="vert-mod">
  <div class="vert vert-0" data-id="block-v1:Internal+B3I062140+2019_T2+type@html+block@0d97dc53ce354b70840175d4eddae0b3">
    <div class="xblock xblock-student_view xblock-student_view-html xmodule_display xmodule_HtmlModule xblock-initialized" data-runtime-class="LmsRuntime" data-init="XBlockToXModuleShim" data-block-type="html" data-request-token="03ca6f9e547511ea990d5254001c17d8" data-runtime-version="1" data-usage-id="block-v1:Internal+B3I062140+2019_T2+type@html+block@0d97dc53ce354b70840175d4eddae0b3" data-type="HTMLModule" data-course-id="course-v1:Internal+B3I062140+2019_T2">
  
  <p>我们可以在 user/pipe.c 中轻松地找到 Pipe 结构体的定义，它的定义如下：</p>
<p style="margin: 0px;"><code>struct Pipe {</code></p>
<p style="margin: 0px; padding-left: 30px;"><code> u_int p_rpos; // read position</code></p>
<p style="margin: 0px; padding-left: 30px;"><code> u_int p_wpos; // write position</code></p>
<p style="margin: 0px; padding-left: 30px;"><code> u_char p_buf[BY2PIPE]; // data buffer</code></p>
<p></p>
<p style="margin: 0px;"><code> };</code></p>
<p style="margin: 0px;">在 Pipe 结构体中,p_rpos 给出了下一个将要从管道读的数据的位置，而 p_wpos 给出了下一个将要向管道写的数据的位置。只有读者可以更新 p_rpos，同样，只有写者可以更新 p_wpos，读者和写者通过这两个变量的值进行协调读写。一个管道有 BY2PIPE(32Byte)大小的缓冲区。</p>
<p style="margin: 0px;"></p>
<p style="margin: 0px;">这个只有 BY2PIPE 大小的缓冲区发挥的作用类似于环形缓冲区，所以下一个要读或写的位置 i 实际上是 i%BY2PIPE。</p>
<p style="margin: 0px;"></p>
<p style="margin: 0px;">读者在从管道读取数据时，要将 p_buf[p_rpos%BY2PIPE] 的数据拷贝走，然后读指针自增 1。但是需要注意的是，管道的缓冲区此时可能还没有被写入数据。所以如果管道数据为空，即当 p_rpos &gt;= p_wpos 时，应该进程切换到写者运行。</p>
<p style="margin: 0px;"></p>
<p style="margin: 0px;">类似于读者，写者在向管道写入数据时，也是将数据存入 p_buf[p_wpos%BY2PIPE]，然后写指针自增 1。需要注意管道的缓冲区可能出现满溢的情况，所以写者必须得在p_wpos - p_rpos &lt; BY2PIPE 时方可运行，否则要一直挂起。</p>
<p style="margin: 0px;"></p>
<p style="margin: 0px;">上面这些还不足以使得读者写者一定能顺利完成管道操作。假设这样的情景：管道写端已经全部关闭，读者读到缓冲区有效数据的末尾，此时有 p_rpos = p_wpos。按照上面的做法，我们这里应当切换到写者运行。但写者进程已经结束，进程切换就造成了死循环，这时候读者进程如何知道应当退出了呢？</p>
<p style="margin: 0px;"></p>
<p style="margin: 0px;">为了解决上面提出的问题，我们必须得知道管道的另一端是否已经关闭。不论是在读者还是在写者中，我们都需要对另一端的状态进行判断：当出现缓冲区空或满的情况时，要根据另一端是否关闭来判断是否要返回。如果另一端已经关闭，进程返回 0 即可；如果没有关闭，则切换到其他进程运行。</p>
<p style="margin: 0px;"></p>
<p style="margin: 0px;"><strong>Note 6.2.1 如果管道的写端相关的所有的文件描述符都已经关闭，那么管道读端将会读到文件结尾并返回 0。link : http://linux.die.net/man/7/pipe</strong></p>
<p style="margin: 0px;"></p>
<p style="margin: 0px;">那么我们该如何知晓管道的另一端是否已经关闭了呢？这时就要用到我们的static int _pipeisclosed(struct Fd *fd, struct Pipe *p)函数。而这个函数的核心，就是下面我们要讲的恒成立等式了。</p>
<p style="margin: 0px;"></p>
<p style="margin: 0px;">在之前的图6.2中我们没有明确画出文件描述符所占的页，但实际上，对于每一个匿名管道而言，我们分配了三页空间：一页是读数据的文件描述符 rfd，一页是写数据的文件描述符 wfd，剩下一页是被两个文件描述符共享的管道数据缓冲区。既然管道数据缓冲区 h 是被两个文件描述符所共享的，我们很直观地就能得到一个结论：如果有 1 个读者，1 个写者，那么管道将被引用 2 次，就如同上图所示。pageref 函数能得到页的引用次数，所以实际上有下面这个等式成立：</p>
<p style="margin: 0px;"></p>
<p style="margin: 0px;">pageref(rfd) + pageref(wfd) = pageref(pipe)</p>
<p style="margin: 0px;"></p>
<p style="margin: 0px;"><strong>Note 6.2.2 内核会对 pages 数组成员维护一个页引用变量 pp_ref 来记录指向该物理页的虚页数量。pageref 的实现实际上就是查询虚页 P 对应的实际物理页，然后返回其 pp_ref 变量的值。</strong></p>
<p style="margin: 0px;"></p>
<p style="margin: 0px;">这个等式对我们而言有什么用呢？假设我们现在在运行读者进程，而进行管道写入的进程都已经结束了，那么此时就应该有：pageref(wfd) = 0。所以就有pageref(rfd) = pageref(pipe)。所以我们只要判断这个等式是否成立就可以得知写端是否关闭，对写者来说同理。</p>
<p style="margin: 0px;"></p>
<p style="margin: 0px;"><span style="color: #0000ff;">Exercise 6.2 根据上述提示与代码中的注释，填写 user/pipe.c 中的 piperead、pipewrite、_pipeisclosed 函数并通过 testpipe 的测试。</span></p>
<p style="margin: 0px;"></p>
<p style="margin: 0px;"><strong>Note 6.2.3 注意在本次实验中由于文件系统服务所在进程已经默认为 1 号进程 (起始进程为 0 号进程)，在测试时想启用文件系统需要注意 ENV_CREATE(fs_serv)在 init.c 中的位置。</strong></p>
<p style="margin: 0px;"></p>
<p style="margin: 0px;"></p>
</div>

  </div>
  <div class="vert vert-1" data-id="block-v1:Internal+B3I062140+2019_T2+type@discussion+block@201a93fb06a843d09ec5e384b3c5676e">
    <div class="xblock xblock-student_view xblock-student_view-discussion xblock-initialized" data-runtime-class="LmsRuntime" data-init="DiscussionInlineBlock" data-course-id="course-v1:Internal+B3I062140+2019_T2" data-request-token="03ca6f9e547511ea990d5254001c17d8" data-runtime-version="1" data-usage-id="block-v1:Internal+B3I062140+2019_T2+type@discussion+block@201a93fb06a843d09ec5e384b3c5676e" data-block-type="discussion">
  





<script type="text/javascript">
  window.PLATFORM_NAME = "CSCore";
    window.ENABLE_DISCUSSION_HOME_PANEL = true;
</script>



<script aria-hidden="true" type="text/template" id="thread-template">
    <article class="discussion-article" data-id="<%- id %>" tabindex="-1">
    <div class="thread-wrapper">
        <div class="thread-main-wrapper">
            <div class="thread-content-wrapper"></div>
            <div class="post-extended-content">
                <ol class="responses js-marked-answer-list"></ol>
            </div>
        </div>
        <div class="post-extended-content thread-responses-wrapper">
            <div class="response-btn-count-wrapper">
                <% if (!readOnly) { %>
                <div class="add-response">
                    <button class="btn btn-small add-response-btn">
                        <%- gettext("Add a Response") %>
                    </button>
                </div>
                <% } %>
                <div class="response-count"></div>
            </div>
            <ol class="responses js-response-list"></ol>
            <div class="response-pagination"></div>
            <div class="post-status-closed bottom-post-status" style="display: none">
              <%- gettext("This thread is closed.") %>
            </div>
            <% if (can_create_comment && !readOnly) { %>
            <form class="discussion-reply-new" data-id="<%- id %>">
                <h4><%- gettext("Add a response:") %></h4>
                <ul class="discussion-errors"></ul>
                <div class="reply-body" data-id="<%- id %>"></div>
                <div class="reply-post-control">
                    <button class="btn discussion-submit-post control-button"><%- gettext("Submit") %></button>
                </div>
            </form>
            <% } %>
        </div>
    </div>
</article>

</script>
<script aria-hidden="true" type="text/template" id="thread-show-template">
    <div class="discussion-post">
    <header class="post-header">
        <% if (!readOnly) { %>
            <div class="post-header-actions">
                <%=
                _.template(
                    $('#forum-actions').html())(
                    {
                        contentId: cid,
                        contentType: 'post',
                        primaryActions: ['vote', 'follow'],
                        secondaryActions: ['pin', 'edit', 'delete', 'report', 'close'],
                        readOnly: readOnly
                    }
                )
                %>
            </div>
        <% } %>
        <div class="post-header-content">
            <h4 class="post-title"><%- title %></h4>
            <p class="posted-details">
            <%
            var timeAgoHtml = interpolate(
                '<span class="timeago" title="%(created_at)s">%(created_at)s</span>',
                {created_at: created_at},
                true
            );
            %>
            <%=
            interpolate(
                // Translators: post_type describes the kind of post this is (e.g. "question" or "discussion");
                // time_ago is how much time has passed since the post was created (e.g. "4 hours ago")
                _.escape(gettext('%(post_type)s posted %(time_ago)s by %(author)s')),
                {post_type: thread_type, time_ago: timeAgoHtml, author: author_display},
                true
            )
            %>
            </p>
            <div class="post-labels">
                <span class="post-label post-label-pinned">
                    <span class="icon fa fa-thumb-tack" aria-hidden="true"></span><%- gettext("Pinned") %>
                </span>
                <span class="post-label post-label-reported">
                    <span class="icon fa fa-flag" aria-hidden="true"></span><%- gettext("Reported") %>
                </span>
                <span class="post-label post-label-closed">
                    <span class="icon fa fa-lock" aria-hidden="true"></span><%- gettext("Closed") %>
                </span>
            </div>
        </div>
    </header>

    <div class="post-body"><%- body %></div>
    <div class="post-context">
        <% if (mode === "tab" && obj.courseware_url) { %>
            <%
            var courseware_title_linked = interpolate(
                '<a href="%(courseware_url)s">%(courseware_title)s</a>',
                {courseware_url: courseware_url, courseware_title: _.escape(courseware_title)},
                true
            );
            %>
            <%=
            interpolate(
                _.escape(gettext('Related to: %(courseware_title_linked)s')),
                {courseware_title_linked: courseware_title_linked},
                true
            )
            %>
        <% } %>
        <div class="group-visibility-label">
            <% if (obj.group_name) { %>
                <%-
                interpolate(
                    gettext('This post is visible only to %(group_name)s.'),
                    {group_name: obj.group_name},
                    true
                )
                %>
            <% } else { %>
                <%- gettext('This post is visible to everyone.') %>
            <% } %>
        </div>
    </div>
</div>

</script>
<script aria-hidden="true" type="text/template" id="thread-edit-template">
    <h4><%- gettext("Editing post") %></h4>
<ul class="post-errors"></ul>
<div class="forum-edit-post-form-wrapper"></div>
<div class="post-field">
    <label class="field-label">
        <span class="field-label-text"><%- gettext("Title") %></span>
        <div class="field-help" id="field_help_title">
            <%- gettext("Add a clear and descriptive title to encourage participation.") %>
        </div>
        <input aria-describedby="field_help_title" type="text" class="edit-post-title field-input" name="title" value="<%- title %>">
    </label>
</div>
<div class="form-row post-field">
    <p class="sr-only field-help" id="edit-post-editor-description"><%- gettext('Edit your post below.') %></p>
    <div class="edit-post-body" aria-describedby="edit-post-editor-description" name="body"><%- body %></div>
</div>
<button type="submit" id="edit-post-submit" class="btn-brand submit post-update"><%- gettext("Update post") %></button>
<button class="btn post-cancel"><%- gettext("Cancel") %></button>

</script>
<script aria-hidden="true" type="text/template" id="thread-response-template">
    <div class="discussion-response"></div>
<button class="btn-link action-show-comments">
    <%
    var fmts = ngettext("Show Comment (%(num_comments)s)", "Show Comments (%(num_comments)s)", comments.length);
    print(interpolate(fmts, {num_comments: comments.length}, true));
    %>
    <span class="icon fa fa-caret-down" aria-hidden="true"></span>
</button>
<ol class="comments">
    <li class="new-comment">
        <% if (create_sub_comment && !readOnly) { %>
            <form class="comment-form" data-id="<%- wmdId %>">
                <ul class="discussion-errors"></ul>
                <label class="sr" for="add-new-comment-<%- wmdId %>"><%- gettext("Add a comment") %></label>
                <div class="comment-body" id="add-new-comment-<%- wmdId %>" data-id="<%- wmdId %>"
                data-placeholder="<%- gettext('Add a comment') %>"></div>
                <div class="comment-post-control">
                    <button class="btn-brand discussion-submit-comment control-button"><%- gettext("Submit") %></button>
                </div>
            </form>
        <% } %>
    </li>
</ol>

</script>
<script aria-hidden="true" type="text/template" id="thread-response-show-template">
    <header class="response-header">
  <div class="response-header-content">
    <%= author_display %>
    <p class="posted-details">
        <span class="timeago" title="<%= created_at %>"><%= created_at %></span>
        <% if (obj.endorsement && obj.endorsed) { %>
            -
            <%
            var fmt = null;
            if (thread.get("thread_type") == "question") {
              if (endorsement.username) {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("marked as answer %(time_ago)s by %(user)s");
              } else {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("marked as answer %(time_ago)s");
              }
            } else {
              if (endorsement.username) {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("endorsed %(time_ago)s by %(user)s");
              } else {
                // Translators: time_ago is a placeholder for a fuzzy, relative timestamp
                // like "4 hours ago" or "about a month ago"
                fmt = gettext("endorsed %(time_ago)s");
              }
            }
            var time_ago = interpolate(
              '<span class="timeago" title="%(time)s">%(time)s</span>',
              {time: endorsement.time},
              true
            );
            %>
            <%= interpolate(fmt, {time_ago: time_ago, user: endorser_display}, true) %>
        <% } %>
      </p>
      <div class="post-labels">
          <span class="post-label post-label-reported">
              <span class="icon fa fa-flag" aria-hidden="true"></span><%- gettext("Reported") %>
          </span>
      </div>
      </div>
      <div class="response-header-actions">
        <%=
            _.template(
                $('#forum-actions').html())(
                {
                    contentId: cid,
                    contentType: 'response',
                    primaryActions: ['vote', thread.get('thread_type') == 'question' ? 'answer' : 'endorse'],
                    secondaryActions: ['edit', 'delete', 'report'],
                    readOnly: readOnly
                }
            )
        %>
      </div>
</header>

<div class="response-body"><%- body %></div>

</script>
<script aria-hidden="true" type="text/template" id="thread-response-edit-template">
    <div class="edit-post-form">
    <h1><%- gettext("Editing response") %></h1>
    <ul class="edit-post-form-errors"></ul>
    <div class="form-row">
        <div class="edit-post-body" name="body" data-id="<%- id %>"><%- body %></div>
    </div>
    <button type="submit" id="edit-response-submit"class="btn-brand post-update"><%- gettext("Update response") %></button>
    <button class="btn post-cancel"><%- gettext("Cancel") %></button>
</div>

</script>
<script aria-hidden="true" type="text/template" id="response-comment-show-template">
    <div class="discussion-comment" id="comment_<%- id %>">
  <div class="response-body"><%- body %></div>
  <%=
      _.template(
          $('#forum-actions').html())(
          {
              contentId: cid,
              contentType: 'comment',
              primaryActions: [],
              secondaryActions: ['edit', 'delete', 'report'],
              readOnly: readOnly
          }
      )
  %>
  <p class="posted-details">
    <%
    var time_ago = interpolate(
      '<span class="timeago" title="%(time)s">%(time)s</span>',
      {time: created_at},
      true
    );
    %>
    <%= interpolate(
      // Translators: 'timeago' is a placeholder for a fuzzy, relative timestamp (see: https://github.com/rmm5t/jquery-timeago)
      gettext("posted %(time_ago)s by %(author)s"),
      {time_ago: time_ago, author: author_display},
      true
    ) %>
  </p>
  <div class="post-labels">
    <span class="post-label post-label-reported">
      <span class="icon fa fa-flag" aria-hidden="true"></span><%- gettext("Reported") %>
    </span>
  </div>
</div>

</script>
<script aria-hidden="true" type="text/template" id="response-comment-edit-template">
    <div class="edit-post-form" id="comment_<%- id %>">
    <h1><%- gettext("Editing comment") %></h1>
    <ul class="edit-comment-form-errors"></ul>
    <div class="form-row">
        <div class="edit-comment-body" name="body" data-id="<%- id %>"><%- body %></div>
    </div>
    <button type="submit" id="edit-comment-submit" class="btn-brand post-update"><%- gettext("Update comment") %></button>
    <button class="btn post-cancel"><%- gettext("Cancel") %></button>
</div>

</script>
<script aria-hidden="true" type="text/template" id="thread-list-item-template">
    <li data-id="<%- id %>" class="forum-nav-thread<% if (neverRead) { %> never-read<% } %>">
  <a href="<%- threadUrl %>" class="forum-nav-thread-link">
    <div class="forum-nav-thread-wrapper-0">
      <%
      var icon_class, sr_text;
      if (thread_type === "discussion") {
          icon_class = "fa-comments";
          // Translators: This is a label for a Discussion forum thread
          sr_text = gettext("discussion");
      } else if (endorsed) {
          icon_class = "fa-check-square-o";
          // Translators: This is a label for a Question forum thread with a marked answer
          sr_text = gettext("answered question");
      } else {
          icon_class = "fa-question";
          // Translators: This is a label for a Question forum thread without a marked answer
          sr_text = gettext("unanswered question");
      }
      %>
      <span class="sr"><%= sr_text %></span>
      <span class="icon fa <%= icon_class %>" aria-hidden="true"></span>
    </div><div class="forum-nav-thread-wrapper-1">
      <span class="forum-nav-thread-title"><%- title %></span>
      <% if (showThreadPreview){ %>
        <div class="thread-preview-body"><%- threadPreview %></div>
      <% } %>
      <% if(typeof(subscribed) === "undefined") { var subscribed = null; } %>
      <% if(pinned || subscribed || staff_authored || community_ta_authored) { %>
        <ul class="forum-nav-thread-labels">
        <% if (pinned) { %>
          <li class="post-label post-label-pinned">
            <span class="icon fa fa-thumb-tack" aria-hidden="true"></span>
            <% // Translators: This is a label for a forum thread that has been pinned %>
            <%- gettext("Pinned") %>
          </li>
        <% } %>
        <% if (subscribed) { %>
          <li class="post-label post-label-following">
            <span class="icon fa fa-star" aria-hidden="true"></span>
            <% // Translators: This is a label for a forum thread that the user is subscribed to %>
            <%- gettext("Following") %>
          </li>
        <% } %>
        <% if (staff_authored) { %>
          <li class="post-label post-label-by-staff">
            <span class="icon fa fa-user" aria-hidden="true"></span>
            <% // Translators: This is a label for a forum thread that was authored by a member of the course staff %>
            <%- gettext("Staff") %>
          </li>
        <% } %>
        <% if (community_ta_authored) { %>
          <li class="post-label post-label-by-community-ta">
            <span class="icon fa fa-user" aria-hidden="true"></span>
            <% // Translators: This is a label for a forum thread that was authored by a community TA %>
            <%- gettext("Community TA") %>
          </li>
        <% } %>
        </ul>
      <% } %>
    </div><div class="forum-nav-thread-wrapper-2">
      <%
      // Translators: 'votes_count' is a numerical placeholder for a specific discussion thread; 'span_start' and 'span_end' placeholders refer to HTML markup.  Please translate the word 'votes'.
      var fmt = ngettext(
           "%(votes_count)s%(span_start)s vote %(span_end)s",
           "%(votes_count)s%(span_start)s votes %(span_end)s",
           votes['up_count']
      );
      %>
      <span class="forum-nav-thread-votes-count">
      +<%= interpolate(fmt, {
               votes_count: votes['up_count'],
               span_start: '<span class="sr">',
               span_end: '</span>'
            }, true)
      %>
      </span>

      <% if (!neverRead && unread_comments_count > 0) { %>
        <span class="forum-nav-thread-unread-comments-count">
          <%-
            StringUtils.interpolate(
              gettext('{unread_comments_count} new'),
              {unread_comments_count: unread_comments_count}
            )
          %>
        </span>
      <% } %>

      <span class="forum-nav-thread-comments-count">
      <%
      var fmt;
      // Counts in data do not include the post itself, but the UI should
      var data = {
          'span_sr_open': '<span class="sr">',
          'span_close': '</span>',
          'unread_comments_count': unread_comments_count + (read ? 0 : 1),
          'comments_count': comments_count + 1
      };
      if (unread_comments_count > 0) {
          // Translators: 'comments_count' and 'unread_comments_count' are numerical placeholders for a specific discussion thread; 'span_*' placeholders refer to HTML markup.  Please translate the word 'comments'.
          fmt = gettext('%(comments_count)s %(span_sr_open)scomments (%(unread_comments_count)s unread comments)%(span_close)s');
      } else {
          // Translators: 'comments_count' is a numerical placeholder for a specific discussion thread; 'span_*' placeholders refer to HTML markup.  Please translate the word 'comments'.
          fmt = gettext('%(comments_count)s %(span_sr_open)scomments %(span_close)s');
      }
      print(interpolate(fmt, data, true));
      %>
      </span>
    </div>
  </a>
</li>

</script>
<script aria-hidden="true" type="text/template" id="search-alert-template">
    <div class="search-alert <%- css_class %>" id="search-alert-<%- cid %>">
    <div class="search-alert-content">
        <p class="message"><%= HtmlUtils.ensureHtml(messageHtml) %></p>
    </div>

    <div class="search-alert-controls">
        <button class="btn-link dismiss control control-dismiss" title="<%- gettext('Close') %>">
            <span class="icon fa fa-remove" aria-hidden="true"></span>
        </button>
    </div>
</div>

</script>
<script aria-hidden="true" type="text/template" id="new-post-template">
    <form class="forum-new-post-form">
    <h3 class="thread-title"><%- gettext("Add a Post") %></h3>
    <% if (mode === 'inline') { %>
        <button class="btn-default add-post-cancel">
            <span class="sr"><%- gettext('Cancel') %></span>
            <span class="fa fa-close" aria-hidden="true"></span>
        </button>
    <% } %>
    <ul class="post-errors" style="display: none"></ul>
    <div class="forum-new-post-form-wrapper"></div>
    <% if (cohort_options) { %>
    <div class="post-field group-selector-wrapper <% if (!is_commentable_cohorted) { print('disabled'); } %>">
        <label class="field-label">
            <span class="field-label-text">
                <% //Translators: This labels the selector for which group of students can view a post %>
                <%- gettext("Visible to") %>
            </span>
            <div class="field-help" id="field_help_visible_to">
                <%- gettext("Discussion admins, moderators, and TAs can make their posts visible to all students or specify a single cohort.") %>
            </div>
            <div class="field-input">
                <select aria-describedby="field_help_visible_to" class="post-topic field-input js-group-select" name="group_id" <% if (!is_commentable_cohorted) { print("disabled"); } %>>
                    <option value=""><%- gettext("All Groups") %></option>
                    <% _.each(cohort_options, function(opt) { %>
                    <option value="<%- opt.value %>" <% if (opt.selected) { print("selected"); } %>><%- opt.text %></option>
                    <% }); %>
                </select>
            </div>
        </label>
    </div>
    <% } %>
    <div class="post-field">
        <label class="field-label">
            <span class="field-label-text"><%- gettext("Title") %></span>
            <div class="field-help" id="field_help_title">
                <%- gettext("Add a clear and descriptive title to encourage participation.") %>
            </div>
            <div>
                <input aria-describedby="field_help_title" type="text" class="js-post-title field-input" name="title">
            </div>
        </label>
    </div>

    <div>
        <span class="field-label-text field-label-text-full" id="new-post-editor-description"><%- gettext('Your question or idea') %></span>
        <div class="js-post-body editor" aria-describedby="new-post-editor-description" name="body"></div>
    </div>
    <div class="post-options">
        <label class="post-option is-enabled">
            <input type="checkbox" name="follow" class="post-option-input js-follow" checked>
            <span class="icon fa fa-star" aria-hidden="true"></span><%- gettext("follow this post") %>
        </label>
        <% if (allow_anonymous) { %>
        <label class="post-option">
            <input type="checkbox" name="anonymous" class="post-option-input js-anon">
            <%- gettext("post anonymously") %>
        </label>
        <% } %>
        <% if (allow_anonymous_to_peers) { %>
        <label class="post-option">
            <input type="checkbox" name="anonymous_to_peers" class="post-option-input js-anon-peers">
            <%- gettext("post anonymously to classmates") %>
        </div>
        <% } %>
    </div>
    <div>
        <button type="submit" class="btn-brand submit"><%- gettext('Submit') %></button>
        <button type="button" class="btn cancel"><%- gettext('Cancel') %></button>
    </div>
</form>

</script>
<script aria-hidden="true" type="text/template" id="new-post-menu-entry-template">
    <option class="topic-title" data-discussion-id="<%- id %>" data-cohorted="<%- is_cohorted %>"><%- text %></option>

</script>
<script aria-hidden="true" type="text/template" id="new-post-menu-category-template">
    <optgroup label="<%- text %>">
    <%= edx.HtmlUtils.ensureHtml(entries) %>
</optgroup>

</script>
<script aria-hidden="true" type="text/template" id="new-post-alert-template">
    <div class="alert alert-error pattern-library-shim" role="alert" aria-labelledby="alert-title-error-<%- alertId %>" tabindex="-1">
    <span class="icon alert-icon fa fa-warning" aria-hidden="true"></span>

    <div class="alert-message">
        <h3 class="sr-only alert-title" id="alert-title-error-<%- alertId %>">
            <%- gettext("Error posting your message.") %>
        </h3>

        <p class="alert-copy">
            <%- gettext(message) %>
        </p>
    </div>
</div>

</script>
<script aria-hidden="true" type="text/template" id="topic-template">
    <div class="post-field">
    <label class="field-label">
        <span class="field-label-text">
            <%- gettext("Topic area") %>
        </span>
        <div class="field-help" id="field_help_topic_area">
            <%- gettext("Add your post to a relevant topic to help others find it.") %>
        </div>
        <div class="field-input">
            <select class="post-topic field-input" aria-describedby="field_help_topic_area" required>
                <%= edx.HtmlUtils.ensureHtml(topics_html) %>
            </select>
        </div>
    </label>
</div>

</script>
<script aria-hidden="true" type="text/template" id="post-user-display-template">
    <% if (username) { %>
<a href="<%- user_url %>" class="username"><%- username %></a>
    <% if (is_community_ta) { %>
    <span class="user-label-community-ta"><%- gettext("Community TA") %></span>
    <% } else if (is_staff) { %>
    <span class="user-label-staff"><%- gettext("Staff") %></span>
    <% } %>
<% } else { %>
    <%- gettext('anonymous') %>
<% } %>

</script>
<script aria-hidden="true" type="text/template" id="inline-discussion-template">
    <section class="discussion inline-discussion" data-discussion-id="<%- discussionId %>">
    <div class="add_post_btn_container <%if (read_only) {%>is-hidden<%} %>">
        <button class="btn-link new-post-btn"><%- gettext("Add a Post") %></button>
    </div>

    <article class="new-post-article is-hidden"></article>

    <div class="inline-discussion-thread-container">
        <section class="inline-threads">
        </section>

        <div class="inline-thread">
            <div class="forum-nav-bar">
                <button class="btn-link all-posts-btn">
                    <span class="icon fa fa-chevron-prev" aria-hidden="true"></span>
                    <span aria-hidden="true"><%- gettext('All Posts') %></span>
                    <span class="sr-only"><%- gettext('Return to all posts') %></span>
                </button>
            </div>
            <div class="forum-content">
            </div>
        </div>
    </div>
</section>


</script>
<script aria-hidden="true" type="text/template" id="pagination-template">
    <nav class="discussion-paginator">
    <ol>
        <% if (previous) { %>
            <li class="previous-page"><a class="discussion-pagination" href="<%= previous.url %>" data-page-number="<%= previous.number %>">&lt; <%- gettext("Previous") %></a></li>
        <% } %>
        <% if (first) { %>
            <li class="first-page"><a class="discussion-pagination" href="<%= first.url %>" data-page-number="1">1</a></li>
        <% } %>
        <% if (leftdots) { %>
            <li class="previous-ellipses"><%- gettext("…") %></li>
        <% } %>

        <% _.each(lowPages, function(page) { %>
            <li class="lower-page"><a class="discussion-pagination" href="<%= page.url %>" data-page-number="<%= page.number %>"><%= page.number %></a></li>
        <% }); %>
        <li class="current-page"><span><%= page %></span></li>
        <% _.each(highPages, function(page) { %>
            <li class="higher-page"><a class="discussion-pagination" href="<%= page.url %>" data-page-number="<%= page.number %>"><%= page.number %></a></li>
        <% }); %>

        <% if (rightdots) { %>
            <li class="next-ellipses"><%- gettext("…") %></li>
        <% } %>
        <% if (last) { %>
            <li class="last-page"><a class="discussion-pagination" href="<%= last.url %>" data-page-number="<%= last.number %>"><%= last.number %></a></li>
        <% } %>
        <% if (next) { %>
            <li class="next-page"><a class="discussion-pagination" href="<%= next.url %>" data-page-number="<%= next.number %>"><%- gettext("Next") %> &gt;</a></li>
        <% } %>
    </ol>
</nav>

</script>
<script aria-hidden="true" type="text/template" id="profile-thread-template">
    <article class="discussion-article" data-id="<%- id %>">
    <div class="discussion-post">
        <header>
            <h3><%- title %></h3>
            <p class="posted-details">
                <% if (user) { %>
                    <a href="<%- user.url %>" class="username"><%- user.username %></a>
                <% } else { %>
                    <%- gettext("anonymous") %>
                <% } %>

                <span class="timeago" title="<%- created_at %>"><%- created_at %></span>
                <span class="post-status-closed top-post-status" style="display: none">
                    &bull; <%- gettext("This thread is closed.") %>
                </span>
            </p>
        </header>
        <div class="post-body"><%= abbreviatedBody %></div>
    </div>
    <div class="post-tools">
        <a href="<%- permalink %>"><%- gettext("View discussion") %></a>
    </div>

</article>

</script>
<script aria-hidden="true" type="text/template" id="customwmd-prompt-template">
    <h4 id="editor-dialog-title"><%- title %></h4>
<div role="status" id="wmd-editor-dialog-form-errors" class="sr" tabindex="-1"></div>
<div>
    <form class="form">
        <fieldset class="field-group">
            <legend class="form-group-hd sr"><%- title %></legend>
            <div class="field <%- uploadFieldClass %>">
                <label id="new-url-input-label" for="new-url-input" class="field-label">
                    <%- urlLabel %></label>
                <input type="text" id="new-url-input" class="field-input input-text" aria-describedby="new-url-input-help">
                <% if (imageUploadHandler) { %>
                    <button id="file-upload-proxy" class="btn btn-primary btn-base form-btn">
                        <%- chooseFileText %>
                    </button>
                    <input type="file" name="file-upload" id="file-upload" style="display:none;"/>
                <% } %>
                <div id="new-url-input-field-message" class="field-message has-error" style="display:none">
                    <span class="field-message-content"><%- urlError %></span>
                </div>
                <div id="new-url-input-help" class="field-hint">
                    <%- urlHelp %>
                </div>
            </div>
            <div class="field">
                <label for="new-url-desc-input" class="field-label"><%- urlDescLabel %></label>
                <input type="text" id="new-url-desc-input" class="field-input input-text" required aria-describedby="new-url-desc-input-help">
                <div id="new-url-desc-input-field-message" class="field-message has-error" style="display:none">
                    <span class="field-message-content"><%- descError %></span>
                </div>
                <div id="new-url-desc-input-help" class="field-hint">
                    <%- urlDescHelp %>
                    <% if (urlDescHelpLink) { %>
                        <a href="<%- urlDescHelpLink['href'] %>">
                            <%- urlDescHelpLink['text'] %>
                        </a>
                    <% } %>
                </div>
            </div>
            <div class="field"><% if (imageUploadHandler) { %>
                <label for="img-is-decorative" class="field-label label-inline">
                    <input type="checkbox" id="img-is-decorative" class="field-input input-checkbox">
                    <span class="field-input-label"><%- imageIsDecorativeLabel %></span>
                </label> <% }
            %></div>
        </fieldset>
        <div class="form-actions">
            <input type="button" id="new-link-image-ok" class="btn-brand form-btn" value="<%- okText %>" />
            <input type="button" id="new-link-image-cancel" class="btn form-btn" value="<%- cancelText %>" >
        </div>
    </form>
</div>

</script>
<script aria-hidden="true" type="text/template" id="nav-loading-template">
    <div class="forum-nav-loading" tabindex="0">
    <span class="icon fa fa-spinner fa-spin"></span>
    <span class="sr" role="alert"><%- srText %></span>
</div>

</script>
<script aria-hidden="true" type="text/template" id="thread-type-template">
    <div class="post-field">
    <div class="field-label">
        <span class="field-label-text">
            <% // Translators: This is the label for a control to select a forum post type %>
            <%- gettext("Post type") %>
        </span>
        <div class="field-help" id="field_help_post_type">
            <%- gettext("Questions raise issues that need answers. Discussions share ideas and start conversations.") %>
        </div>
        <div class="field-label">
            <fieldset class="field-input">
                <legend class="sr"><%- gettext("Post type") %></legend>
                <input aria-describedby="field_help_post_type" type="radio" name="<%= form_id %>-post-type" class="post-type-input" id="<%= form_id %>-post-type-question" value="question">
                <label for="<%= form_id %>-post-type-question" class="post-type-label">
                    <span class="icon fa fa-question" aria-hidden="true"></span>
                    <% // Translators: This is a forum post type %>
                    <%- gettext("Question") %>
                </label>
                <input aria-describedby="field_help_post_type" type="radio" name="<%= form_id %>-post-type" class="post-type-input" id="<%= form_id %>-post-type-discussion" value="discussion" checked>
                <label for="<%= form_id %>-post-type-discussion" class="post-type-label">
                    <span class="icon fa fa-comments" aria-hidden="true"></span>
                    <% // Translators: This is a forum post type %>
                    <%- gettext("Discussion") %>
                </label>
            </fieldset>
        </div>
    </div>
</div>

</script>


<script aria-hidden="true" type="text/template" id="forum-action-endorse">
    <li class="actions-item">
    <button class="btn-link action-button action-endorse" role="checkbox" aria-checked="false">
        <span class="sr"><%- gettext("Endorse") %></span>
        <span class="action-label" aria-hidden="true">
            <span class="label-unchecked"><%- gettext("Endorse") %></span>
            <span class="label-checked"><%- gettext("Unendorse") %></span>
        </span>
        <span class="action-icon"><span class="icon fa fa-check" aria-hidden="true"></span></span>
    </button>
</li>

</script>
<script aria-hidden="true" type="text/template" id="forum-action-answer">
    <li class="actions-item">
    <button class="btn-link action-button action-answer" role="checkbox" aria-checked="false">
        <span class="sr"><%- gettext("Mark as Answer") %></span>
        <span class="action-label" aria-hidden="true">
            <span class="label-unchecked"><%- gettext("Mark as Answer") %></span>
            <span class="label-checked"><%- gettext("Unmark as Answer") %></span>
        </span>
        <span class="action-icon"><span class="icon fa fa-check" aria-hidden="true"></span></span>
    </button>
</li>

</script>
<script aria-hidden="true" type="text/template" id="forum-action-follow">
    <li class="actions-item">
    <button class="btn-link action-button action-follow" role="checkbox" aria-checked="false">
        <span class="sr"><%- gettext("Follow") %></span>
        <span class="action-label" aria-hidden="true">
            <span class="label-unchecked"><%- gettext("Follow") %></span>
            <span class="label-checked"><%- gettext("Unfollow") %></span>
        </span>
        <span class="action-icon"><span class="icon fa fa-star" aria-hidden="true"></span></span>
    </button>
</li>

</script>
<script aria-hidden="true" type="text/template" id="forum-action-vote">
    <li class="actions-item">
    <span aria-hidden="true" class="display-vote is-hidden" >
      <span class="vote-count"></span>
    </span>
    <button class="btn-link action-button action-vote" role="checkbox" aria-checked="false">
        <% // Vote counts are populated by JS %>
        <span class="sr"><%- gettext("Vote for this post,") %>&nbsp;</span>
        <span class="sr js-sr-vote-count"></span>

        <span class="action-label" aria-hidden="true">
          <span class="vote-count"></span>
        </span>

        <span class="action-icon" aria-hidden="true">
            <span class="icon fa fa-plus" aria-hidden="true"></span>
        </span>
    </button>
</li>

</script>
<script aria-hidden="true" type="text/template" id="forum-action-report">
    <li class="actions-item">
    <button class="btn-link action-list-item action-report" role="checkbox" aria-checked="false">
        <span class="sr"><%- gettext("Report abuse") %></span>
        <span class="action-label" aria-hidden="true">
            <span class="label-unchecked"><%- gettext("Report") %></span>
            <span class="label-checked"><%- gettext("Unreport") %></span>
        </span>
        <span class="action-icon">
          <span class="icon fa fa-flag" aria-hidden="true"></span>
        </span>
    </button>
</li>

</script>
<script aria-hidden="true" type="text/template" id="forum-action-pin">
    <li class="actions-item">
    <button class="btn-link action-list-item action-pin" role="checkbox" aria-checked="false">
        <span class="sr"><%- gettext("Pin") %></span>
        <span class="action-label" aria-hidden="true">
            <span class="label-unchecked"><%- gettext("Pin") %></span>
            <span class="label-checked"><%- gettext("Unpin") %></span>
        </span>
        <span class="action-icon">
          <span class="icon fa fa-thumb-tack" aria-hidden="true"></span>
        </span>
    </button>
</li>

</script>
<script aria-hidden="true" type="text/template" id="forum-action-close">
    <li class="actions-item">
    <button class="btn-link action-list-item action-close" role="checkbox" aria-checked="false">
        <span class="sr"><%- gettext("Close") %></span>
        <span class="action-label" aria-hidden="true">
            <span class="label-unchecked"><%- gettext("Close") %></span>
            <span class="label-checked"><%- gettext("Open") %></span>
        </span>
        <span class="action-icon">
          <span class="icon fa fa-lock" aria-hidden="true"></span>
        </span>
    </button>
</li>

</script>
<script aria-hidden="true" type="text/template" id="forum-action-edit">
    <li class="actions-item">
    <button class="btn-link action-list-item action-edit">
        <span class="action-label"><%- gettext("Edit") %></span>
        <span class="action-icon"><span class="icon fa fa-pencil" aria-hidden="true"></span></span>
    </button>
</li>

</script>
<script aria-hidden="true" type="text/template" id="forum-action-delete">
    <li class="actions-item">
    <button class="btn-link action-list-item action-delete">
        <span class="action-label"><%- gettext("Delete") %></span>
        <span class="action-icon"><span class="icon fa fa-remove" aria-hidden="true"></span></span>
    </button>
</li>

</script>
<script aria-hidden="true" type="text/template" id="forum-actions">
    <% if (!readOnly) { %>
    <ul class="<%= contentType %>-actions-list">
        <% _.each(primaryActions, function(action) { print(_.template($('#forum-action-' + action).html())({})) }) %>
        <li class="actions-item is-visible">
            <div class="more-wrapper">
                <button class="btn-link action-button action-more" aria-label="<%- gettext('More') %>" aria-haspopup="true" aria-controls="action-menu-<%= contentType %>">
                    <span class="action-label"><%- gettext('More') %></span>
                    <span class="action-icon"><span class="icon fa fa-ellipsis-h" aria-hidden="true"></span></span>
                </button>
                <div class="actions-dropdown" id="action-menu-<%= contentType %>" aria-expanded="false">
                  <ul class="actions-dropdown-list">
                    <% _.each(secondaryActions, function(action) { print(_.template($('#forum-action-' + action).html())({})) }) %>
                  </ul>
                </div>
            </div>
        </li>
    </ul>
<% } %>

</script>
<script aria-hidden="true" type="text/template" id="alert-popup">
    <div class='modal' role='alertdialog' id='discussion-alert' aria-describedby='discussion-alert-message'>
    <div class='inner-wrapper discussion-alert-wrapper'>
        <button class='btn close-modal dismiss' title='<%- gettext("Close") %>''>
            <span class='icon fa fa-times' aria-hidden='true'></span>
        </button>
        <header>
            <h2></h2></h2>
            <hr/>
        </header>
        <p id='discussion-alert-message'></p>
        <hr/>
        <button class='btn dismiss'><%- gettext("OK") %></button>
    </div>
</div>

</script>
<script aria-hidden="true" type="text/template" id="nav-load-more-link">
    <li class='forum-nav-load-more'>
    <button class='btn-link forum-nav-load-more-link'>
        <%- gettext("Load more") %>
    </button>
</li>

</script>



<script type="text/template" id="thread-list-template">
    <div class="forum-nav-thread-list-wrapper" id="sort-filter-wrapper" tabindex="-1">
        <div class="forum-nav-refine-bar">
            <label class="forum-nav-filter-main">
                <span class="sr">Filter:</span>
                <select class="forum-nav-filter-main-control">
                    <option value="all">显示全部</option>
                    <option value="unread">Unread</option>
                    <option value="unanswered">Unanswered</option>
                </select>
            </label><% if (isCohorted && isPrivilegedUser) { %><label class="forum-nav-filter-cohort">
                <span class="sr">Cohort:</span>
                <select class="forum-nav-filter-cohort-control">
                    <option value="">in all cohorts</option>
                </select>
            </label><% } %><label class="forum-nav-sort">
                <span class="sr">Sort:</span>
                <select class="forum-nav-sort-control">
                    <option value="activity">近期活动</option>
                    <option value="comments">活跃度</option>
                    <option value="votes">最多票数</option>
                </select>
            </label>
        </div>
        <div class="search-alerts"></div>
        <ul class="forum-nav-thread-list"></ul>
    </div>
</script>




<div class="discussion-module" data-discussion-id="c8883455a47656f70bc6b6aa32cc3a1edfac1e12" data-user-create-comment="true" data-user-create-subcomment="true" data-read-only="false">
    <div class="discussion-module-header">
        <h3 class="discussion-module-title">讨论</h3>
        <div class="inline-discussion-topic"><span class="inline-discussion-topic-title">Topic:</span> 管道与shell：管道 / 管道的读写</div>
    </div>
    <button class="discussion-show btn" data-discussion-id="c8883455a47656f70bc6b6aa32cc3a1edfac1e12">
        <span class="button-text">显示讨论</span>
    </button>
</div>
<script type="text/javascript">
var $$course_id = "course\u002Dv1:Internal+B3I062140+2019_T2";

function DiscussionInlineBlock(runtime, element) {
    'use strict';
    new DiscussionInlineView({ el: $(element).find('.discussion-module') });
}
</script>

</div>

  </div>
</div>

</div>

  </div>

  <nav class="sequence-bottom" aria-label="章">
    <button class="sequence-nav-button button-previous">
      <span class="icon fa fa-chevron-prev" aria-hidden="true"></span>
      <span>上一个</span>
    </button>
    <button class="sequence-nav-button button-next">
      <span>下一个</span>
      <span class="icon fa fa-chevron-next" aria-hidden="true"></span>
    </button>
  </nav>
</div>

</div>

        </main>
    </section>

    <section class="courseware-results-wrapper">
      <div id="loading-message" aria-live="polite" aria-relevant="all"></div>
      <div id="error-message" aria-live="polite"></div>
      <div class="courseware-results search-results" data-course-id="course-v1:Internal+B3I062140+2019_T2" data-lang-code="zh-cn"></div>
    </section>

  </div>
</div>
<div class="container-footer">
</div>

<nav class="nav-utilities " aria-label="课程工具">

</nav>


<div id="accessibile-confirm-modal" class="modal" aria-hidden="true">
  <div class="inner-wrapper" role="dialog" aria-labelledby="accessibile-confirm-title">
    <button class="close-modal">
      <span class="icon fa fa-remove" aria-hidden="true"></span>
      <span class="sr">
        关闭
      </span>
    </button>

    <header>
      <h2 id="accessibile-confirm-title">
          Confirm
        <span class="sr">,
          modal open
        </span>
      </h2>
    </header>
    <div role="alertdialog" class="status message" tabindex="-1">
        <p class="message-title"></p>
    </div>
    <hr aria-hidden="true">
    <div class="actions">
        <button class="dismiss ok-button">OK</button>
        <button class="dismiss cancel-button" data-dismiss="leanModal">取消</button>
    </div>
  </div>
  <a href="http://cscore.net.cn/courses/course-v1:Internal+B3I062140+2019_T2/courseware/2659806750474e29b1e3948a90da8bd2/3d23196bb0fd4c7485648e18948ecc52/#accessibile-confirm-modal" rel="leanModal" id="confirm_open_button" style="display:none">open</a>
</div>

<script type="text/javascript">
var accessible_confirm = function(message, callback) {
    $("#accessibile-confirm-modal .cancel-button").click(function(){
        $("#accessibile-confirm-modal .close-modal").click();
    });
    $("#accessibile-confirm-modal .ok-button").click(function(){
        $("#accessibile-confirm-modal .close-modal").click();
        callback();
    });

    accessible_modal("#accessibile-confirm-modal #confirm_open_button", "#accessibile-confirm-modal .close-modal", "#accessibile-confirm-modal", ".content-wrapper");
    $("#accessibile-confirm-modal #confirm_open_button").click();
    $("#accessibile-confirm-modal .message-title").html(message);
};
</script>


      
    </div>

        




<div class="wrapper wrapper-footer">
  <footer id="footer-openedx" class="grid-container">
    <div class="colophon">
      <!--<nav class="nav-colophon" aria-label="关于我们">
        <ol>
            <li class="nav-colophon-01">
              <a id="about" href="/about">关于我们</a>
            </li>
            <li class="nav-colophon-02">
              <a id="blog" href="/blog">博客</a>
            </li>
            <li class="nav-colophon-03">
              <a id="contact" href="/contact">联系我们</a>
            </li>
            <li class="nav-colophon-04">
              <a id="donate" href="/donate">捐助</a>
            </li>
        </ol>
      </nav>-->

      <div class="wrapper-logo">
        <p>
          <a href="http://cscore.net.cn/">
            <img alt="organization logo" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/logo.b6c374d66d57.png">
          </a>
        </p>
      </div>

      <p class="copyright">© CSCore.  All rights reserved except where noted.  EdX, Open edX and the edX and Open EdX logos are registered trademarks or trademarks of edX Inc.</p>

      <p class="copyright"><a href="http://beian.miit.gov.cn/">京ICP备18009955号-1</a></p>

      <!--<nav class="nav-legal" aria-label="合法">
        <ul>
            <li class="nav-legal-01">
              <a href="/privacy">隐私政策</a>
            </li>
            <li class="nav-legal-02">
              <a href="/tos">服务条款</a>
            </li>
            <li class="nav-legal-03">
              <a href="/honor">诚信准则</a>
            </li>
        </ul>
      </nav>-->
    </div>

    <div class="footer-about-openedx">
      <p>
        <!--<a href="http://open.edx.org">-->
          <img src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/edx-openedx-logo-tag.png" alt="Powered by Open edX" width="140">
        <!--</a>-->
        <!--<a href="https://cloud.tencent.com">-->
          <img src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/logo-pc.png" alt="腾讯云提供计算服务" width="140">
        <!--</a>-->
      </p>
    </div>
  </footer>
</div>


  </div>

  
  <script type="text/javascript" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/jquery.scrollTo.525edcc52fe8.js.下载"></script>
  <script type="text/javascript" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/jquery.flot.d3d45ff0c6a8.js.下载"></script>

  <script type="text/javascript" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/codemirror-compressed.dd4b74f7c5fe.js.下载"></script>

  
    <script type="text/javascript" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/lms-courseware.94e582ddac20.js.下载" charset="utf-8"></script>


  



<script type="text/javascript">
    // Fast Preview was introduced in 2.5. However, it
    // causes undesirable flashing/font size changes when
    // MathJax is used for interactive preview (equation editor).
    // Setting processSectionDelay to 0 (see below) fully eliminates
    // fast preview, but to reduce confusion, we are also setting
    // the option as displayed in the context menu to false.
    // When upgrading to 2.6, check if this variable name changed.
    window.MathJax = {
      menuSettings: {CHTMLpreview: false}
    };
</script>

<script type="text/x-mathjax-config;executed=true">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [
        ["\\(","\\)"],
        ['[mathjaxinline]','[/mathjaxinline]']
      ],
      displayMath: [
        ["\\[","\\]"],
        ['[mathjax]','[/mathjax]']
      ]
    }
  });
</script>
<script type="text/x-mathjax-config;executed=true">

  // In order to eliminate all flashing during interactive
  // preview, it is necessary to set processSectionDelay to 0
  // (remove delay between input and output phases). This
  // effectively disables fast preview, regardless of
  // the fast preview setting as shown in the context menu.
  MathJax.Hub.processSectionDelay = 0;

  MathJax.Hub.signal.Interest(function(message) {
    if(message[0] === "End Math") {
        set_mathjax_display_div_settings();
    }
  });
  function set_mathjax_display_div_settings() {
    $('.MathJax_Display').each(function( index ) {
      this.setAttribute('tabindex', '0');
      this.setAttribute('aria-live', 'off');
      this.removeAttribute('role');
      this.removeAttribute('aria-readonly');
    });
  }
</script>


<!-- This must appear after all mathjax-config blocks, so it is after the imports from the other templates.
     It can't be run through static.url because MathJax uses crazy url introspection to do lazy loading of
     MathJax extension libraries -->
<script type="text/javascript" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/MathJax.js.下载"></script>
<!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_SVG"></script> -->



  
    
      <script type="text/javascript" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/courseware_factory.01c762a7c9e6.js.下载"></script>
    <script type="text/javascript">
        (function (require) {
            require(['js/courseware/courseware_factory'], function (CoursewareFactory) {
                
    CoursewareFactory();
  
            });
        }).call(this, require || RequireJS.require);
    </script>



  <script type="text/javascript">
    var $$course_id = "course\u002Dv1:Internal+B3I062140+2019_T2";
  </script>

<script src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/discussion.js.下载" type="application/javascript"></script>
<script src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/vertical_student_view.7c27fd5e4fd0.js.下载" type="application/javascript"></script>



  



  <script type="text/javascript" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/noreferrer.aa62a3e70ffa.js.下载" charset="utf-8"></script>
  <script type="text/javascript" src="./管道的读写 _ 管道 _ B3I062140 课程页面 _ CSCore_files/navigation.323bf3e1ae16.js.下载" charset="utf-8"></script>
  





<!-- Performance beacon for onload times -->
<div id="reader-feedback" class="sr" aria-live="polite"></div><div id="lean_overlay"></div><div class="tooltip" style="display: none; opacity: 0;"></div><div class="xl-chrome-ext-bar" id="xl_chrome_ext_{4DB361DE-01F7-4376-B494-639E489D19ED}" style="display: none;">
      <div class="xl-chrome-ext-bar__logo"></div>

      <a id="xl_chrome_ext_download" href="javascript:;" class="xl-chrome-ext-bar__option">下载视频</a>
      <a id="xl_chrome_ext_close" href="javascript:;" class="xl-chrome-ext-bar__close"></a>
    </div><div id="UMS_TOOLTIP" style="position: absolute; cursor: pointer; z-index: 2147483647; background: transparent; top: -100000px; left: -100000px;"></div></body><umsdataelement id="UMSSendDataEventElement"></umsdataelement></html>